{"version":3,"file":"view.js","mappings":"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","sources":["webpack://mosne-text-to-speech-block/external module \"@wordpress/interactivity\"","webpack://mosne-text-to-speech-block/webpack/bootstrap","webpack://mosne-text-to-speech-block/webpack/runtime/make namespace object","webpack://mosne-text-to-speech-block/./src/view.js"],"sourcesContent":["module.exports = __WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * WordPress dependencies\n */\nimport { store, getContext } from '@wordpress/interactivity';\n\nconst { state, actions } = store( 'mosne-text-to-speech-block', {\n\tstate: {\n\t\tisPlaying: false,\n\t\tcurrentVoice: null,\n\t\tpreferredVoice:\n\t\t\twindow.localStorage.getItem(\n\t\t\t\t'mosne-tts-lang-' + document.documentElement.lang\n\t\t\t) || null,\n\t\tutterance: null,\n\t\tvoices: [],\n\t\tcurrentSpeed:\n\t\t\twindow.localStorage.getItem(\n\t\t\t\t'mosne-tts-speed-' + document.documentElement.lang\n\t\t\t) || 1,\n\t\tcurrentPitch:\n\t\t\twindow.localStorage.getItem(\n\t\t\t\t'mosne-tts-pitch-' + document.documentElement.lang\n\t\t\t) || 1,\n\t\tselectedTextRange: {\n\t\t\thasSelection: false,\n\t\t},\n\t\tcurrentChunk: 0,\n\t\ttextChunks: [],\n\t\tisProcessingChunks: false,\n\t},\n\tactions: {\n\t\tloadVoices() {\n\t\t\tconst availableVoices = window.speechSynthesis.getVoices();\n\t\t\tif ( ! availableVoices || availableVoices.length === 0 ) {\n\t\t\t\t// If voices aren't available yet, try again after a short delay\n\t\t\t\tsetTimeout( () => actions.loadVoices(), 100 );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tstate.voices = availableVoices;\n\t\t\tstate.currentVoice = availableVoices[ 0 ];\n\n\t\t\tconst currentLocale = document.documentElement.lang;\n\t\t\tconst localVoices = availableVoices.filter( ( voice ) =>\n\t\t\t\tvoice.lang.startsWith( currentLocale )\n\t\t\t);\n\n\t\t\tif ( localVoices.length > 0 ) {\n\t\t\t\tstate.voices = localVoices;\n\t\t\t\tstate.currentVoice = localVoices[ 0 ];\n\t\t\t\tif ( state.preferredVoice ) {\n\t\t\t\t\tconst voice = localVoices.find(\n\t\t\t\t\t\t( v ) => v.voiceURI === state.preferredVoice\n\t\t\t\t\t);\n\t\t\t\t\tif ( voice ) {\n\t\t\t\t\t\tstate.currentVoice = voice;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Create initial utterance after a small delay\n\t\t\tsetTimeout( () => {\n\t\t\t\tactions.createUtterance();\n\t\t\t}, 50 );\n\t\t},\n\t\tcreateUtterance() {\n\t\t\t// Get current chunk of content\n\t\t\tconst content =\n\t\t\t\tstate.textChunks.length > 0\n\t\t\t\t\t? state.textChunks[ state.currentChunk ]\n\t\t\t\t\t: actions.getContent();\n\n\t\t\tconst newUtterance = new window.SpeechSynthesisUtterance( content );\n\t\t\tnewUtterance.lang = document.documentElement.lang;\n\t\t\tnewUtterance.rate = state.currentSpeed;\n\t\t\tnewUtterance.pitch = state.currentPitch;\n\n\t\t\t// Get the main element for highlighting\n\t\t\tconst mainElement = document.querySelector( 'main' );\n\t\t\tconst docView = mainElement?.ownerDocument.defaultView;\n\t\t\tconst selection = docView ? docView.getSelection() : null;\n\n\t\t\tnewUtterance.onboundary = function ( event ) {\n\t\t\t\tif ( ! mainElement ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Remove previous highlights by unwrapping\n\t\t\t\tconst highlighted = mainElement.querySelectorAll(\n\t\t\t\t\t'.mosne-tts-highlighted-word'\n\t\t\t\t);\n\t\t\t\thighlighted.forEach( ( wrapper ) => {\n\t\t\t\t\t// Replace the wrapper with its text content\n\t\t\t\t\tconst parent = wrapper.parentNode;\n\t\t\t\t\tparent.replaceChild(\n\t\t\t\t\t\tdocument.createTextNode( wrapper.textContent ),\n\t\t\t\t\t\twrapper\n\t\t\t\t\t);\n\t\t\t\t} );\n\n\t\t\t\t// Safety check for valid boundary event\n\t\t\t\tif (\n\t\t\t\t\t! event.charIndex ||\n\t\t\t\t\t! event.charLength ||\n\t\t\t\t\tevent.charIndex + event.charLength > content.length\n\t\t\t\t) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\t// If we're reading selected text, we need to handle highlighting differently\n\t\t\t\t\tif (\n\t\t\t\t\t\tstate.selectedTextRange &&\n\t\t\t\t\t\tstate.selectedTextRange.hasSelection\n\t\t\t\t\t) {\n\t\t\t\t\t\t// Create a new highlight for the selection\n\t\t\t\t\t\tif ( selection && selection.rangeCount > 0 ) {\n\t\t\t\t\t\t\tconst range = selection.getRangeAt( 0 );\n\n\t\t\t\t\t\t\t// Create wrapper span\n\t\t\t\t\t\t\tconst blockWrapper = document.querySelector(\n\t\t\t\t\t\t\t\t'[data-wp-interactive=\"mosne-text-to-speech-block\"]'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tconst highlightBackground =\n\t\t\t\t\t\t\t\tblockWrapper?.dataset.highlightBackground ||\n\t\t\t\t\t\t\t\t'#ffeb3b';\n\t\t\t\t\t\t\tconst highlightColor =\n\t\t\t\t\t\t\t\tblockWrapper?.dataset.highlightColor ||\n\t\t\t\t\t\t\t\t'#000000';\n\n\t\t\t\t\t\t\t// Highlight the current word within the selection\n\t\t\t\t\t\t\tconst startOffset = event.charIndex;\n\t\t\t\t\t\t\tconst endOffset =\n\t\t\t\t\t\t\t\tevent.charIndex + event.charLength;\n\n\t\t\t\t\t\t\t// Create a temporary span for the current word\n\t\t\t\t\t\t\tconst wrapper = document.createElement( 'span' );\n\t\t\t\t\t\t\twrapper.className = 'mosne-tts-highlighted-word';\n\t\t\t\t\t\t\twrapper.style.setProperty(\n\t\t\t\t\t\t\t\t'--mosne-tts-highlight-bg',\n\t\t\t\t\t\t\t\thighlightBackground\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\twrapper.style.setProperty(\n\t\t\t\t\t\t\t\t'--mosne-tts-highlight-color',\n\t\t\t\t\t\t\t\thighlightColor\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t// Get the word being spoken\n\t\t\t\t\t\t\tconst word = content.substring(\n\t\t\t\t\t\t\t\tstartOffset,\n\t\t\t\t\t\t\t\tendOffset\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\twrapper.textContent = word;\n\n\t\t\t\t\t\t\t// Find the text node containing this word\n\t\t\t\t\t\t\tconst textNodes = [];\n\t\t\t\t\t\t\tconst walker = document.createTreeWalker(\n\t\t\t\t\t\t\t\trange.commonAncestorContainer,\n\t\t\t\t\t\t\t\tNodeFilter.SHOW_TEXT,\n\t\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\t\tfalse\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tlet node;\n\t\t\t\t\t\t\twhile ( ( node = walker.nextNode() ) ) {\n\t\t\t\t\t\t\t\tif ( node.textContent.includes( word ) ) {\n\t\t\t\t\t\t\t\t\ttextNodes.push( node );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Highlight the first occurrence of the word\n\t\t\t\t\t\t\tif ( textNodes.length > 0 ) {\n\t\t\t\t\t\t\t\tconst textNode = textNodes[ 0 ];\n\t\t\t\t\t\t\t\tconst nodeText = textNode.textContent;\n\t\t\t\t\t\t\t\tconst wordIndex = nodeText.indexOf( word );\n\n\t\t\t\t\t\t\t\tif ( wordIndex >= 0 ) {\n\t\t\t\t\t\t\t\t\tconst nodeRange = document.createRange();\n\t\t\t\t\t\t\t\t\tnodeRange.setStart( textNode, wordIndex );\n\t\t\t\t\t\t\t\t\tnodeRange.setEnd(\n\t\t\t\t\t\t\t\t\t\ttextNode,\n\t\t\t\t\t\t\t\t\t\twordIndex + word.length\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\tnodeRange.surroundContents( wrapper );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Original highlighting logic for main content\n\t\t\t\t\t\tconst excludeClass =\n\t\t\t\t\t\t\tblockWrapper?.dataset.excludeClass || 'skip-speech';\n\n\t\t\t\t\t\tconst walker = document.createTreeWalker(\n\t\t\t\t\t\t\tmainElement,\n\t\t\t\t\t\t\tNodeFilter.SHOW_TEXT,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tacceptNode( node ) {\n\t\t\t\t\t\t\t\t\tlet current = node.parentElement;\n\t\t\t\t\t\t\t\t\twhile ( current ) {\n\t\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t\tcurrent.classList &&\n\t\t\t\t\t\t\t\t\t\t\tcurrent.classList.contains(\n\t\t\t\t\t\t\t\t\t\t\t\t'skip-speech'\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\t\treturn NodeFilter.FILTER_REJECT;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tcurrent = current.parentElement;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn NodeFilter.FILTER_ACCEPT;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfalse\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tlet charCount = 0;\n\t\t\t\t\t\tlet node;\n\n\t\t\t\t\t\t// Find the text node that contains the current position\n\t\t\t\t\t\twhile ( ( node = walker.nextNode() ) ) {\n\t\t\t\t\t\t\tconst nodeLength = node.length;\n\t\t\t\t\t\t\tif ( charCount + nodeLength > event.charIndex ) {\n\t\t\t\t\t\t\t\t// Found the node containing the current position\n\t\t\t\t\t\t\t\tconst blockWrapper = document.querySelector(\n\t\t\t\t\t\t\t\t\t'[data-wp-interactive=\"mosne-text-to-speech-block\"]'\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tconst highlightBackground =\n\t\t\t\t\t\t\t\t\tblockWrapper?.dataset.highlightBackground ||\n\t\t\t\t\t\t\t\t\t'#ffeb3b';\n\t\t\t\t\t\t\t\tconst highlightColor =\n\t\t\t\t\t\t\t\t\tblockWrapper?.dataset.highlightColor ||\n\t\t\t\t\t\t\t\t\t'#000000';\n\n\t\t\t\t\t\t\t\t// Create wrapper span\n\t\t\t\t\t\t\t\tconst wrapper =\n\t\t\t\t\t\t\t\t\tdocument.createElement( 'span' );\n\t\t\t\t\t\t\t\twrapper.className =\n\t\t\t\t\t\t\t\t\t'mosne-tts-highlighted-word';\n\t\t\t\t\t\t\t\twrapper.style.setProperty(\n\t\t\t\t\t\t\t\t\t'--mosne-tts-highlight-bg',\n\t\t\t\t\t\t\t\t\thighlightBackground\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\twrapper.style.setProperty(\n\t\t\t\t\t\t\t\t\t'--mosne-tts-highlight-color',\n\t\t\t\t\t\t\t\t\thighlightColor\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t// Wrap the text content\n\t\t\t\t\t\t\t\twrapper.textContent = node.textContent;\n\t\t\t\t\t\t\t\tnode.parentNode.replaceChild( wrapper, node );\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcharCount += nodeLength;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch ( e ) {\n\t\t\t\t\t// silent error\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Update the onend event handler to move to next chunk or finish\n\t\t\tnewUtterance.onend = function () {\n\t\t\t\tif ( mainElement ) {\n\t\t\t\t\tconst highlighted = mainElement.querySelectorAll(\n\t\t\t\t\t\t'.mosne-tts-highlighted-word'\n\t\t\t\t\t);\n\t\t\t\t\thighlighted.forEach( ( wrapper ) => {\n\t\t\t\t\t\tconst parent = wrapper.parentNode;\n\t\t\t\t\t\tparent.replaceChild(\n\t\t\t\t\t\t\tdocument.createTextNode( wrapper.textContent ),\n\t\t\t\t\t\t\twrapper\n\t\t\t\t\t\t);\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\t// Check if there are more chunks to process\n\t\t\t\tif (\n\t\t\t\t\tstate.currentChunk < state.textChunks.length - 1 &&\n\t\t\t\t\tstate.isPlaying\n\t\t\t\t) {\n\t\t\t\t\t// Move to next chunk\n\t\t\t\t\tstate.currentChunk++;\n\n\t\t\t\t\t// Create and play next utterance\n\t\t\t\t\tsetTimeout( () => {\n\t\t\t\t\t\tactions.createUtterance();\n\t\t\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t\t\t\t}, 250 ); // Brief pause between chunks\n\t\t\t\t} else {\n\t\t\t\t\t// Reset chunks and finish\n\t\t\t\t\tstate.currentChunk = 0;\n\t\t\t\t\tstate.textChunks = [];\n\t\t\t\t\tstate.isPlaying = false;\n\n\t\t\t\t\t// Clear selected text range\n\t\t\t\t\tstate.selectedTextRange = {\n\t\t\t\t\t\thasSelection: false,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif ( state.currentVoice ) {\n\t\t\t\tconst voice = state.voices.find(\n\t\t\t\t\t( v ) => v.voiceURI === state.currentVoice.voiceURI\n\t\t\t\t);\n\t\t\t\tnewUtterance.voice = voice;\n\t\t\t}\n\t\t\tstate.utterance = newUtterance;\n\t\t},\n\t\tupdateUtterance() {\n\t\t\tconst utterance = state.utterance;\n\t\t\tif ( utterance ) {\n\t\t\t\twindow.speechSynthesis.cancel();\n\n\t\t\t\t// Remove any existing highlights\n\t\t\t\tconst mainElement = document.querySelector( 'main' );\n\t\t\t\tif ( mainElement ) {\n\t\t\t\t\tconst highlighted = mainElement.querySelectorAll(\n\t\t\t\t\t\t'.mosne-tts-highlighted-word'\n\t\t\t\t\t);\n\t\t\t\t\thighlighted.forEach( ( el ) => {\n\t\t\t\t\t\tconst parent = el.parentNode;\n\t\t\t\t\t\tparent.replaceChild(\n\t\t\t\t\t\t\tdocument.createTextNode( el.textContent ),\n\t\t\t\t\t\t\tel\n\t\t\t\t\t\t);\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\t// Update state directly without relying on context\n\t\t\t\tstate.isPlaying = false;\n\n\t\t\t\t// Check if synthesis is ready using a promise\n\t\t\t\tconst checkSynthesisReady = () => {\n\t\t\t\t\treturn new Promise( ( resolve ) => {\n\t\t\t\t\t\tconst check = () => {\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t! window.speechSynthesis.speaking &&\n\t\t\t\t\t\t\t\t! window.speechSynthesis.pending\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsetTimeout( check, 100 );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tcheck();\n\t\t\t\t\t} );\n\t\t\t\t};\n\n\t\t\t\t// Wait for synthesis to be ready before creating new utterance\n\t\t\t\tcheckSynthesisReady().then( () => {\n\t\t\t\t\tactions.createUtterance();\n\t\t\t\t} );\n\t\t\t}\n\t\t},\n\t\tPlay() {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = true;\n\t\t\tstate.isPlaying = true;\n\n\t\t\t// If this is the first play or starting over, get content and create chunks\n\t\t\tif ( state.textChunks.length === 0 || state.currentChunk === 0 ) {\n\t\t\t\tactions.getContent();\n\t\t\t\tactions.createUtterance();\n\t\t\t}\n\n\t\t\t// If paused, just resume\n\t\t\tif ( window.speechSynthesis.paused ) {\n\t\t\t\twindow.speechSynthesis.resume();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Chrome fix: force reset synthesis if it's in a bad state\n\t\t\tif ( window.speechSynthesis.speaking ) {\n\t\t\t\twindow.speechSynthesis.cancel();\n\t\t\t\tsetTimeout( () => {\n\t\t\t\t\tif ( state.utterance ) {\n\t\t\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t\t\t\t}\n\t\t\t\t}, 50 );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Start new speech if not already speaking\n\t\t\tif ( state.utterance ) {\n\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t\t}\n\t\t},\n\t\tPause() {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = false;\n\t\t\tstate.isPlaying = false;\n\n\t\t\t// Only pause if currently speaking and the browser supports pausing\n\t\t\tif (\n\t\t\t\twindow.speechSynthesis.speaking &&\n\t\t\t\t! window.speechSynthesis.paused\n\t\t\t) {\n\t\t\t\twindow.speechSynthesis.pause();\n\t\t\t}\n\t\t},\n\t\tRestart() {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = false;\n\t\t\tstate.isPlaying = false;\n\t\t\twindow.speechSynthesis.cancel();\n\n\t\t\t// Reset chunks\n\t\t\tstate.currentChunk = 0;\n\t\t\tstate.textChunks = [];\n\n\t\t\t// Remove any existing highlights\n\t\t\tconst mainElement = document.querySelector( 'main' );\n\t\t\tif ( mainElement ) {\n\t\t\t\tconst highlighted = mainElement.querySelectorAll(\n\t\t\t\t\t'.mosne-tts-highlighted-word'\n\t\t\t\t);\n\t\t\t\thighlighted.forEach( ( el ) => {\n\t\t\t\t\tconst parent = el.parentNode;\n\t\t\t\t\tparent.replaceChild(\n\t\t\t\t\t\tdocument.createTextNode( el.textContent ),\n\t\t\t\t\t\tel\n\t\t\t\t\t);\n\t\t\t\t} );\n\t\t\t}\n\t\t},\n\t\tchangeVoice( e ) {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = false;\n\n\t\t\t// Cancel any ongoing speech\n\t\t\twindow.speechSynthesis.cancel();\n\n\t\t\tconst voice = state.voices.find(\n\t\t\t\t( v ) => v.voiceURI === e.target.value\n\t\t\t);\n\n\t\t\tif ( voice ) {\n\t\t\t\tstate.currentVoice = voice;\n\t\t\t\twindow.localStorage.setItem(\n\t\t\t\t\t'mosne-tts-lang-' + document.documentElement.lang,\n\t\t\t\t\tvoice.voiceURI\n\t\t\t\t);\n\n\t\t\t\t// Small delay to ensure speech synthesis is ready\n\t\t\t\tsetTimeout( () => {\n\t\t\t\t\tactions.updateUtterance();\n\t\t\t\t}, 50 );\n\t\t\t}\n\t\t},\n\t\tchangeSpeed( e ) {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = false;\n\n\t\t\t// Cancel current speech\n\t\t\twindow.speechSynthesis.cancel();\n\n\t\t\t// Update state\n\t\t\tstate.currentSpeed = e.target.value;\n\t\t\twindow.localStorage.setItem(\n\t\t\t\t'mosne-tts-speed-' + document.documentElement.lang,\n\t\t\t\te.target.value\n\t\t\t);\n\n\t\t\t// Check if synthesis is ready using a promise\n\t\t\tconst checkSynthesisReady = () => {\n\t\t\t\treturn new Promise( ( resolve ) => {\n\t\t\t\t\tconst check = () => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t! window.speechSynthesis.speaking &&\n\t\t\t\t\t\t\t! window.speechSynthesis.pending\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetTimeout( check, 100 );\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tcheck();\n\t\t\t\t} );\n\t\t\t};\n\n\t\t\t// Wait for synthesis to be ready before creating new utterance\n\t\t\tcheckSynthesisReady().then( () => {\n\t\t\t\tactions.createUtterance();\n\t\t\t\tif ( context.isPlaying ) {\n\t\t\t\t\tsetTimeout( () => {\n\t\t\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t\t\t\t}, 50 );\n\t\t\t\t}\n\t\t\t} );\n\t\t},\n\t\tchangePitch( e ) {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = false;\n\n\t\t\t// Cancel current speech\n\t\t\twindow.speechSynthesis.cancel();\n\n\t\t\t// Update state\n\t\t\tstate.currentPitch = e.target.value;\n\t\t\twindow.localStorage.setItem(\n\t\t\t\t'mosne-tts-pitch-' + document.documentElement.lang,\n\t\t\t\te.target.value\n\t\t\t);\n\n\t\t\t// Check if synthesis is ready using a promise\n\t\t\tconst checkSynthesisReady = () => {\n\t\t\t\treturn new Promise( ( resolve ) => {\n\t\t\t\t\tconst check = () => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t! window.speechSynthesis.speaking &&\n\t\t\t\t\t\t\t! window.speechSynthesis.pending\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetTimeout( check, 100 );\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tcheck();\n\t\t\t\t} );\n\t\t\t};\n\n\t\t\t// Wait for synthesis to be ready before creating new utterance\n\t\t\tcheckSynthesisReady().then( () => {\n\t\t\t\tactions.createUtterance();\n\t\t\t\tif ( context.isPlaying ) {\n\t\t\t\t\tsetTimeout( () => {\n\t\t\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t\t\t\t}, 50 );\n\t\t\t\t}\n\t\t\t} );\n\t\t},\n\t\ttoggleSettings() {\n\t\t\tconst context = getContext();\n\t\t\tcontext.showSettings = ! context.showSettings;\n\t\t},\n\t\tgetContent() {\n\t\t\t// Check if there is highlighted text\n\t\t\tconst selection = window.getSelection();\n\t\t\tconst mainElement = document.querySelector( 'main' );\n\t\t\tlet content = '';\n\n\t\t\tif ( selection && selection.toString().trim().length > 0 ) {\n\t\t\t\t// Get selected text\n\t\t\t\tcontent = selection.toString();\n\t\t\t\tstate.selectedTextRange = {\n\t\t\t\t\ttext: content,\n\t\t\t\t\thasSelection: true,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\t// Get content from main element\n\t\t\t\tlet cloneMain = mainElement?.cloneNode( true );\n\t\t\t\tif ( cloneMain ) {\n\t\t\t\t\tconst skip = cloneMain.querySelectorAll( '.skip-speech' );\n\t\t\t\t\tskip.forEach( ( el ) => {\n\t\t\t\t\t\tel.remove();\n\t\t\t\t\t} );\n\t\t\t\t\tcontent = cloneMain.textContent;\n\t\t\t\t\tcloneMain = null;\n\t\t\t\t}\n\n\t\t\t\tstate.selectedTextRange = {\n\t\t\t\t\thasSelection: false,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Process content into chunks of approximately 200 words\n\t\t\tstate.textChunks = actions.chunkText( content, 200 );\n\t\t\tstate.currentChunk = 0;\n\n\t\t\t// Return the first chunk to start with\n\t\t\treturn state.textChunks.length > 0 ? state.textChunks[ 0 ] : '';\n\t\t},\n\t\t// New method to chunk text into approximately word-sized pieces\n\t\tchunkText( text, wordsPerChunk ) {\n\t\t\tif ( ! text || text.trim() === '' ) {\n\t\t\t\treturn [ '' ];\n\t\t\t}\n\n\t\t\t// Split the text into words\n\t\t\tconst words = text.trim().split( /\\s+/ );\n\t\t\tconst chunks = [];\n\n\t\t\t// Create chunks of approximately wordsPerChunk words\n\t\t\tfor ( let i = 0; i < words.length; i += wordsPerChunk ) {\n\t\t\t\tconst chunk = words.slice( i, i + wordsPerChunk ).join( ' ' );\n\t\t\t\tchunks.push( chunk );\n\t\t\t}\n\n\t\t\treturn chunks;\n\t\t},\n\t},\n\tcallbacks: {\n\t\tinit() {\n\t\t\t// Initialize voices when available\n\t\t\tif ( window.speechSynthesis ) {\n\t\t\t\twindow.speechSynthesis.cancel();\n\t\t\t\tactions.loadVoices();\n\t\t\t\tif ( window.speechSynthesis.onvoiceschanged !== undefined ) {\n\t\t\t\t\twindow.speechSynthesis.onvoiceschanged = actions.loadVoices;\n\t\t\t\t}\n\n\t\t\t\t// Add beforeunload event listener\n\t\t\t\twindow.addEventListener( 'beforeunload', () => {\n\t\t\t\t\twindow.speechSynthesis.cancel();\n\t\t\t\t} );\n\t\t\t}\n\t\t},\n\t\tisSelected() {\n\t\t\tconst context = getContext();\n\t\t\treturn context.voice.voiceURI === state.currentVoice.voiceURI;\n\t\t},\n\t},\n} );\n\nclass TextToSpeechManager {\n\tconstructor() {\n\t\tthis.utterance = null;\n\t\tthis.highlightedElement = null;\n\t\tthis.originalText = '';\n\t\tthis.synth = window.speechSynthesis;\n\t}\n\n\tspeak( text, element ) {\n\t\t// Cancel any ongoing speech\n\t\tthis.synth.cancel();\n\n\t\tthis.utterance = new SpeechSynthesisUtterance( text );\n\t\tthis.highlightedElement = element;\n\t\tthis.originalText = text;\n\n\t\tthis.utterance.onboundary = ( event ) => {\n\t\t\tif ( event.name === 'word' ) {\n\t\t\t\t// Remove previous highlighting\n\t\t\t\tthis.highlightedElement.innerHTML = this.originalText;\n\n\t\t\t\t// Calculate the word position\n\t\t\t\tconst wordPosition = event.charIndex;\n\t\t\t\tconst wordLength = event.charLength || 1;\n\n\t\t\t\t// Create highlighted version\n\t\t\t\tconst beforeText = this.originalText.substring(\n\t\t\t\t\t0,\n\t\t\t\t\twordPosition\n\t\t\t\t);\n\t\t\t\tconst highlightedWord = this.originalText.substring(\n\t\t\t\t\twordPosition,\n\t\t\t\t\twordPosition + wordLength\n\t\t\t\t);\n\t\t\t\tconst afterText = this.originalText.substring(\n\t\t\t\t\twordPosition + wordLength\n\t\t\t\t);\n\n\t\t\t\t// Apply highlighting\n\t\t\t\tthis.highlightedElement.innerHTML = `${ beforeText }<span class=\"highlighted-word\">${ highlightedWord }</span>${ afterText }`;\n\t\t\t}\n\t\t};\n\n\t\tthis.utterance.onend = () => {\n\t\t\t// Reset highlighting when speech ends\n\t\t\tif ( this.highlightedElement ) {\n\t\t\t\tthis.highlightedElement.innerHTML = this.originalText;\n\t\t\t}\n\t\t};\n\n\t\tthis.synth.speak( this.utterance );\n\t}\n\n\tstop() {\n\t\tthis.synth.cancel();\n\t\tif ( this.highlightedElement ) {\n\t\t\tthis.highlightedElement.innerHTML = this.originalText;\n\t\t}\n\t}\n}\n"],"names":["store","getContext","state","actions","isPlaying","currentVoice","preferredVoice","window","localStorage","getItem","document","documentElement","lang","utterance","voices","currentSpeed","currentPitch","selectedTextRange","hasSelection","currentChunk","textChunks","isProcessingChunks","loadVoices","availableVoices","speechSynthesis","getVoices","length","setTimeout","currentLocale","localVoices","filter","voice","startsWith","find","v","voiceURI","createUtterance","content","getContent","newUtterance","SpeechSynthesisUtterance","rate","pitch","mainElement","querySelector","docView","ownerDocument","defaultView","selection","getSelection","onboundary","event","highlighted","querySelectorAll","forEach","wrapper","parent","parentNode","replaceChild","createTextNode","textContent","charIndex","charLength","rangeCount","range","getRangeAt","blockWrapper","highlightBackground","dataset","highlightColor","startOffset","endOffset","createElement","className","style","setProperty","word","substring","textNodes","walker","createTreeWalker","commonAncestorContainer","NodeFilter","SHOW_TEXT","node","nextNode","includes","push","textNode","nodeText","wordIndex","indexOf","nodeRange","createRange","setStart","setEnd","surroundContents","excludeClass","acceptNode","current","parentElement","classList","contains","FILTER_REJECT","FILTER_ACCEPT","charCount","nodeLength","e","onend","speak","updateUtterance","cancel","el","checkSynthesisReady","Promise","resolve","check","speaking","pending","then","Play","context","paused","resume","Pause","pause","Restart","changeVoice","target","value","setItem","changeSpeed","changePitch","toggleSettings","showSettings","toString","trim","text","cloneMain","cloneNode","skip","remove","chunkText","wordsPerChunk","words","split","chunks","i","chunk","slice","join","callbacks","init","onvoiceschanged","undefined","addEventListener","isSelected","TextToSpeechManager","constructor","highlightedElement","originalText","synth","element","name","innerHTML","wordPosition","wordLength","beforeText","highlightedWord","afterText","stop"],"sourceRoot":""}