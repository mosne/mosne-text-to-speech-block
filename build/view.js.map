{"version":3,"file":"view.js","mappings":"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","sources":["webpack://mosne-text-to-speech-block/external module \"@wordpress/interactivity\"","webpack://mosne-text-to-speech-block/webpack/bootstrap","webpack://mosne-text-to-speech-block/webpack/runtime/make namespace object","webpack://mosne-text-to-speech-block/./src/view.js"],"sourcesContent":["module.exports = __WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * WordPress dependencies\n */\nimport { store, getContext } from '@wordpress/interactivity';\n\n// Constants\nconst STORAGE_KEYS = {\n\tLANG: ( lang ) => `mosne-tts-lang-${ lang }`,\n\tSPEED: ( lang ) => `mosne-tts-speed-${ lang }`,\n\tPITCH: ( lang ) => `mosne-tts-pitch-${ lang }`,\n};\n\nconst DEFAULTS = {\n\tHIGHLIGHT_BG: '#ffeb3b',\n\tHIGHLIGHT_COLOR: '#000000',\n\tEXCLUDE_CLASS: 'skip-speech',\n\tWORDS_PER_CHUNK: 10,\n};\n\n// Helper functions\nconst getLocalStorageItem = ( key, defaultValue ) => {\n\ttry {\n\t\treturn window.localStorage.getItem( key ) || defaultValue;\n\t} catch ( e ) {\n\t\t// Handle private browsing mode in Safari\n\t\treturn defaultValue;\n\t}\n};\n\nconst getCurrentLocale = () => document.documentElement.lang || 'en';\n\nconst getBlockWrapper = () =>\n\tdocument.querySelector(\n\t\t'[data-wp-interactive=\"mosne-text-to-speech-block\"]'\n\t);\n\nconst getMainElement = () => document.querySelector( 'main' );\n\n// Detect browser for specific handling\nconst getBrowser = () => {\n\tconst userAgent = window.navigator.userAgent;\n\tif ( userAgent.indexOf( 'Firefox' ) !== -1 ) {\n\t\treturn 'firefox';\n\t}\n\tif (\n\t\tuserAgent.indexOf( 'Edge' ) !== -1 ||\n\t\tuserAgent.indexOf( 'Edg' ) !== -1\n\t) {\n\t\treturn 'edge';\n\t}\n\tif (\n\t\tuserAgent.indexOf( 'Safari' ) !== -1 &&\n\t\tuserAgent.indexOf( 'Chrome' ) === -1\n\t) {\n\t\treturn 'safari';\n\t}\n\tif ( userAgent.indexOf( 'Chrome' ) !== -1 ) {\n\t\treturn 'chrome';\n\t}\n\treturn 'other';\n};\n\nconst { state, actions } = store( 'mosne-text-to-speech-block', {\n\tstate: {\n\t\tisPlaying: false,\n\t\tcurrentVoice: null,\n\t\tpreferredVoice: getLocalStorageItem(\n\t\t\tSTORAGE_KEYS.LANG( getCurrentLocale() ),\n\t\t\tnull\n\t\t),\n\t\tutterance: null,\n\t\tvoices: [],\n\t\tcurrentSpeed: getLocalStorageItem(\n\t\t\tSTORAGE_KEYS.SPEED( getCurrentLocale() ),\n\t\t\t1\n\t\t),\n\t\tcurrentPitch: getLocalStorageItem(\n\t\t\tSTORAGE_KEYS.PITCH( getCurrentLocale() ),\n\t\t\t1\n\t\t),\n\t\tselectedTextRange: { hasSelection: false },\n\t\tcurrentChunk: 0,\n\t\ttextChunks: [],\n\t\tisProcessingChunks: false,\n\t\tcurrentHighlightedNode: null,\n\t\tnodePositions: new Map(),\n\t\tcurrentSelection: null,\n\t\tpausedAt: null,\n\t\tbrowserType: getBrowser(),\n\t\t// For Safari ping-pong to keep synthesis alive\n\t\tsafariKeepAliveTimer: null,\n\t},\n\tactions: {\n\t\t// Speech Synthesis Management\n\t\tcheckSynthesisReady() {\n\t\t\treturn new Promise( ( resolve ) => {\n\t\t\t\tconst check = () => {\n\t\t\t\t\tif (\n\t\t\t\t\t\t! window.speechSynthesis.speaking &&\n\t\t\t\t\t\t! window.speechSynthesis.pending\n\t\t\t\t\t) {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetTimeout( check, 100 );\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tcheck();\n\t\t\t} );\n\t\t},\n\n\t\t// Highlighting Management\n\t\tclearHighlights() {\n\t\t\tif ( state.currentSelection ) {\n\t\t\t\ttry {\n\t\t\t\t\tstate.currentSelection.removeAllRanges();\n\t\t\t\t} catch ( e ) {\n\t\t\t\t\t// Handle Edge/IE errors with selection\n\t\t\t\t\tconsole.warn( 'Error clearing highlights:', e );\n\t\t\t\t}\n\t\t\t\tstate.currentSelection = null;\n\t\t\t}\n\t\t\tstate.currentHighlightedNode = null;\n\t\t},\n\n\t\tcreateHighlightWrapper( node ) {\n\t\t\t// Use the node's document for selection to avoid global selection issues\n\t\t\tif ( ! node ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst doc = node.ownerDocument;\n\t\t\tconst docView = doc.defaultView;\n\n\t\t\tif ( ! docView ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Clear any existing selection\n\t\t\tactions.clearHighlights();\n\n\t\t\ttry {\n\t\t\t\t// Create a new range for the node text content\n\t\t\t\tconst range = doc.createRange();\n\n\t\t\t\t// Only select the text node's content instead of the entire node\n\t\t\t\tif ( node.nodeType === Node.TEXT_NODE ) {\n\t\t\t\t\trange.setStart( node, 0 );\n\t\t\t\t\trange.setEnd( node, node.length );\n\t\t\t\t} else {\n\t\t\t\t\trange.selectNodeContents( node );\n\t\t\t\t}\n\n\t\t\t\t// Apply the selection\n\t\t\t\tconst selection = docView.getSelection();\n\t\t\t\tif ( selection ) {\n\t\t\t\t\tselection.removeAllRanges();\n\t\t\t\t\tselection.addRange( range );\n\n\t\t\t\t\t// Store the current selection for cleanup\n\t\t\t\t\tstate.currentSelection = selection;\n\n\t\t\t\t\t// Apply CSS custom properties via selection styles\n\t\t\t\t\t// This uses the CSS variables we set on init\n\t\t\t\t\tif ( selection.rangeCount > 0 ) {\n\t\t\t\t\t\tselection.getRangeAt( 0 );\n\t\t\t\t\t\tselection.getRangeAt( 0 );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch ( e ) {\n\t\t\t\tconsole.warn( 'Error creating highlight:', e );\n\t\t\t}\n\t\t},\n\n\t\t// Voice Management\n\t\tasync loadVoices() {\n\t\t\t// For Safari/iOS, ensure we have access to voices\n\t\t\tif ( state.browserType === 'safari' ) {\n\t\t\t\t// Safari sometimes needs speech synthesis to be triggered first\n\t\t\t\twindow.speechSynthesis.speak(\n\t\t\t\t\tnew SpeechSynthesisUtterance( '' )\n\t\t\t\t);\n\t\t\t\twindow.speechSynthesis.cancel();\n\t\t\t}\n\n\t\t\tconst availableVoices = window.speechSynthesis.getVoices();\n\n\t\t\tif ( ! availableVoices?.length ) {\n\t\t\t\t// Try again in a bit - browsers load voices asynchronously\n\t\t\t\tsetTimeout( () => actions.loadVoices(), 100 );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentLocale = getCurrentLocale();\n\t\t\tconst localVoices = availableVoices.filter( ( voice ) =>\n\t\t\t\tvoice.lang.startsWith( currentLocale )\n\t\t\t);\n\n\t\t\tstate.voices =\n\t\t\t\tlocalVoices.length > 0 ? localVoices : availableVoices;\n\t\t\tstate.currentVoice = state.voices[ 0 ];\n\n\t\t\tif ( state.preferredVoice ) {\n\t\t\t\tconst voice = state.voices.find(\n\t\t\t\t\t( v ) => v.voiceURI === state.preferredVoice\n\t\t\t\t);\n\t\t\t\tif ( voice ) {\n\t\t\t\t\tstate.currentVoice = voice;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsetTimeout( () => actions.createUtterance(), 50 );\n\t\t},\n\n\t\t// Utterance Management\n\t\tcreateUtterance() {\n\t\t\t// Get the content for the current chunk\n\t\t\tconst content = state.textChunks[ state.currentChunk ];\n\t\t\tconst newUtterance = new window.SpeechSynthesisUtterance( content );\n\t\t\tnewUtterance.lang = getCurrentLocale();\n\t\t\tnewUtterance.rate = state.currentSpeed;\n\t\t\tnewUtterance.pitch = state.currentPitch;\n\n\t\t\tif ( state.currentVoice ) {\n\t\t\t\tconst voice = state.voices.find(\n\t\t\t\t\t( v ) => v.voiceURI === state.currentVoice.voiceURI\n\t\t\t\t);\n\t\t\t\tnewUtterance.voice = voice;\n\t\t\t}\n\n\t\t\tactions.setupUtteranceEvents( newUtterance, content );\n\t\t\tstate.utterance = newUtterance;\n\t\t},\n\n\t\tsetupUtteranceEvents( utterance, content ) {\n\t\t\t// Safari doesn't reliably fire boundary events, so use workarounds\n\t\t\tif ( state.browserType === 'safari' ) {\n\t\t\t\t// For Safari, we'll use word-level events and timeouts\n\t\t\t\tutterance.onboundary = ( event ) => {\n\t\t\t\t\t// Still try to use boundary events if they work\n\t\t\t\t\tutterance._lastCharIndex = event.charIndex || 0;\n\t\t\t\t\tactions.handleBoundaryEvent( event, content );\n\t\t\t\t};\n\n\t\t\t\t// Also add a timer-based highlighting as fallback for Safari\n\t\t\t\tutterance._safariTimerId =\n\t\t\t\t\tactions.setupSafariHighlighting( content );\n\t\t\t} else {\n\t\t\t\tutterance.onboundary = ( event ) => {\n\t\t\t\t\t// Save last character index for pause handling\n\t\t\t\t\tutterance._lastCharIndex = event.charIndex || 0;\n\n\t\t\t\t\t// If this utterance has a content offset (resumed utterance)\n\t\t\t\t\t// create an adjusted event with the correct character index\n\t\t\t\t\tconst adjustedEvent =\n\t\t\t\t\t\tutterance._contentOffset !== undefined\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t...event,\n\t\t\t\t\t\t\t\t\tcharIndex:\n\t\t\t\t\t\t\t\t\t\t( event.charIndex || 0 ) +\n\t\t\t\t\t\t\t\t\t\tutterance._contentOffset,\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t: event;\n\n\t\t\t\t\tactions.handleBoundaryEvent( adjustedEvent, content );\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tutterance.onend = () => {\n\t\t\t\t// Clear Safari timer if it exists\n\t\t\t\tif ( utterance._safariTimerId ) {\n\t\t\t\t\tclearInterval( utterance._safariTimerId );\n\t\t\t\t}\n\n\t\t\t\t// Check if there are more chunks to process\n\t\t\t\tif ( state.currentChunk < state.textChunks.length - 1 ) {\n\t\t\t\t\t// Move to next chunk\n\t\t\t\t\tstate.currentChunk++;\n\n\t\t\t\t\t// Create and speak the next utterance\n\t\t\t\t\tactions.createUtterance();\n\n\t\t\t\t\t// Small delay to ensure proper timing\n\t\t\t\t\tsetTimeout( () => {\n\t\t\t\t\t\tif ( state.isPlaying && state.utterance ) {\n\t\t\t\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 50 );\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// If we've reached the end of all chunks, perform cleanup\n\t\t\t\tstate.isPlaying = false;\n\t\t\t\tstate.currentChunk = 0;\n\t\t\t\tstate.textChunks = [];\n\t\t\t\tstate.currentHighlightedNode = null;\n\t\t\t\tstate.selectedTextRange = {\n\t\t\t\t\thasSelection: false,\n\t\t\t\t};\n\t\t\t};\n\n\t\t\t// Ensure we can track errors across browsers\n\t\t\tutterance.onerror = ( event ) => {\n\t\t\t\tconsole.error( 'Speech synthesis error:', event );\n\t\t\t\tactions.handleUtteranceEnd();\n\t\t\t};\n\t\t},\n\n\t\t// Safari-specific timer-based highlighting fallback\n\t\tsetupSafariHighlighting( content ) {\n\t\t\tif ( state.browserType !== 'safari' ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Estimate reading speed (chars per second)\n\t\t\tconst charsPerSecond = 15 * state.currentSpeed;\n\t\t\tconst intervalTime = 250; // Check every 250ms\n\n\t\t\tlet currentIndex = 0;\n\t\t\tconst timerId = setInterval( () => {\n\t\t\t\tif ( ! state.isPlaying ) {\n\t\t\t\t\tclearInterval( timerId );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Create a synthetic boundary event for Safari\n\t\t\t\tconst syntheticEvent = {\n\t\t\t\t\tcharIndex: currentIndex,\n\t\t\t\t\tcharLength: 1,\n\t\t\t\t};\n\n\t\t\t\tactions.handleBoundaryEvent( syntheticEvent, content );\n\n\t\t\t\t// Advance the position based on estimated reading speed\n\t\t\t\tcurrentIndex += Math.ceil(\n\t\t\t\t\t( charsPerSecond * intervalTime ) / 1000\n\t\t\t\t);\n\t\t\t}, intervalTime );\n\n\t\t\treturn timerId;\n\t\t},\n\n\t\t// Safari requires periodic \"ping\" to keep speech synthesis active\n\t\tsetupSafariKeepAlive() {\n\t\t\tif ( state.browserType !== 'safari' ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Clear any existing timer\n\t\t\tif ( state.safariKeepAliveTimer ) {\n\t\t\t\tclearInterval( state.safariKeepAliveTimer );\n\t\t\t}\n\n\t\t\t// Every 10 seconds, ping speechSynthesis to keep it alive\n\t\t\tstate.safariKeepAliveTimer = setInterval( () => {\n\t\t\t\tif ( state.isPlaying && window.speechSynthesis.speaking ) {\n\t\t\t\t\twindow.speechSynthesis.pause();\n\t\t\t\t\twindow.speechSynthesis.resume();\n\t\t\t\t} else {\n\t\t\t\t\tclearInterval( state.safariKeepAliveTimer );\n\t\t\t\t\tstate.safariKeepAliveTimer = null;\n\t\t\t\t}\n\t\t\t}, 10000 );\n\t\t},\n\n\t\t// Playback Controls\n\t\tasync Play() {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = true;\n\t\t\tstate.isPlaying = true;\n\n\t\t\t// Firefox resume handling\n\t\t\tif ( state.browserType === 'firefox' && state.pausedAt ) {\n\t\t\t\t// Create a new utterance from the paused position\n\t\t\t\tconst remainingText = state.pausedAt.text.substring(\n\t\t\t\t\tstate.pausedAt.charIndex\n\t\t\t\t);\n\n\t\t\t\t// Set the current chunk back to where we paused\n\t\t\t\tstate.currentChunk = state.pausedAt.chunk;\n\n\t\t\t\t// Create new utterance for the remaining text\n\t\t\t\tconst newUtterance = new window.SpeechSynthesisUtterance(\n\t\t\t\t\tremainingText\n\t\t\t\t);\n\t\t\t\tnewUtterance.lang = getCurrentLocale();\n\t\t\t\tnewUtterance.rate = state.currentSpeed;\n\t\t\t\tnewUtterance.pitch = state.currentPitch;\n\n\t\t\t\t// Initialize the last character index for the new utterance\n\t\t\t\tnewUtterance._lastCharIndex = 0;\n\n\t\t\t\t// Store the content offset for highlighting calculations\n\t\t\t\tnewUtterance._contentOffset = state.pausedAt.contentPosition;\n\n\t\t\t\tif ( state.currentVoice ) {\n\t\t\t\t\tconst voice = state.voices.find(\n\t\t\t\t\t\t( v ) => v.voiceURI === state.currentVoice.voiceURI\n\t\t\t\t\t);\n\t\t\t\t\tnewUtterance.voice = voice;\n\t\t\t\t}\n\n\t\t\t\t// Create a custom boundary handler specific to this resumed utterance\n\t\t\t\tnewUtterance.onboundary = ( event ) => {\n\t\t\t\t\t// Save last character index for pause handling\n\t\t\t\t\tnewUtterance._lastCharIndex = event.charIndex || 0;\n\n\t\t\t\t\t// Calculate the absolute position in the original content\n\t\t\t\t\tconst absolutePosition =\n\t\t\t\t\t\t( event.charIndex || 0 ) +\n\t\t\t\t\t\tstate.pausedAt.contentPosition;\n\n\t\t\t\t\t// Create an adjusted event with the correct character index\n\t\t\t\t\tconst adjustedEvent = {\n\t\t\t\t\t\t...event,\n\t\t\t\t\t\tcharIndex: absolutePosition,\n\t\t\t\t\t\t// Ensure charLength is always valid\n\t\t\t\t\t\tcharLength: event.charLength || 1,\n\t\t\t\t\t};\n\n\t\t\t\t\t// Pass to normal boundary handler but with full original text\n\t\t\t\t\tconst mainElement = getMainElement();\n\t\t\t\t\tif ( mainElement ) {\n\t\t\t\t\t\t// Force rebuild node positions to ensure synchronization\n\t\t\t\t\t\tconst blockWrapper = getBlockWrapper();\n\t\t\t\t\t\tconst excludeClassesStr =\n\t\t\t\t\t\t\tblockWrapper?.dataset.excludeClass ||\n\t\t\t\t\t\t\tDEFAULTS.EXCLUDE_CLASS;\n\n\t\t\t\t\t\tif ( state.nodePositions.size === 0 ) {\n\t\t\t\t\t\t\tactions.buildNodePositionsMap(\n\t\t\t\t\t\t\t\tmainElement,\n\t\t\t\t\t\t\t\texcludeClassesStr.split( /\\s+/ )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Handle the boundary event with the full content context\n\t\t\t\t\t\tactions.handleBoundaryEvent(\n\t\t\t\t\t\t\tadjustedEvent,\n\t\t\t\t\t\t\tstate.pausedAt.fullText || state.pausedAt.text\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tnewUtterance.onend = () => actions.handleUtteranceEnd();\n\n\t\t\t\tstate.utterance = newUtterance;\n\n\t\t\t\t// Speak the new utterance\n\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\n\t\t\t\t// In Safari, set up the keep-alive timer\n\t\t\t\tif ( state.browserType === 'safari' ) {\n\t\t\t\t\tactions.setupSafariKeepAlive();\n\t\t\t\t}\n\n\t\t\t\t// Clear the paused state\n\t\t\t\tstate.pausedAt = null;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( state.textChunks.length === 0 || state.currentChunk === 0 ) {\n\t\t\t\tactions.getContent();\n\t\t\t\tactions.createUtterance();\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tif ( window.speechSynthesis.paused ) {\n\t\t\t\t\twindow.speechSynthesis.resume();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} catch ( e ) {\n\t\t\t\tconsole.warn( 'Resume failed, recreating speech:', e );\n\t\t\t\t// If resume fails, recreate the utterance\n\t\t\t\tactions.createUtterance();\n\t\t\t}\n\n\t\t\t// Chrome and Edge fix - recreate utterance if speaking\n\t\t\tif (\n\t\t\t\tstate.browserType === 'chrome' ||\n\t\t\t\tstate.browserType === 'edge'\n\t\t\t) {\n\t\t\t\tif ( window.speechSynthesis.speaking ) {\n\t\t\t\t\twindow.speechSynthesis.cancel();\n\t\t\t\t\tsetTimeout( () => {\n\t\t\t\t\t\tif ( state.utterance ) {\n\t\t\t\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 50 );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( state.utterance ) {\n\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\n\t\t\t\t// In Safari, set up the keep-alive timer\n\t\t\t\tif ( state.browserType === 'safari' ) {\n\t\t\t\t\tactions.setupSafariKeepAlive();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tPause() {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = false;\n\t\t\tstate.isPlaying = false;\n\n\t\t\t// Firefox doesn't fully support pause, so we need to handle it differently\n\t\t\tif ( state.browserType === 'firefox' ) {\n\t\t\t\t// Store the current position\n\t\t\t\tif ( window.speechSynthesis.speaking ) {\n\t\t\t\t\t// Get the full text content for context\n\t\t\t\t\tconst fullText = state.textChunks.join( ' ' );\n\n\t\t\t\t\t// Save current speech state for later resuming\n\t\t\t\t\tstate.pausedAt = {\n\t\t\t\t\t\ttext: state.utterance.text,\n\t\t\t\t\t\tcharIndex: state.utterance._lastCharIndex || 0,\n\t\t\t\t\t\tchunk: state.currentChunk,\n\t\t\t\t\t\t// Track full content position to correctly restore highlighting\n\t\t\t\t\t\tcontentPosition:\n\t\t\t\t\t\t\tstate.utterance._lastCharIndex +\n\t\t\t\t\t\t\t( state.currentChunk > 0\n\t\t\t\t\t\t\t\t? state.textChunks\n\t\t\t\t\t\t\t\t\t\t.slice( 0, state.currentChunk )\n\t\t\t\t\t\t\t\t\t\t.reduce(\n\t\t\t\t\t\t\t\t\t\t\t( sum, chunk ) =>\n\t\t\t\t\t\t\t\t\t\t\t\tsum + chunk.length,\n\t\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t: 0 ),\n\t\t\t\t\t\t// Store full text for better context on resume\n\t\t\t\t\t\tfullText,\n\t\t\t\t\t};\n\n\t\t\t\t\t// Cancel current speech\n\t\t\t\t\twindow.speechSynthesis.cancel();\n\t\t\t\t}\n\t\t\t} else if ( state.browserType === 'safari' ) {\n\t\t\t\t// Safari's pause is also unreliable\n\t\t\t\tif ( window.speechSynthesis.speaking ) {\n\t\t\t\t\t// Get the full text content for context\n\t\t\t\t\tconst fullText = state.textChunks.join( ' ' );\n\n\t\t\t\t\t// Save position like Firefox\n\t\t\t\t\tstate.pausedAt = {\n\t\t\t\t\t\ttext: state.utterance.text,\n\t\t\t\t\t\tcharIndex: state.utterance._lastCharIndex || 0,\n\t\t\t\t\t\tchunk: state.currentChunk,\n\t\t\t\t\t\tcontentPosition:\n\t\t\t\t\t\t\tstate.utterance._lastCharIndex +\n\t\t\t\t\t\t\t( state.currentChunk > 0\n\t\t\t\t\t\t\t\t? state.textChunks\n\t\t\t\t\t\t\t\t\t\t.slice( 0, state.currentChunk )\n\t\t\t\t\t\t\t\t\t\t.reduce(\n\t\t\t\t\t\t\t\t\t\t\t( sum, chunk ) =>\n\t\t\t\t\t\t\t\t\t\t\t\tsum + chunk.length,\n\t\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t: 0 ),\n\t\t\t\t\t\t// Store full text for better context on resume\n\t\t\t\t\t\tfullText,\n\t\t\t\t\t};\n\n\t\t\t\t\t// Clear any Safari timers\n\t\t\t\t\tif ( state.utterance._safariTimerId ) {\n\t\t\t\t\t\tclearInterval( state.utterance._safariTimerId );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( state.safariKeepAliveTimer ) {\n\t\t\t\t\t\tclearInterval( state.safariKeepAliveTimer );\n\t\t\t\t\t\tstate.safariKeepAliveTimer = null;\n\t\t\t\t\t}\n\n\t\t\t\t\twindow.speechSynthesis.cancel();\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\twindow.speechSynthesis.speaking &&\n\t\t\t\t! window.speechSynthesis.paused\n\t\t\t) {\n\t\t\t\t// Standard pause for Chrome and other browsers - fixed lonely if\n\t\t\t\twindow.speechSynthesis.pause();\n\t\t\t}\n\t\t},\n\n\t\tRestart() {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = false;\n\t\t\tstate.isPlaying = false;\n\n\t\t\t// Clear any Safari timers\n\t\t\tif ( state.browserType === 'safari' ) {\n\t\t\t\tif ( state.utterance && state.utterance._safariTimerId ) {\n\t\t\t\t\tclearInterval( state.utterance._safariTimerId );\n\t\t\t\t}\n\n\t\t\t\tif ( state.safariKeepAliveTimer ) {\n\t\t\t\t\tclearInterval( state.safariKeepAliveTimer );\n\t\t\t\t\tstate.safariKeepAliveTimer = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twindow.speechSynthesis.cancel();\n\n\t\t\tstate.currentChunk = 0;\n\t\t\tstate.textChunks = [];\n\n\t\t\tactions.clearHighlights();\n\t\t},\n\t\tchangeVoice( e ) {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = false;\n\n\t\t\t// Cancel any ongoing speech\n\t\t\twindow.speechSynthesis.cancel();\n\n\t\t\tconst voice = state.voices.find(\n\t\t\t\t( v ) => v.voiceURI === e.target.value\n\t\t\t);\n\n\t\t\tif ( voice ) {\n\t\t\t\tstate.currentVoice = voice;\n\t\t\t\twindow.localStorage.setItem(\n\t\t\t\t\t'mosne-tts-lang-' + document.documentElement.lang,\n\t\t\t\t\tvoice.voiceURI\n\t\t\t\t);\n\n\t\t\t\t// Small delay to ensure speech synthesis is ready\n\t\t\t\tsetTimeout( () => {\n\t\t\t\t\tactions.updateUtterance();\n\t\t\t\t}, 50 );\n\t\t\t}\n\t\t},\n\t\tasync changeSpeed( e ) {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = false;\n\t\t\twindow.speechSynthesis.cancel();\n\n\t\t\tstate.currentSpeed = e.target.value;\n\t\t\twindow.localStorage.setItem(\n\t\t\t\t'mosne-tts-speed-' + document.documentElement.lang,\n\t\t\t\te.target.value\n\t\t\t);\n\n\t\t\tawait actions.checkSynthesisReady();\n\t\t\tactions.createUtterance();\n\n\t\t\tif ( context.isPlaying ) {\n\t\t\t\tsetTimeout( () => {\n\t\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t\t\t}, 50 );\n\t\t\t}\n\t\t},\n\t\tasync changePitch( e ) {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = false;\n\t\t\twindow.speechSynthesis.cancel();\n\n\t\t\tstate.currentPitch = e.target.value;\n\t\t\twindow.localStorage.setItem(\n\t\t\t\t'mosne-tts-pitch-' + document.documentElement.lang,\n\t\t\t\te.target.value\n\t\t\t);\n\n\t\t\tawait actions.checkSynthesisReady();\n\t\t\tactions.createUtterance();\n\n\t\t\tif ( context.isPlaying ) {\n\t\t\t\tsetTimeout( () => {\n\t\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t\t\t}, 50 );\n\t\t\t}\n\t\t},\n\t\ttoggleSettings() {\n\t\t\tconst context = getContext();\n\t\t\tcontext.showSettings = ! context.showSettings;\n\t\t},\n\t\tgetContent() {\n\t\t\t// Check if there is highlighted text\n\t\t\tconst mainElement = getMainElement();\n\t\t\tconst docView = mainElement?.ownerDocument.defaultView;\n\t\t\tconst selection = docView ? docView.getSelection() : null;\n\t\t\tlet content = '';\n\n\t\t\tif ( selection && selection.toString().trim().length > 0 ) {\n\t\t\t\t// Get selected text\n\t\t\t\tcontent = selection.toString();\n\t\t\t\tstate.selectedTextRange = {\n\t\t\t\t\ttext: content,\n\t\t\t\t\thasSelection: true,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\t// Get content from main element\n\t\t\t\tlet cloneMain = mainElement?.cloneNode( true );\n\t\t\t\tif ( cloneMain ) {\n\t\t\t\t\t// Use the same exclude classes logic for consistency\n\t\t\t\t\tconst blockWrapper = getBlockWrapper();\n\t\t\t\t\tconst excludeClassesStr =\n\t\t\t\t\t\tblockWrapper?.dataset.excludeClass ||\n\t\t\t\t\t\tDEFAULTS.EXCLUDE_CLASS;\n\t\t\t\t\tconst excludeClasses = excludeClassesStr.split( /\\s+/ );\n\n\t\t\t\t\t// Remove all elements with excluded classes\n\t\t\t\t\texcludeClasses.forEach( ( excludeClass ) => {\n\t\t\t\t\t\tif ( excludeClass ) {\n\t\t\t\t\t\t\tconst skip = cloneMain.querySelectorAll(\n\t\t\t\t\t\t\t\t`.${ excludeClass }`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tskip.forEach( ( el ) => {\n\t\t\t\t\t\t\t\tel.remove();\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t\tcontent = cloneMain.textContent;\n\t\t\t\t\tcloneMain = null;\n\n\t\t\t\t\t// Pre-build the node position map for faster highlighting\n\t\t\t\t\tif ( mainElement ) {\n\t\t\t\t\t\tactions.buildNodePositionsMap(\n\t\t\t\t\t\t\tmainElement,\n\t\t\t\t\t\t\texcludeClassesStr.split( /\\s+/ )\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tstate.selectedTextRange = {\n\t\t\t\t\thasSelection: false,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Process content into chunks of approximately 200 words\n\t\t\tstate.textChunks = actions.chunkText(\n\t\t\t\tcontent,\n\t\t\t\tDEFAULTS.WORDS_PER_CHUNK\n\t\t\t);\n\t\t\tstate.currentChunk = 0;\n\n\t\t\t// Return the first chunk to start with\n\t\t\treturn state.textChunks.length > 0 ? state.textChunks[ 0 ] : '';\n\t\t},\n\t\t// New method to chunk text into approximately word-sized pieces\n\t\tchunkText( text, wordsPerChunk ) {\n\t\t\tif ( ! text || text.trim() === '' ) {\n\t\t\t\treturn [ '' ];\n\t\t\t}\n\n\t\t\t// Split the text into words\n\t\t\tconst words = text.trim().split( /\\s+/ );\n\t\t\tconst chunks = [];\n\n\t\t\t// Create chunks of approximately wordsPerChunk words\n\t\t\tfor ( let i = 0; i < words.length; i += wordsPerChunk ) {\n\t\t\t\tconst chunk = words.slice( i, i + wordsPerChunk ).join( ' ' );\n\t\t\t\tchunks.push( chunk );\n\t\t\t}\n\n\t\t\treturn chunks;\n\t\t},\n\t\thandleBoundaryEvent( event, content ) {\n\t\t\tconst mainElement = getMainElement();\n\t\t\tif ( ! mainElement ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Safety check for valid boundary event\n\t\t\tif (\n\t\t\t\tevent.charIndex === undefined ||\n\t\t\t\tevent.charLength === undefined ||\n\t\t\t\tevent.charIndex + event.charLength > content.length\n\t\t\t) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t'Invalid boundary event or position out of content bounds'\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tif ( state.selectedTextRange?.hasSelection ) {\n\t\t\t\t\t// Handle selected text case...\n\t\t\t\t} else {\n\t\t\t\t\t// Handle main content highlighting\n\t\t\t\t\tconst blockWrapper = getBlockWrapper();\n\t\t\t\t\tconst excludeClassesStr =\n\t\t\t\t\t\tblockWrapper?.dataset.excludeClass ||\n\t\t\t\t\t\tDEFAULTS.EXCLUDE_CLASS;\n\t\t\t\t\tconst excludeClasses = excludeClassesStr.split( /\\s+/ );\n\n\t\t\t\t\t// Optimize node finding by using a cached map of text nodes if available\n\t\t\t\t\tif ( state.nodePositions.size === 0 ) {\n\t\t\t\t\t\t// Build node positions map on first use\n\t\t\t\t\t\tactions.buildNodePositionsMap(\n\t\t\t\t\t\t\tmainElement,\n\t\t\t\t\t\t\texcludeClasses\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Find the node containing the current position using the optimized map\n\t\t\t\t\tconst charPosition = event.charIndex;\n\t\t\t\t\tlet targetNode = null;\n\t\t\t\t\tlet bestMatch = {\n\t\t\t\t\t\tnode: null,\n\t\t\t\t\t\tdistance: Number.MAX_SAFE_INTEGER,\n\t\t\t\t\t};\n\n\t\t\t\t\t// Find the closest position in the map\n\t\t\t\t\tconst positions = Array.from(\n\t\t\t\t\t\tstate.nodePositions.keys()\n\t\t\t\t\t).sort( ( a, b ) => a - b );\n\n\t\t\t\t\tfor ( let i = 0; i < positions.length; i++ ) {\n\t\t\t\t\t\tconst pos = positions[ i ];\n\t\t\t\t\t\tconst nodeData = state.nodePositions.get( pos );\n\n\t\t\t\t\t\t// Exact match\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tpos <= charPosition &&\n\t\t\t\t\t\t\tcharPosition < pos + nodeData.length\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\ttargetNode = nodeData.node;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// For Firefox, also track approximate matches as fallback\n\t\t\t\t\t\tif ( state.browserType === 'firefox' ) {\n\t\t\t\t\t\t\t// Calculate distance to this node's position\n\t\t\t\t\t\t\tconst distance = Math.abs( pos - charPosition );\n\t\t\t\t\t\t\tif ( distance < bestMatch.distance ) {\n\t\t\t\t\t\t\t\tbestMatch = { node: nodeData.node, distance };\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// For Firefox, use the best approximate match if no exact match found\n\t\t\t\t\tif (\n\t\t\t\t\t\t! targetNode &&\n\t\t\t\t\t\tstate.browserType === 'firefox' &&\n\t\t\t\t\t\tbestMatch.node\n\t\t\t\t\t) {\n\t\t\t\t\t\ttargetNode = bestMatch.node;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Only update highlight if we've found a new leaf node\n\t\t\t\t\tif (\n\t\t\t\t\t\ttargetNode &&\n\t\t\t\t\t\ttargetNode !== state.currentHighlightedNode &&\n\t\t\t\t\t\ttargetNode.textContent.trim().length > 0\n\t\t\t\t\t) {\n\t\t\t\t\t\t// Clear previous highlight\n\t\t\t\t\t\tactions.clearHighlights();\n\n\t\t\t\t\t\t// Create new highlight using selection\n\t\t\t\t\t\tactions.createHighlightWrapper( targetNode );\n\n\t\t\t\t\t\t// Update current node reference\n\t\t\t\t\t\tstate.currentHighlightedNode = targetNode;\n\n\t\t\t\t\t\t// Scroll the highlighted word into view if needed\n\t\t\t\t\t\tif ( targetNode.nodeType !== Node.TEXT_NODE ) {\n\t\t\t\t\t\t\ttargetNode.scrollIntoView( {\n\t\t\t\t\t\t\t\tbehavior: 'smooth',\n\t\t\t\t\t\t\t\tblock: 'center',\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} else if ( targetNode.parentNode ) {\n\t\t\t\t\t\t\ttargetNode.parentNode.scrollIntoView( {\n\t\t\t\t\t\t\t\tbehavior: 'smooth',\n\t\t\t\t\t\t\t\tblock: 'center',\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch ( e ) {\n\t\t\t\tconsole.error( 'Highlighting error:', e );\n\t\t\t}\n\t\t},\n\t\thandleUtteranceEnd() {\n\t\t\t// Clear any remaining highlights\n\t\t\tactions.clearHighlights();\n\n\t\t\t// Update playing state\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = false;\n\t\t\tstate.isPlaying = false;\n\n\t\t\t// Reset chunk tracking\n\t\t\tstate.currentChunk = 0;\n\t\t\tstate.textChunks = [];\n\n\t\t\t// Reset highlight tracking\n\t\t\tstate.currentHighlightedNode = null;\n\n\t\t\t// Clear selected text range\n\t\t\tstate.selectedTextRange = {\n\t\t\t\thasSelection: false,\n\t\t\t};\n\t\t},\n\t\t// Add a new method to build the node positions map more efficiently\n\t\tbuildNodePositionsMap( rootElement, excludeClasses ) {\n\t\t\tstate.nodePositions.clear();\n\n\t\t\t// Optimized node collection with filtering\n\t\t\tconst collectTextNodes = ( element, charCount = 0 ) => {\n\t\t\t\t// Skip excluded elements\n\t\t\t\tif ( element.classList ) {\n\t\t\t\t\tfor ( const excludeClass of excludeClasses ) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\texcludeClass &&\n\t\t\t\t\t\t\telement.classList.contains( excludeClass )\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\treturn charCount;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Process text nodes\n\t\t\t\tif ( element.nodeType === Node.TEXT_NODE ) {\n\t\t\t\t\tconst text = element.textContent;\n\t\t\t\t\tif ( text.trim().length > 0 ) {\n\t\t\t\t\t\tstate.nodePositions.set( charCount, {\n\t\t\t\t\t\t\tnode: element,\n\t\t\t\t\t\t\tlength: text.length,\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tcharCount += text.length;\n\t\t\t\t\t}\n\t\t\t\t\treturn charCount;\n\t\t\t\t}\n\n\t\t\t\t// Process element children\n\t\t\t\tif ( element.childNodes && element.childNodes.length > 0 ) {\n\t\t\t\t\tfor ( const child of element.childNodes ) {\n\t\t\t\t\t\tcharCount = collectTextNodes( child, charCount );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn charCount;\n\t\t\t};\n\n\t\t\t// Start the collection process\n\t\t\tcollectTextNodes( rootElement );\n\t\t},\n\t},\n\tcallbacks: {\n\t\tinit() {\n\t\t\tif ( ! window.speechSynthesis ) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t'Speech synthesis not supported in this browser'\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Cancel any ongoing speech\n\t\t\twindow.speechSynthesis.cancel();\n\n\t\t\t// Detect browser type\n\t\t\tstate.browserType = getBrowser();\n\n\t\t\t// Initialize highlight colors once at startup\n\t\t\tinitHighlightColors();\n\n\t\t\t// Load available voices\n\t\t\tactions.loadVoices();\n\n\t\t\tif ( window.speechSynthesis.onvoiceschanged !== undefined ) {\n\t\t\t\twindow.speechSynthesis.onvoiceschanged = actions.loadVoices;\n\t\t\t}\n\n\t\t\twindow.addEventListener( 'beforeunload', () => {\n\t\t\t\twindow.speechSynthesis.cancel();\n\n\t\t\t\t// Clear any Safari timers\n\t\t\t\tif ( state.browserType === 'safari' ) {\n\t\t\t\t\tif ( state.utterance && state.utterance._safariTimerId ) {\n\t\t\t\t\t\tclearInterval( state.utterance._safariTimerId );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( state.safariKeepAliveTimer ) {\n\t\t\t\t\t\tclearInterval( state.safariKeepAliveTimer );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\t// Initial node map building for better performance when playback starts\n\t\t\tconst mainElement = getMainElement();\n\t\t\tif ( mainElement ) {\n\t\t\t\tconst blockWrapper = getBlockWrapper();\n\t\t\t\tconst excludeClassesStr =\n\t\t\t\t\tblockWrapper?.dataset.excludeClass ||\n\t\t\t\t\tDEFAULTS.EXCLUDE_CLASS;\n\t\t\t\tsetTimeout( () => {\n\t\t\t\t\tactions.buildNodePositionsMap(\n\t\t\t\t\t\tmainElement,\n\t\t\t\t\t\texcludeClassesStr.split( /\\s+/ )\n\t\t\t\t\t);\n\t\t\t\t}, 500 ); // Delay to ensure DOM is ready\n\t\t\t}\n\t\t},\n\t\tisSelected() {\n\t\t\tconst context = getContext();\n\t\t\treturn context.voice.voiceURI === state.currentVoice.voiceURI;\n\t\t},\n\t},\n} );\n\n// Add this function after the helper functions at the top\nconst initHighlightColors = () => {\n\tconst mainElement = getMainElement();\n\tconst blockWrapper = getBlockWrapper();\n\n\tif ( ! mainElement || ! blockWrapper ) {\n\t\treturn;\n\t}\n\n\t// Get highlight colors from block settings or use defaults\n\tconst highlightBackground =\n\t\tblockWrapper.dataset.highlightBackground || DEFAULTS.HIGHLIGHT_BG;\n\tconst highlightColor =\n\t\tblockWrapper.dataset.highlightColor || DEFAULTS.HIGHLIGHT_COLOR;\n\n\t// Set CSS custom properties on the main element for easier styling\n\tmainElement.style.setProperty(\n\t\t'--mosne-tts-highlight-bg',\n\t\thighlightBackground\n\t);\n\tmainElement.style.setProperty(\n\t\t'--mosne-tts-highlight-color',\n\t\thighlightColor\n\t);\n};\n"],"names":["store","getContext","STORAGE_KEYS","LANG","lang","SPEED","PITCH","DEFAULTS","HIGHLIGHT_BG","HIGHLIGHT_COLOR","EXCLUDE_CLASS","WORDS_PER_CHUNK","getLocalStorageItem","key","defaultValue","window","localStorage","getItem","e","getCurrentLocale","document","documentElement","getBlockWrapper","querySelector","getMainElement","getBrowser","userAgent","navigator","indexOf","state","actions","isPlaying","currentVoice","preferredVoice","utterance","voices","currentSpeed","currentPitch","selectedTextRange","hasSelection","currentChunk","textChunks","isProcessingChunks","currentHighlightedNode","nodePositions","Map","currentSelection","pausedAt","browserType","safariKeepAliveTimer","checkSynthesisReady","Promise","resolve","check","speechSynthesis","speaking","pending","setTimeout","clearHighlights","removeAllRanges","console","warn","createHighlightWrapper","node","doc","ownerDocument","docView","defaultView","range","createRange","nodeType","Node","TEXT_NODE","setStart","setEnd","length","selectNodeContents","selection","getSelection","addRange","rangeCount","getRangeAt","loadVoices","speak","SpeechSynthesisUtterance","cancel","availableVoices","getVoices","currentLocale","localVoices","filter","voice","startsWith","find","v","voiceURI","createUtterance","content","newUtterance","rate","pitch","setupUtteranceEvents","onboundary","event","_lastCharIndex","charIndex","handleBoundaryEvent","_safariTimerId","setupSafariHighlighting","adjustedEvent","_contentOffset","undefined","onend","clearInterval","onerror","error","handleUtteranceEnd","charsPerSecond","intervalTime","currentIndex","timerId","setInterval","syntheticEvent","charLength","Math","ceil","setupSafariKeepAlive","pause","resume","Play","context","remainingText","text","substring","chunk","contentPosition","absolutePosition","mainElement","blockWrapper","excludeClassesStr","dataset","excludeClass","size","buildNodePositionsMap","split","fullText","getContent","paused","Pause","join","slice","reduce","sum","Restart","changeVoice","target","value","setItem","updateUtterance","changeSpeed","changePitch","toggleSettings","showSettings","toString","trim","cloneMain","cloneNode","excludeClasses","forEach","skip","querySelectorAll","el","remove","textContent","chunkText","wordsPerChunk","words","chunks","i","push","charPosition","targetNode","bestMatch","distance","Number","MAX_SAFE_INTEGER","positions","Array","from","keys","sort","a","b","pos","nodeData","get","abs","scrollIntoView","behavior","block","parentNode","rootElement","clear","collectTextNodes","element","charCount","classList","contains","set","childNodes","child","callbacks","init","initHighlightColors","onvoiceschanged","addEventListener","isSelected","highlightBackground","highlightColor","style","setProperty"],"sourceRoot":""}