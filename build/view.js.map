{"version":3,"file":"view.js","mappings":"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","sources":["webpack://mosne-text-to-speech-block/./src/view/actions/content.js","webpack://mosne-text-to-speech-block/./src/view/actions/highlight.js","webpack://mosne-text-to-speech-block/./src/view/actions/index.js","webpack://mosne-text-to-speech-block/./src/view/actions/playback.js","webpack://mosne-text-to-speech-block/./src/view/actions/synthesis.js","webpack://mosne-text-to-speech-block/./src/view/actions/utterance.js","webpack://mosne-text-to-speech-block/./src/view/actions/voice.js","webpack://mosne-text-to-speech-block/./src/view/callbacks.js","webpack://mosne-text-to-speech-block/./src/view/constants.js","webpack://mosne-text-to-speech-block/./src/view/state.js","webpack://mosne-text-to-speech-block/./src/view/utils.js","webpack://mosne-text-to-speech-block/external module \"@wordpress/interactivity\"","webpack://mosne-text-to-speech-block/webpack/bootstrap","webpack://mosne-text-to-speech-block/webpack/runtime/define property getters","webpack://mosne-text-to-speech-block/webpack/runtime/hasOwnProperty shorthand","webpack://mosne-text-to-speech-block/webpack/runtime/make namespace object","webpack://mosne-text-to-speech-block/./src/view.js"],"sourcesContent":["/**\n * Content processing actions\n */\n\nimport { DEFAULTS } from '../constants';\nimport { getBlockWrapper, getMainElement } from '../utils';\nimport { buildNodePositionsMap } from './highlight';\n\nexport const getContent = ( state ) => {\n\t// Check if there is highlighted text\n\tconst mainElement = getMainElement();\n\tconst docView = mainElement?.ownerDocument.defaultView;\n\tconst selection = docView ? docView.getSelection() : null;\n\tlet content = '';\n\n\tif ( selection && selection.toString().trim().length > 0 ) {\n\t\t// Get selected text\n\t\tcontent = selection.toString();\n\t\tstate.selectedTextRange = {\n\t\t\ttext: content,\n\t\t\thasSelection: true,\n\t\t};\n\t} else {\n\t\t// Get content from main element\n\t\tlet cloneMain = mainElement?.cloneNode( true );\n\t\tif ( cloneMain ) {\n\t\t\t// Use the same exclude classes logic for consistency\n\t\t\tconst blockWrapper = getBlockWrapper();\n\t\t\tconst excludeClassesStr =\n\t\t\t\tblockWrapper?.dataset.excludeClass || DEFAULTS.EXCLUDE_CLASS;\n\t\t\tconst excludeClasses = excludeClassesStr.split( /\\s+/ );\n\n\t\t\t// Remove all elements with excluded classes\n\t\t\texcludeClasses.forEach( ( excludeClass ) => {\n\t\t\t\tif ( excludeClass ) {\n\t\t\t\t\tconst skip = cloneMain.querySelectorAll(\n\t\t\t\t\t\t`.${ excludeClass }`\n\t\t\t\t\t);\n\t\t\t\t\tskip.forEach( ( el ) => {\n\t\t\t\t\t\tel.remove();\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\tcontent = cloneMain.textContent;\n\t\t\tcloneMain = null;\n\n\t\t\t// Pre-build the node position map for faster highlighting\n\t\t\tif ( mainElement ) {\n\t\t\t\tbuildNodePositionsMap(\n\t\t\t\t\tstate,\n\t\t\t\t\tmainElement,\n\t\t\t\t\texcludeClassesStr.split( /\\s+/ )\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tstate.selectedTextRange = {\n\t\t\thasSelection: false,\n\t\t};\n\t}\n\n\t// Process content into chunks of approximately 200 words\n\tstate.textChunks = chunkText( content, DEFAULTS.WORDS_PER_CHUNK );\n\tstate.currentChunk = 0;\n\n\t// Return the first chunk to start with\n\treturn state.textChunks.length > 0 ? state.textChunks[ 0 ] : '';\n};\n\n// Method to chunk text into approximately word-sized pieces\nexport const chunkText = ( text, wordsPerChunk ) => {\n\tif ( ! text || text.trim() === '' ) {\n\t\treturn [ '' ];\n\t}\n\n\t// Split the text into words\n\tconst words = text.trim().split( /\\s+/ );\n\tconst chunks = [];\n\n\t// Create chunks of approximately wordsPerChunk words\n\tfor ( let i = 0; i < words.length; i += wordsPerChunk ) {\n\t\tconst chunk = words.slice( i, i + wordsPerChunk ).join( ' ' );\n\t\tchunks.push( chunk );\n\t}\n\n\treturn chunks;\n};\n","/**\n * Highlighting management actions\n */\n\nimport { DEFAULTS } from '../constants';\nimport { getBlockWrapper, getMainElement } from '../utils';\n\n// Highlighting Management\nexport const clearHighlights = ( state ) => {\n\tif ( state.currentSelection ) {\n\t\ttry {\n\t\t\tstate.currentSelection.removeAllRanges();\n\t\t} catch ( e ) {\n\t\t\t// Handle Edge/IE errors with selection\n\t\t\tconsole.warn( 'Error clearing highlights:', e );\n\t\t}\n\t\tstate.currentSelection = null;\n\t}\n\tstate.currentHighlightedNode = null;\n};\n\nexport const createHighlightWrapper = ( state, node ) => {\n\t// Use the node's document for selection to avoid global selection issues\n\tif ( ! node ) {\n\t\treturn null;\n\t}\n\n\tconst doc = node.ownerDocument;\n\tconst docView = doc.defaultView;\n\n\tif ( ! docView ) {\n\t\treturn null;\n\t}\n\n\t// Clear any existing selection\n\tclearHighlights( state );\n\n\ttry {\n\t\t// Create a new range for the node text content\n\t\tconst range = doc.createRange();\n\n\t\t// Only select the text node's content instead of the entire node\n\t\tif ( node.nodeType === Node.TEXT_NODE ) {\n\t\t\trange.setStart( node, 0 );\n\t\t\trange.setEnd( node, node.length );\n\t\t} else {\n\t\t\trange.selectNodeContents( node );\n\t\t}\n\n\t\t// Apply the selection\n\t\tconst selection = docView.getSelection();\n\t\tif ( selection ) {\n\t\t\tselection.removeAllRanges();\n\t\t\tselection.addRange( range );\n\n\t\t\t// Store the current selection for cleanup\n\t\t\tstate.currentSelection = selection;\n\n\t\t\t// Apply CSS custom properties via selection styles\n\t\t\t// This uses the CSS variables we set on init\n\t\t\tif ( selection.rangeCount > 0 ) {\n\t\t\t\tselection.getRangeAt( 0 );\n\t\t\t\tselection.getRangeAt( 0 );\n\t\t\t}\n\t\t}\n\t} catch ( e ) {\n\t\tconsole.warn( 'Error creating highlight:', e );\n\t}\n};\n\n// Safari-specific timer-based highlighting fallback\nexport const setupSafariHighlighting = ( state, content ) => {\n\tif ( state.browserType !== 'safari' ) {\n\t\treturn null;\n\t}\n\n\t// Estimate reading speed (chars per second)\n\tconst charsPerSecond = 15 * state.currentSpeed;\n\tconst intervalTime = 250; // Check every 250ms\n\n\tlet currentIndex = 0;\n\tconst timerId = setInterval( () => {\n\t\tif ( ! state.isPlaying ) {\n\t\t\tclearInterval( timerId );\n\t\t\treturn;\n\t\t}\n\n\t\t// Create a synthetic boundary event for Safari\n\t\tconst syntheticEvent = {\n\t\t\tcharIndex: currentIndex,\n\t\t\tcharLength: 1,\n\t\t};\n\n\t\thandleBoundaryEvent( state, syntheticEvent, content );\n\n\t\t// Advance the position based on estimated reading speed\n\t\tcurrentIndex += Math.ceil( ( charsPerSecond * intervalTime ) / 1000 );\n\t}, intervalTime );\n\n\treturn timerId;\n};\n\nexport const handleBoundaryEvent = ( state, event ) => {\n\tconst mainElement = getMainElement();\n\tif ( ! mainElement ) {\n\t\treturn;\n\t}\n\n\ttry {\n\t\t// Calculate the absolute position by adding offsets of previous chunks\n\t\tlet absoluteCharIndex = event.charIndex;\n\t\tif ( state.currentChunk > 0 ) {\n\t\t\t// Add lengths of all previous chunks\n\t\t\tfor ( let i = 0; i < state.currentChunk; i++ ) {\n\t\t\t\tabsoluteCharIndex += state.textChunks[ i ].length + 1; // +1 for space between chunks\n\t\t\t}\n\t\t}\n\n\t\tif ( state.selectedTextRange?.hasSelection ) {\n\t\t\t// Handle selected text case...\n\t\t} else {\n\t\t\t// Handle main content highlighting\n\t\t\tconst blockWrapper = getBlockWrapper();\n\t\t\tconst excludeClassesStr =\n\t\t\t\tblockWrapper?.dataset.excludeClass || DEFAULTS.EXCLUDE_CLASS;\n\t\t\tconst excludeClasses = excludeClassesStr.split( /\\s+/ );\n\n\t\t\t// Rebuild node positions map if empty\n\t\t\tif ( state.nodePositions.size === 0 ) {\n\t\t\t\tbuildNodePositionsMap( state, mainElement, excludeClasses );\n\t\t\t}\n\n\t\t\t// Find the node containing the current absolute position\n\t\t\tlet targetNode = null;\n\t\t\tlet bestMatch = {\n\t\t\t\tnode: null,\n\t\t\t\tdistance: Number.MAX_SAFE_INTEGER,\n\t\t\t};\n\n\t\t\t// Find the closest position in the map using absolute position\n\t\t\tconst positions = Array.from( state.nodePositions.keys() ).sort(\n\t\t\t\t( a, b ) => a - b\n\t\t\t);\n\n\t\t\tfor ( let i = 0; i < positions.length; i++ ) {\n\t\t\t\tconst pos = positions[ i ];\n\t\t\t\tconst nodeData = state.nodePositions.get( pos );\n\n\t\t\t\t// Exact match using absolute position\n\t\t\t\tif (\n\t\t\t\t\tpos <= absoluteCharIndex &&\n\t\t\t\t\tabsoluteCharIndex < pos + nodeData.length\n\t\t\t\t) {\n\t\t\t\t\ttargetNode = nodeData.node;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// For Firefox, track approximate matches as fallback\n\t\t\t\tif ( state.browserType === 'firefox' ) {\n\t\t\t\t\tconst distance = Math.abs( pos - absoluteCharIndex );\n\t\t\t\t\tif ( distance < bestMatch.distance ) {\n\t\t\t\t\t\tbestMatch = { node: nodeData.node, distance };\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Use best approximate match for Firefox if no exact match\n\t\t\tif (\n\t\t\t\t! targetNode &&\n\t\t\t\tstate.browserType === 'firefox' &&\n\t\t\t\tbestMatch.node\n\t\t\t) {\n\t\t\t\ttargetNode = bestMatch.node;\n\t\t\t}\n\n\t\t\t// Update highlight if we found a new node\n\t\t\tif (\n\t\t\t\ttargetNode &&\n\t\t\t\ttargetNode !== state.currentHighlightedNode &&\n\t\t\t\ttargetNode.textContent.trim().length > 0\n\t\t\t) {\n\t\t\t\tclearHighlights( state );\n\t\t\t\tcreateHighlightWrapper( state, targetNode );\n\t\t\t\tstate.currentHighlightedNode = targetNode;\n\n\t\t\t\t// Scroll the highlighted word into view\n\t\t\t\tif ( targetNode.nodeType !== Node.TEXT_NODE ) {\n\t\t\t\t\ttargetNode.scrollIntoView( {\n\t\t\t\t\t\tbehavior: 'smooth',\n\t\t\t\t\t\tblock: 'center',\n\t\t\t\t\t} );\n\t\t\t\t} else if ( targetNode.parentNode ) {\n\t\t\t\t\ttargetNode.parentNode.scrollIntoView( {\n\t\t\t\t\t\tbehavior: 'smooth',\n\t\t\t\t\t\tblock: 'center',\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch ( e ) {\n\t\tconsole.error( 'Highlighting error:', e );\n\t}\n};\n\n// Add a new method to build the node positions map more efficiently\nexport const buildNodePositionsMap = ( state, rootElement, excludeClasses ) => {\n\tstate.nodePositions.clear();\n\n\t// Optimized node collection with filtering\n\tconst collectTextNodes = ( element, charCount = 0 ) => {\n\t\t// Skip excluded elements\n\t\tif ( element.classList ) {\n\t\t\tfor ( const excludeClass of excludeClasses ) {\n\t\t\t\tif (\n\t\t\t\t\texcludeClass &&\n\t\t\t\t\telement.classList.contains( excludeClass )\n\t\t\t\t) {\n\t\t\t\t\treturn charCount;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Process text nodes\n\t\tif ( element.nodeType === Node.TEXT_NODE ) {\n\t\t\tconst text = element.textContent;\n\t\t\tif ( text.trim().length > 0 ) {\n\t\t\t\tstate.nodePositions.set( charCount, {\n\t\t\t\t\tnode: element,\n\t\t\t\t\tlength: text.length,\n\t\t\t\t} );\n\t\t\t\tcharCount += text.length;\n\t\t\t}\n\t\t\treturn charCount;\n\t\t}\n\n\t\t// Process element children\n\t\tif ( element.childNodes && element.childNodes.length > 0 ) {\n\t\t\tfor ( const child of element.childNodes ) {\n\t\t\t\tcharCount = collectTextNodes( child, charCount );\n\t\t\t}\n\t\t}\n\n\t\treturn charCount;\n\t};\n\n\t// Start the collection process\n\tcollectTextNodes( rootElement );\n};\n","/**\n * Export all actions for easy import\n */\n\nexport * from './synthesis';\nexport * from './highlight';\nexport * from './voice';\nexport * from './utterance';\nexport * from './playback';\nexport * from './content';\n","/**\n * Playback control actions\n */\n\nimport { getContext } from '@wordpress/interactivity';\nimport { getCurrentLocale, getMainElement, getBlockWrapper } from '../utils';\nimport { checkSynthesisReady, setupSafariKeepAlive } from './synthesis';\nimport {\n\tclearHighlights,\n\tbuildNodePositionsMap,\n\thandleBoundaryEvent,\n} from './highlight';\nimport { createUtterance, handleUtteranceEnd } from './utterance';\nimport { getContent } from './content';\nimport { DEFAULTS } from '../constants';\n\n// Playback Controls\nexport const Play = async ( state ) => {\n\tconst context = getContext();\n\tif ( context ) {\n\t\tcontext.isPlaying = true;\n\t}\n\tstate.isPlaying = true;\n\n\t// Firefox resume handling\n\tif ( state.browserType === 'firefox' && state.pausedAt ) {\n\t\t// Create a new utterance from the paused position\n\t\tconst remainingText = state.pausedAt.text.substring(\n\t\t\tstate.pausedAt.charIndex\n\t\t);\n\n\t\t// Set the current chunk back to where we paused\n\t\tstate.currentChunk = state.pausedAt.chunk;\n\n\t\t// Create new utterance for the remaining text\n\t\tconst newUtterance = new window.SpeechSynthesisUtterance(\n\t\t\tremainingText\n\t\t);\n\t\tnewUtterance.lang = getCurrentLocale();\n\t\tnewUtterance.rate = state.currentSpeed;\n\t\tnewUtterance.pitch = state.currentPitch;\n\n\t\t// Initialize the last character index for the new utterance\n\t\tnewUtterance._lastCharIndex = 0;\n\n\t\t// Store the content offset for highlighting calculations\n\t\tnewUtterance._contentOffset = state.pausedAt.contentPosition;\n\n\t\tif ( state.currentVoice ) {\n\t\t\tconst voice = state.voices.find(\n\t\t\t\t( v ) => v.voiceURI === state.currentVoice.voiceURI\n\t\t\t);\n\t\t\tnewUtterance.voice = voice;\n\t\t}\n\n\t\t// Create a custom boundary handler specific to this resumed utterance\n\t\tnewUtterance.onboundary = ( event ) => {\n\t\t\t// Save last character index for pause handling\n\t\t\tnewUtterance._lastCharIndex = event.charIndex || 0;\n\n\t\t\t// Calculate the absolute position in the original content\n\t\t\tconst absolutePosition =\n\t\t\t\t( event.charIndex || 0 ) + state.pausedAt.contentPosition;\n\n\t\t\t// Create an adjusted event with the correct character index\n\t\t\tconst adjustedEvent = {\n\t\t\t\t...event,\n\t\t\t\tcharIndex: absolutePosition,\n\t\t\t\t// Ensure charLength is always valid\n\t\t\t\tcharLength: event.charLength || 1,\n\t\t\t};\n\n\t\t\t// Pass to normal boundary handler but with full original text\n\t\t\tconst mainElement = getMainElement();\n\t\t\tif ( mainElement ) {\n\t\t\t\t// Force rebuild node positions to ensure synchronization\n\t\t\t\tconst blockWrapper = getBlockWrapper();\n\t\t\t\tconst excludeClassesStr =\n\t\t\t\t\tblockWrapper?.dataset.excludeClass ||\n\t\t\t\t\tDEFAULTS.EXCLUDE_CLASS;\n\n\t\t\t\tif ( state.nodePositions.size === 0 ) {\n\t\t\t\t\tbuildNodePositionsMap(\n\t\t\t\t\t\tstate,\n\t\t\t\t\t\tmainElement,\n\t\t\t\t\t\texcludeClassesStr.split( /\\s+/ )\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Handle the boundary event with the full content context\n\t\t\t\thandleBoundaryEvent(\n\t\t\t\t\tstate,\n\t\t\t\t\tadjustedEvent,\n\t\t\t\t\tstate.pausedAt.fullText || state.pausedAt.text\n\t\t\t\t);\n\t\t\t}\n\t\t};\n\n\t\tnewUtterance.onend = () => handleUtteranceEnd( state );\n\n\t\tstate.utterance = newUtterance;\n\n\t\t// Speak the new utterance\n\t\twindow.speechSynthesis.speak( state.utterance );\n\n\t\t// In Safari, set up the keep-alive timer\n\t\tif ( state.browserType === 'safari' ) {\n\t\t\tsetupSafariKeepAlive( state );\n\t\t}\n\n\t\t// Clear the paused state\n\t\tstate.pausedAt = null;\n\n\t\treturn;\n\t}\n\n\tif ( state.textChunks.length === 0 || state.currentChunk === 0 ) {\n\t\tgetContent( state );\n\t\tcreateUtterance( state, context );\n\t}\n\n\ttry {\n\t\tif ( window.speechSynthesis.paused ) {\n\t\t\twindow.speechSynthesis.resume();\n\t\t\treturn;\n\t\t}\n\t} catch ( e ) {\n\t\tconsole.warn( 'Resume failed, recreating speech:', e );\n\t\t// If resume fails, recreate the utterance\n\t\tcreateUtterance( state, context );\n\t}\n\n\t// Chrome and Edge fix - recreate utterance if speaking\n\tif ( state.browserType === 'chrome' || state.browserType === 'edge' ) {\n\t\tif ( window.speechSynthesis.speaking ) {\n\t\t\twindow.speechSynthesis.cancel();\n\t\t\tsetTimeout( () => {\n\t\t\t\tif ( state.utterance ) {\n\t\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t\t\t}\n\t\t\t}, 50 );\n\t\t\treturn;\n\t\t}\n\t}\n\n\tif ( state.utterance ) {\n\t\twindow.speechSynthesis.speak( state.utterance );\n\n\t\t// In Safari, set up the keep-alive timer\n\t\tif ( state.browserType === 'safari' ) {\n\t\t\tsetupSafariKeepAlive( state );\n\t\t}\n\t}\n};\n\nexport const Pause = async ( state ) => {\n\tconst context = getContext();\n\tif ( context ) {\n\t\tcontext.isPlaying = false;\n\t}\n\tstate.isPlaying = false;\n\tclearHighlights( state );\n\n\t// Firefox doesn't fully support pause, so we need to handle it differently\n\tif ( state.browserType === 'firefox' ) {\n\t\t// Store the current position\n\t\tif ( window.speechSynthesis.speaking ) {\n\t\t\t// Get the full text content for context\n\t\t\tconst fullText = state.textChunks.join( ' ' );\n\n\t\t\t// Save current speech state for later resuming\n\t\t\tstate.pausedAt = {\n\t\t\t\ttext: state.utterance.text,\n\t\t\t\tcharIndex: state.utterance._lastCharIndex || 0,\n\t\t\t\tchunk: state.currentChunk,\n\t\t\t\t// Track full content position to correctly restore highlighting\n\t\t\t\tcontentPosition:\n\t\t\t\t\tstate.utterance._lastCharIndex +\n\t\t\t\t\t( state.currentChunk > 0\n\t\t\t\t\t\t? state.textChunks\n\t\t\t\t\t\t\t\t.slice( 0, state.currentChunk )\n\t\t\t\t\t\t\t\t.reduce(\n\t\t\t\t\t\t\t\t\t( sum, chunk ) => sum + chunk.length,\n\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t: 0 ),\n\t\t\t\t// Store full text for better context on resume\n\t\t\t\tfullText,\n\t\t\t};\n\n\t\t\t// Cancel current speech\n\t\t\twindow.speechSynthesis.cancel();\n\t\t}\n\t} else if ( state.browserType === 'safari' ) {\n\t\t// Safari's pause is also unreliable\n\t\tif ( window.speechSynthesis.speaking ) {\n\t\t\t// Get the full text content for context\n\t\t\tconst fullText = state.textChunks.join( ' ' );\n\n\t\t\t// Save position like Firefox\n\t\t\tstate.pausedAt = {\n\t\t\t\ttext: state.utterance.text,\n\t\t\t\tcharIndex: state.utterance._lastCharIndex || 0,\n\t\t\t\tchunk: state.currentChunk,\n\t\t\t\tcontentPosition:\n\t\t\t\t\tstate.utterance._lastCharIndex +\n\t\t\t\t\t( state.currentChunk > 0\n\t\t\t\t\t\t? state.textChunks\n\t\t\t\t\t\t\t\t.slice( 0, state.currentChunk )\n\t\t\t\t\t\t\t\t.reduce(\n\t\t\t\t\t\t\t\t\t( sum, chunk ) => sum + chunk.length,\n\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t: 0 ),\n\t\t\t\t// Store full text for better context on resume\n\t\t\t\tfullText,\n\t\t\t};\n\n\t\t\t// Clear any Safari timers\n\t\t\tif ( state.utterance._safariTimerId ) {\n\t\t\t\tclearInterval( state.utterance._safariTimerId );\n\t\t\t}\n\n\t\t\tif ( state.safariKeepAliveTimer ) {\n\t\t\t\tclearInterval( state.safariKeepAliveTimer );\n\t\t\t\tstate.safariKeepAliveTimer = null;\n\t\t\t}\n\n\t\t\twindow.speechSynthesis.cancel();\n\t\t}\n\t} else if (\n\t\twindow.speechSynthesis.speaking &&\n\t\t! window.speechSynthesis.paused\n\t) {\n\t\t// Standard pause for Chrome and other browsers\n\t\twindow.speechSynthesis.pause();\n\t}\n};\n\nexport const Restart = ( state ) => {\n\tconst context = getContext();\n\tif ( context ) {\n\t\tcontext.isPlaying = false;\n\t}\n\tstate.isPlaying = false;\n\n\t// Clear any Safari timers\n\tif ( state.browserType === 'safari' ) {\n\t\tif ( state.utterance && state.utterance._safariTimerId ) {\n\t\t\tclearInterval( state.utterance._safariTimerId );\n\t\t}\n\n\t\tif ( state.safariKeepAliveTimer ) {\n\t\t\tclearInterval( state.safariKeepAliveTimer );\n\t\t\tstate.safariKeepAliveTimer = null;\n\t\t}\n\t}\n\n\twindow.speechSynthesis.cancel();\n\n\tstate.currentChunk = 0;\n\tstate.textChunks = [];\n\n\tclearHighlights( state );\n};\n\nexport const changeSpeed = async ( state, e ) => {\n\twindow.speechSynthesis.cancel();\n\n\tconst context = getContext();\n\tif ( context ) {\n\t\tcontext.isPlaying = false;\n\t}\n\tstate.currentSpeed = e.target.value;\n\twindow.localStorage.setItem(\n\t\t'mosne-tts-speed-' + document.documentElement.lang,\n\t\te.target.value\n\t);\n\n\tawait checkSynthesisReady();\n\tcreateUtterance( state, context );\n\n\tif ( context && ! context.isPlaying ) {\n\t\tsetTimeout( () => {\n\t\t\tcontext.isPlaying = true;\n\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t}, 50 );\n\t}\n};\n\nexport const changePitch = async ( state, e ) => {\n\twindow.speechSynthesis.cancel();\n\tconst context = getContext();\n\tif ( context ) {\n\t\tcontext.isPlaying = false;\n\t}\n\n\tstate.currentPitch = e.target.value;\n\twindow.localStorage.setItem(\n\t\t'mosne-tts-pitch-' + document.documentElement.lang,\n\t\te.target.value\n\t);\n\n\tawait checkSynthesisReady();\n\tcreateUtterance( state, context );\n\n\tif ( context && ! context.isPlaying ) {\n\t\tsetTimeout( () => {\n\t\t\tcontext.isPlaying = true;\n\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t}, 50 );\n\t}\n};\n\nexport const toggleSettings = () => {\n\tconst context = getContext();\n\tif ( context ) {\n\t\tcontext.showSettings = ! context.showSettings;\n\t}\n};\n","/**\n * Speech synthesis management actions\n */\n\n// Speech Synthesis Management\nexport const checkSynthesisReady = () => {\n\treturn new Promise( ( resolve ) => {\n\t\tconst check = () => {\n\t\t\tif (\n\t\t\t\t! window.speechSynthesis.speaking &&\n\t\t\t\t! window.speechSynthesis.pending\n\t\t\t) {\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\tsetTimeout( check, 100 );\n\t\t\t}\n\t\t};\n\t\tcheck();\n\t} );\n};\n\n// Safari requires periodic \"ping\" to keep speech synthesis active\nexport const setupSafariKeepAlive = ( state ) => {\n\tif ( state.browserType !== 'safari' ) {\n\t\treturn;\n\t}\n\n\t// Clear any existing timer\n\tif ( state.safariKeepAliveTimer ) {\n\t\tclearInterval( state.safariKeepAliveTimer );\n\t}\n\n\t// Every 10 seconds, ping speechSynthesis to keep it alive\n\tstate.safariKeepAliveTimer = setInterval( () => {\n\t\tif ( state.isPlaying && window.speechSynthesis.speaking ) {\n\t\t\twindow.speechSynthesis.pause();\n\t\t\twindow.speechSynthesis.resume();\n\t\t} else {\n\t\t\tclearInterval( state.safariKeepAliveTimer );\n\t\t\tstate.safariKeepAliveTimer = null;\n\t\t}\n\t}, 10000 );\n};\n","/**\n * Utterance management actions\n */\n\nimport { getCurrentLocale } from '../utils';\nimport {\n\thandleBoundaryEvent,\n\tsetupSafariHighlighting,\n\tclearHighlights,\n} from './highlight';\n\n// Utterance Management\nexport const createUtterance = ( state, context ) => {\n\t// Get the content for the current chunk\n\tconst content = state.textChunks[ state.currentChunk ];\n\tconst newUtterance = new window.SpeechSynthesisUtterance( content );\n\tnewUtterance.lang = getCurrentLocale();\n\tnewUtterance.rate = state.currentSpeed;\n\tnewUtterance.pitch = state.currentPitch;\n\n\tif ( state.currentVoice ) {\n\t\tconst voice = state.voices.find(\n\t\t\t( v ) => v.voiceURI === state.currentVoice.voiceURI\n\t\t);\n\t\tnewUtterance.voice = voice;\n\t}\n\n\tsetupUtteranceEvents( state, newUtterance, content, context );\n\tstate.utterance = newUtterance;\n};\n\nexport const setupUtteranceEvents = ( state, utterance, content, context ) => {\n\t// Safari doesn't reliably fire boundary events, so use workarounds\n\tif ( state.browserType === 'safari' ) {\n\t\t// For Safari, we'll use word-level events and timeouts\n\t\tutterance.onboundary = ( event ) => {\n\t\t\t// Still try to use boundary events if they work\n\t\t\tutterance._lastCharIndex = event.charIndex || 0;\n\t\t\thandleBoundaryEvent( state, event, content );\n\t\t};\n\n\t\t// Also add a timer-based highlighting as fallback for Safari\n\t\tutterance._safariTimerId = setupSafariHighlighting( state, content );\n\t} else {\n\t\tutterance.onboundary = ( event ) => {\n\t\t\t// Save last character index for pause handling\n\t\t\tutterance._lastCharIndex = event.charIndex || 0;\n\n\t\t\t// If this utterance has a content offset (resumed utterance)\n\t\t\t// create an adjusted event with the correct character index\n\t\t\tconst adjustedEvent =\n\t\t\t\tutterance._contentOffset !== undefined\n\t\t\t\t\t? {\n\t\t\t\t\t\t\t...event,\n\t\t\t\t\t\t\tcharIndex:\n\t\t\t\t\t\t\t\t( event.charIndex || 0 ) +\n\t\t\t\t\t\t\t\tutterance._contentOffset,\n\t\t\t\t\t  }\n\t\t\t\t\t: event;\n\n\t\t\thandleBoundaryEvent( state, adjustedEvent, content );\n\t\t};\n\t}\n\n\tutterance.onend = () => {\n\t\t// Clear Safari timer if it exists\n\t\tif ( utterance._safariTimerId ) {\n\t\t\tclearInterval( utterance._safariTimerId );\n\t\t}\n\n\t\t// Check if there are more chunks to process\n\t\tif ( state.currentChunk < state.textChunks.length - 1 ) {\n\t\t\t// Move to next chunk\n\t\t\tstate.currentChunk++;\n\n\t\t\t// Create and speak the next utterance\n\t\t\tcreateUtterance( state, context );\n\n\t\t\t// Small delay to ensure proper timing\n\t\t\tsetTimeout( () => {\n\t\t\t\tif ( state.isPlaying && state.utterance ) {\n\t\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t\t\t}\n\t\t\t}, 50 );\n\t\t} else {\n\t\t\t// This is the last chunk, perform cleanup\n\t\t\tif ( context ) {\n\t\t\t\tcontext.isPlaying = false;\n\t\t\t}\n\t\t\tstate.isPlaying = false;\n\t\t\tclearHighlights( state );\n\t\t}\n\t};\n\n\t// Ensure we can track errors across browsers\n\tutterance.onerror = ( event ) => {\n\t\tconsole.error( 'Speech synthesis error:', event );\n\t\tif ( event.error === 'interrupted' ) {\n\t\t\t// Reset the speech synthesis state\n\t\t\tspeechSynthesis.cancel();\n\t\t\thandleUtteranceEnd( state );\n\t\t}\n\t};\n};\n\nexport const handleUtteranceEnd = ( state ) => {\n\t// Clear any remaining highlights\n\tclearHighlights( state );\n\n\t// Update playing state\n\tstate.isPlaying = false;\n\n\t// Reset chunk tracking\n\tstate.currentChunk = 0;\n\tstate.textChunks = [];\n\n\t// Reset highlight tracking\n\tstate.currentHighlightedNode = null;\n\n\t// Clear selected text range\n\tstate.selectedTextRange = {\n\t\thasSelection: false,\n\t};\n};\n","/**\n * Voice management actions\n */\n\nimport { getCurrentLocale } from '../utils';\nimport { createUtterance } from './utterance';\nimport { getContext } from '@wordpress/interactivity';\n// Voice Management\nexport const loadVoices = async ( state ) => {\n\t// For Safari/iOS, ensure we have access to voices\n\tif ( state.browserType === 'safari' ) {\n\t\t// Safari sometimes needs speech synthesis to be triggered first\n\t\twindow.speechSynthesis.speak( new SpeechSynthesisUtterance( '' ) );\n\t\twindow.speechSynthesis.cancel();\n\t}\n\n\tconst availableVoices = window.speechSynthesis.getVoices();\n\n\tif ( ! availableVoices?.length ) {\n\t\t// Try again in a bit - browsers load voices asynchronously\n\t\tsetTimeout( () => loadVoices( state ), 100 );\n\t\treturn;\n\t}\n\n\tconst currentLocale = getCurrentLocale();\n\tconst localVoices = availableVoices.filter( ( voice ) =>\n\t\tvoice.lang.startsWith( currentLocale )\n\t);\n\n\tstate.voices = localVoices.length > 0 ? localVoices : availableVoices;\n\tstate.currentVoice = state.voices[ 0 ];\n\n\tif ( state.preferredVoice ) {\n\t\tconst voice = state.voices.find(\n\t\t\t( v ) => v.voiceURI === state.preferredVoice\n\t\t);\n\t\tif ( voice ) {\n\t\t\tstate.currentVoice = voice;\n\t\t}\n\t}\n\n\tsetTimeout( () => createUtterance( state ), 50 );\n};\n\nexport const changeVoice = ( state, e ) => {\n\t// Cancel any ongoing speech\n\twindow.speechSynthesis.cancel();\n\n\tconst context = getContext();\n\tif ( context ) {\n\t\tcontext.isPlaying = false;\n\t}\n\n\tconst voice = state.voices.find( ( v ) => v.voiceURI === e.target.value );\n\n\tif ( voice ) {\n\t\tstate.currentVoice = voice;\n\t\twindow.localStorage.setItem(\n\t\t\t'mosne-tts-lang-' + document.documentElement.lang,\n\t\t\tvoice.voiceURI\n\t\t);\n\t}\n};\n","/**\n * Callback functions for the text-to-speech functionality\n */\n\nimport { getContext } from '@wordpress/interactivity';\nimport { getBlockWrapper, getMainElement, initHighlightColors } from './utils';\nimport { DEFAULTS } from './constants';\nimport { loadVoices } from './actions/voice';\nimport { buildNodePositionsMap } from './actions/highlight';\n\nexport const init = ( state ) => {\n\tif ( ! window.speechSynthesis ) {\n\t\tconsole.warn( 'Speech synthesis not supported in this browser' );\n\t\treturn;\n\t}\n\n\t// Cancel any ongoing speech\n\twindow.speechSynthesis.cancel();\n\n\t// Initialize highlight colors once at startup\n\tinitHighlightColors();\n\n\t// Load available voices\n\tloadVoices( state );\n\n\tif ( window.speechSynthesis.onvoiceschanged !== undefined ) {\n\t\twindow.speechSynthesis.onvoiceschanged = () => loadVoices( state );\n\t}\n\n\twindow.addEventListener( 'beforeunload', () => {\n\t\twindow.speechSynthesis.cancel();\n\n\t\t// Clear any Safari timers\n\t\tif ( state.browserType === 'safari' ) {\n\t\t\tif ( state.utterance && state.utterance._safariTimerId ) {\n\t\t\t\tclearInterval( state.utterance._safariTimerId );\n\t\t\t}\n\n\t\t\tif ( state.safariKeepAliveTimer ) {\n\t\t\t\tclearInterval( state.safariKeepAliveTimer );\n\t\t\t}\n\t\t}\n\t} );\n\n\t// Initial node map building for better performance when playback starts\n\tconst mainElement = getMainElement();\n\tif ( mainElement ) {\n\t\tconst blockWrapper = getBlockWrapper();\n\t\tconst excludeClassesStr =\n\t\t\tblockWrapper?.dataset.excludeClass || DEFAULTS.EXCLUDE_CLASS;\n\t\tsetTimeout( () => {\n\t\t\tbuildNodePositionsMap(\n\t\t\t\tstate,\n\t\t\t\tmainElement,\n\t\t\t\texcludeClassesStr.split( /\\s+/ )\n\t\t\t);\n\t\t}, 500 ); // Delay to ensure DOM is ready\n\t}\n};\n\nexport const isSelected = ( state ) => {\n\tconst context = getContext();\n\treturn context.voice?.voiceURI === state.currentVoice?.voiceURI;\n};\n","/**\n * Constants for the text-to-speech functionality\n */\n\nexport const STORAGE_KEYS = {\n\tLANG: ( lang ) => `mosne-tts-lang-${ lang }`,\n\tSPEED: ( lang ) => `mosne-tts-speed-${ lang }`,\n\tPITCH: ( lang ) => `mosne-tts-pitch-${ lang }`,\n};\n\nexport const DEFAULTS = {\n\tHIGHLIGHT_BG: '#ffeb3b',\n\tHIGHLIGHT_COLOR: '#000000',\n\tEXCLUDE_CLASS: 'skip-speech',\n\tWORDS_PER_CHUNK: 200,\n};\n","/**\n * Initial state for the text-to-speech functionality\n */\n\nimport { STORAGE_KEYS } from './constants';\nimport { getLocalStorageItem, getCurrentLocale, getBrowser } from './utils';\n\nexport const initialState = {\n\tisPlaying: false,\n\tcurrentVoice: null,\n\tpreferredVoice: getLocalStorageItem(\n\t\tSTORAGE_KEYS.LANG( getCurrentLocale() ),\n\t\tnull\n\t),\n\tutterance: null,\n\tvoices: [],\n\tcurrentSpeed: getLocalStorageItem(\n\t\tSTORAGE_KEYS.SPEED( getCurrentLocale() ),\n\t\t1\n\t),\n\tcurrentPitch: getLocalStorageItem(\n\t\tSTORAGE_KEYS.PITCH( getCurrentLocale() ),\n\t\t1\n\t),\n\tselectedTextRange: { hasSelection: false },\n\tcurrentChunk: 0,\n\ttextChunks: [],\n\tisProcessingChunks: false,\n\tcurrentHighlightedNode: null,\n\tnodePositions: new Map(),\n\tcurrentSelection: null,\n\tpausedAt: null,\n\tbrowserType: getBrowser(),\n\t// For Safari ping-pong to keep synthesis alive\n\tsafariKeepAliveTimer: null,\n};\n","/**\n * Helper functions for text-to-speech functionality\n */\n\nimport { DEFAULTS } from './constants';\n\nexport const getLocalStorageItem = ( key, defaultValue ) => {\n\ttry {\n\t\treturn window.localStorage.getItem( key ) || defaultValue;\n\t} catch ( e ) {\n\t\t// Handle private browsing mode in Safari\n\t\treturn defaultValue;\n\t}\n};\n\nexport const getCurrentLocale = () => document.documentElement.lang || 'en';\n\nexport const getBlockWrapper = () =>\n\tdocument.querySelector(\n\t\t'[data-wp-interactive=\"mosne-text-to-speech-block\"]'\n\t);\n\nexport const getMainElement = () => document.querySelector( 'main' );\n\n// Detect browser for specific handling\nexport const getBrowser = () => {\n\tconst userAgent = window.navigator.userAgent;\n\tif ( userAgent.indexOf( 'Firefox' ) !== -1 ) {\n\t\treturn 'firefox';\n\t}\n\tif (\n\t\tuserAgent.indexOf( 'Edge' ) !== -1 ||\n\t\tuserAgent.indexOf( 'Edg' ) !== -1\n\t) {\n\t\treturn 'edge';\n\t}\n\tif (\n\t\tuserAgent.indexOf( 'Safari' ) !== -1 &&\n\t\tuserAgent.indexOf( 'Chrome' ) === -1\n\t) {\n\t\treturn 'safari';\n\t}\n\tif ( userAgent.indexOf( 'Chrome' ) !== -1 ) {\n\t\treturn 'chrome';\n\t}\n\treturn 'other';\n};\n\nexport const initHighlightColors = () => {\n\tconst mainElement = getMainElement();\n\tconst blockWrapper = getBlockWrapper();\n\n\tif ( ! mainElement || ! blockWrapper ) {\n\t\treturn;\n\t}\n\n\t// Get highlight colors from block settings or use defaults\n\tconst highlightBackground =\n\t\tblockWrapper.dataset.highlightBackground || DEFAULTS.HIGHLIGHT_BG;\n\tconst highlightColor =\n\t\tblockWrapper.dataset.highlightColor || DEFAULTS.HIGHLIGHT_COLOR;\n\n\t// Set CSS custom properties on the main element for easier styling\n\tmainElement.style.setProperty(\n\t\t'--mosne-tts-highlight-bg',\n\t\thighlightBackground\n\t);\n\tmainElement.style.setProperty(\n\t\t'--mosne-tts-highlight-color',\n\t\thighlightColor\n\t);\n};\n","module.exports = __WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * WordPress dependencies\n */\nimport { store } from '@wordpress/interactivity';\n\n/**\n * Internal dependencies\n */\nimport { initialState } from './view/state';\nimport * as a from './view/actions';\nimport * as c from './view/callbacks';\n\n// Store configuration\nconst { state } = store( 'mosne-text-to-speech-block', {\n\tstate: initialState,\n\n\t// Map action creators to pass state as first argument\n\tactions: {\n\t\t// Synthesis\n\t\tcheckSynthesisReady: () => a.checkSynthesisReady( state ),\n\t\tsetupSafariKeepAlive: () => a.setupSafariKeepAlive( state ),\n\t\t//highlight\n\t\tbuildNodePositionsMap: () => a.buildNodePositionsMap( state ),\n\t\thandleBoundaryEvent: () => a.handleBoundaryEvent( state ),\n\t\tsetupSafariHighlighting: () => a.setupSafariHighlighting( state ),\n\t\tclearHighlights: () => a.clearHighlights( state ),\n\t\t// Voice\n\t\tloadVoices: () => a.loadVoices( state ),\n\t\tchangeVoice: ( e ) => a.changeVoice( state, e ),\n\t\t// Utterance\n\t\tcreateUtterance: () => a.createUtterance( state ),\n\t\tsetupUtteranceEvents: () => a.setupUtteranceEvents( state ),\n\t\thandleUtteranceEnd: () => a.handleUtteranceEnd( state ),\n\t\t// playback\n\t\tPlay: () => a.Play( state ),\n\t\tPause: () => a.Pause( state ),\n\t\tRestart: () => a.Restart( state ),\n\t\tchangeSpeed: ( e ) => a.changeSpeed( state, e ),\n\t\tchangePitch: ( e ) => a.changePitch( state, e ),\n\t\ttoggleSettings: () => a.toggleSettings( state ),\n\t\t// content\n\t\tgetContent: () => a.getContent( state ),\n\t},\n\n\t// Map callback creators to pass state as argument\n\tcallbacks: {\n\t\tinit: () => c.init( state ),\n\t\tisSelected: () => c.isSelected( state ),\n\t},\n} );\n"],"names":["DEFAULTS","getBlockWrapper","getMainElement","buildNodePositionsMap","getContent","state","mainElement","docView","ownerDocument","defaultView","selection","getSelection","content","toString","trim","length","selectedTextRange","text","hasSelection","cloneMain","cloneNode","blockWrapper","excludeClassesStr","dataset","excludeClass","EXCLUDE_CLASS","excludeClasses","split","forEach","skip","querySelectorAll","el","remove","textContent","textChunks","chunkText","WORDS_PER_CHUNK","currentChunk","wordsPerChunk","words","chunks","i","chunk","slice","join","push","clearHighlights","currentSelection","removeAllRanges","e","console","warn","currentHighlightedNode","createHighlightWrapper","node","doc","range","createRange","nodeType","Node","TEXT_NODE","setStart","setEnd","selectNodeContents","addRange","rangeCount","getRangeAt","setupSafariHighlighting","browserType","charsPerSecond","currentSpeed","intervalTime","currentIndex","timerId","setInterval","isPlaying","clearInterval","syntheticEvent","charIndex","charLength","handleBoundaryEvent","Math","ceil","event","absoluteCharIndex","nodePositions","size","targetNode","bestMatch","distance","Number","MAX_SAFE_INTEGER","positions","Array","from","keys","sort","a","b","pos","nodeData","get","abs","scrollIntoView","behavior","block","parentNode","error","rootElement","clear","collectTextNodes","element","charCount","classList","contains","set","childNodes","child","getContext","getCurrentLocale","checkSynthesisReady","setupSafariKeepAlive","createUtterance","handleUtteranceEnd","Play","context","pausedAt","remainingText","substring","newUtterance","window","SpeechSynthesisUtterance","lang","rate","pitch","currentPitch","_lastCharIndex","_contentOffset","contentPosition","currentVoice","voice","voices","find","v","voiceURI","onboundary","absolutePosition","adjustedEvent","fullText","onend","utterance","speechSynthesis","speak","paused","resume","speaking","cancel","setTimeout","Pause","reduce","sum","_safariTimerId","safariKeepAliveTimer","pause","Restart","changeSpeed","target","value","localStorage","setItem","document","documentElement","changePitch","toggleSettings","showSettings","Promise","resolve","check","pending","setupUtteranceEvents","undefined","onerror","loadVoices","availableVoices","getVoices","currentLocale","localVoices","filter","startsWith","preferredVoice","changeVoice","initHighlightColors","init","onvoiceschanged","addEventListener","isSelected","STORAGE_KEYS","LANG","SPEED","PITCH","HIGHLIGHT_BG","HIGHLIGHT_COLOR","getLocalStorageItem","getBrowser","initialState","isProcessingChunks","Map","key","defaultValue","getItem","querySelector","userAgent","navigator","indexOf","highlightBackground","highlightColor","style","setProperty","store","c","actions","callbacks"],"sourceRoot":""}