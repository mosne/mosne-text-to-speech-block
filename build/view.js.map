{"version":3,"file":"view.js","mappings":"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","sources":["webpack://mosne-text-to-speech-block/external module \"@wordpress/interactivity\"","webpack://mosne-text-to-speech-block/webpack/bootstrap","webpack://mosne-text-to-speech-block/webpack/runtime/define property getters","webpack://mosne-text-to-speech-block/webpack/runtime/hasOwnProperty shorthand","webpack://mosne-text-to-speech-block/webpack/runtime/make namespace object","webpack://mosne-text-to-speech-block/./src/view.js"],"sourcesContent":["module.exports = __WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * WordPress dependencies\n */\nimport { store, getContext } from '@wordpress/interactivity';\n\n// Constants\nconst STORAGE_KEYS = {\n\tLANG: ( lang ) => `mosne-tts-lang-${ lang }`,\n\tSPEED: ( lang ) => `mosne-tts-speed-${ lang }`,\n\tPITCH: ( lang ) => `mosne-tts-pitch-${ lang }`,\n};\n\nconst DEFAULTS = {\n\tHIGHLIGHT_BG: '#ffeb3b',\n\tHIGHLIGHT_COLOR: '#000000',\n\tEXCLUDE_CLASS: 'skip-speech',\n\tWORDS_PER_CHUNK: 200,\n};\n\n// Helper functions\nconst getLocalStorageItem = ( key, defaultValue ) => {\n\ttry {\n\t\treturn window.localStorage.getItem( key ) || defaultValue;\n\t} catch ( e ) {\n\t\t// Handle private browsing mode in Safari\n\t\treturn defaultValue;\n\t}\n};\n\nconst getCurrentLocale = () => document.documentElement.lang || 'en';\n\nconst getBlockWrapper = () =>\n\tdocument.querySelector(\n\t\t'[data-wp-interactive=\"mosne-text-to-speech-block\"]'\n\t);\n\nconst getMainElement = () => document.querySelector( 'main' );\n\n// Detect browser for specific handling\nconst getBrowser = () => {\n\tconst userAgent = window.navigator.userAgent;\n\tif ( userAgent.indexOf( 'Firefox' ) !== -1 ) {\n\t\treturn 'firefox';\n\t}\n\tif (\n\t\tuserAgent.indexOf( 'Edge' ) !== -1 ||\n\t\tuserAgent.indexOf( 'Edg' ) !== -1\n\t) {\n\t\treturn 'edge';\n\t}\n\tif (\n\t\tuserAgent.indexOf( 'Safari' ) !== -1 &&\n\t\tuserAgent.indexOf( 'Chrome' ) === -1\n\t) {\n\t\treturn 'safari';\n\t}\n\tif ( userAgent.indexOf( 'Chrome' ) !== -1 ) {\n\t\treturn 'chrome';\n\t}\n\treturn 'other';\n};\n\nconst isLeafNode = ( node ) => {\n\t// Check if this is a text node\n\tif ( node.nodeType === Node.TEXT_NODE ) {\n\t\treturn true;\n\t}\n\n\t// For element nodes, check if they only contain text nodes (no other elements)\n\tif ( node.nodeType === Node.ELEMENT_NODE ) {\n\t\tfor ( const child of node.childNodes ) {\n\t\t\tif ( child.nodeType !== Node.TEXT_NODE ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\treturn false;\n};\n\nconst { state, actions } = store( 'mosne-text-to-speech-block', {\n\tstate: {\n\t\tisPlaying: false,\n\t\tcurrentVoice: null,\n\t\tpreferredVoice: getLocalStorageItem(\n\t\t\tSTORAGE_KEYS.LANG( getCurrentLocale() ),\n\t\t\tnull\n\t\t),\n\t\tutterance: null,\n\t\tvoices: [],\n\t\tcurrentSpeed: getLocalStorageItem(\n\t\t\tSTORAGE_KEYS.SPEED( getCurrentLocale() ),\n\t\t\t1\n\t\t),\n\t\tcurrentPitch: getLocalStorageItem(\n\t\t\tSTORAGE_KEYS.PITCH( getCurrentLocale() ),\n\t\t\t1\n\t\t),\n\t\tselectedTextRange: { hasSelection: false },\n\t\tcurrentChunk: 0,\n\t\ttextChunks: [],\n\t\tisProcessingChunks: false,\n\t\tcurrentHighlightedNode: null,\n\t\tnodePositions: new Map(),\n\t\tcurrentSelection: null,\n\t\tpausedAt: null,\n\t\tbrowserType: getBrowser(),\n\t\t// For Safari ping-pong to keep synthesis alive\n\t\tsafariKeepAliveTimer: null,\n\t},\n\tactions: {\n\t\t// Speech Synthesis Management\n\t\tcheckSynthesisReady() {\n\t\t\treturn new Promise( ( resolve ) => {\n\t\t\t\tconst check = () => {\n\t\t\t\t\tif (\n\t\t\t\t\t\t! window.speechSynthesis.speaking &&\n\t\t\t\t\t\t! window.speechSynthesis.pending\n\t\t\t\t\t) {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetTimeout( check, 100 );\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tcheck();\n\t\t\t} );\n\t\t},\n\n\t\t// Highlighting Management\n\t\tclearHighlights() {\n\t\t\tif ( state.currentSelection ) {\n\t\t\t\ttry {\n\t\t\t\t\tstate.currentSelection.removeAllRanges();\n\t\t\t\t} catch ( e ) {\n\t\t\t\t\t// Handle Edge/IE errors with selection\n\t\t\t\t\tconsole.warn( 'Error clearing highlights:', e );\n\t\t\t\t}\n\t\t\t\tstate.currentSelection = null;\n\t\t\t}\n\t\t\tstate.currentHighlightedNode = null;\n\t\t},\n\n\t\tcreateHighlightWrapper( node ) {\n\t\t\t// Use the node's document for selection to avoid global selection issues\n\t\t\tif ( ! node ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst doc = node.ownerDocument;\n\t\t\tconst docView = doc.defaultView;\n\n\t\t\tif ( ! docView ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Clear any existing selection\n\t\t\tactions.clearHighlights();\n\n\t\t\ttry {\n\t\t\t\t// Create a new range for the node text content\n\t\t\t\tconst range = doc.createRange();\n\n\t\t\t\t// Only select the text node's content instead of the entire node\n\t\t\t\tif ( node.nodeType === Node.TEXT_NODE ) {\n\t\t\t\t\trange.setStart( node, 0 );\n\t\t\t\t\trange.setEnd( node, node.length );\n\t\t\t\t} else {\n\t\t\t\t\trange.selectNodeContents( node );\n\t\t\t\t}\n\n\t\t\t\t// Apply the selection\n\t\t\t\tconst selection = docView.getSelection();\n\t\t\t\tif ( selection ) {\n\t\t\t\t\tselection.removeAllRanges();\n\t\t\t\t\tselection.addRange( range );\n\n\t\t\t\t\t// Store the current selection for cleanup\n\t\t\t\t\tstate.currentSelection = selection;\n\n\t\t\t\t\t// Apply CSS custom properties via selection styles\n\t\t\t\t\t// This uses the CSS variables we set on init\n\t\t\t\t\tif ( selection.rangeCount > 0 ) {\n\t\t\t\t\t\tselection.getRangeAt( 0 );\n\t\t\t\t\t\tselection.getRangeAt( 0 );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch ( e ) {\n\t\t\t\tconsole.warn( 'Error creating highlight:', e );\n\t\t\t}\n\t\t},\n\n\t\t// Voice Management\n\t\tasync loadVoices() {\n\t\t\t// For Safari/iOS, ensure we have access to voices\n\t\t\tif ( state.browserType === 'safari' ) {\n\t\t\t\t// Safari sometimes needs speech synthesis to be triggered first\n\t\t\t\twindow.speechSynthesis.speak(\n\t\t\t\t\tnew SpeechSynthesisUtterance( '' )\n\t\t\t\t);\n\t\t\t\twindow.speechSynthesis.cancel();\n\t\t\t}\n\n\t\t\tconst availableVoices = window.speechSynthesis.getVoices();\n\n\t\t\tif ( ! availableVoices?.length ) {\n\t\t\t\t// Try again in a bit - browsers load voices asynchronously\n\t\t\t\tsetTimeout( () => actions.loadVoices(), 100 );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentLocale = getCurrentLocale();\n\t\t\tconst localVoices = availableVoices.filter( ( voice ) =>\n\t\t\t\tvoice.lang.startsWith( currentLocale )\n\t\t\t);\n\n\t\t\tstate.voices =\n\t\t\t\tlocalVoices.length > 0 ? localVoices : availableVoices;\n\t\t\tstate.currentVoice = state.voices[ 0 ];\n\n\t\t\tif ( state.preferredVoice ) {\n\t\t\t\tconst voice = state.voices.find(\n\t\t\t\t\t( v ) => v.voiceURI === state.preferredVoice\n\t\t\t\t);\n\t\t\t\tif ( voice ) {\n\t\t\t\t\tstate.currentVoice = voice;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsetTimeout( () => actions.createUtterance(), 50 );\n\t\t},\n\n\t\t// Utterance Management\n\t\tcreateUtterance() {\n\t\t\tconst content =\n\t\t\t\tstate.textChunks.length > 0\n\t\t\t\t\t? state.textChunks[ state.currentChunk ]\n\t\t\t\t\t: actions.getContent();\n\n\t\t\tconst newUtterance = new window.SpeechSynthesisUtterance( content );\n\t\t\tnewUtterance.lang = getCurrentLocale();\n\t\t\tnewUtterance.rate = state.currentSpeed;\n\t\t\tnewUtterance.pitch = state.currentPitch;\n\n\t\t\tif ( state.currentVoice ) {\n\t\t\t\tconst voice = state.voices.find(\n\t\t\t\t\t( v ) => v.voiceURI === state.currentVoice.voiceURI\n\t\t\t\t);\n\t\t\t\tnewUtterance.voice = voice;\n\t\t\t}\n\n\t\t\tactions.setupUtteranceEvents( newUtterance, content );\n\t\t\tstate.utterance = newUtterance;\n\t\t},\n\n\t\tsetupUtteranceEvents( utterance, content ) {\n\t\t\t// Safari doesn't reliably fire boundary events, so use workarounds\n\t\t\tif ( state.browserType === 'safari' ) {\n\t\t\t\t// For Safari, we'll use word-level events and timeouts\n\t\t\t\tutterance.onboundary = ( event ) => {\n\t\t\t\t\t// Still try to use boundary events if they work\n\t\t\t\t\tutterance._lastCharIndex = event.charIndex || 0;\n\t\t\t\t\tactions.handleBoundaryEvent( event, content );\n\t\t\t\t};\n\n\t\t\t\t// Also add a timer-based highlighting as fallback for Safari\n\t\t\t\tutterance._safariTimerId =\n\t\t\t\t\tactions.setupSafariHighlighting( content );\n\t\t\t} else {\n\t\t\t\tutterance.onboundary = ( event ) => {\n\t\t\t\t\t// Save last character index for pause handling\n\t\t\t\t\tutterance._lastCharIndex = event.charIndex || 0;\n\n\t\t\t\t\t// If this utterance has a content offset (resumed utterance)\n\t\t\t\t\t// create an adjusted event with the correct character index\n\t\t\t\t\tconst adjustedEvent =\n\t\t\t\t\t\tutterance._contentOffset !== undefined\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t...event,\n\t\t\t\t\t\t\t\t\tcharIndex:\n\t\t\t\t\t\t\t\t\t\t( event.charIndex || 0 ) +\n\t\t\t\t\t\t\t\t\t\tutterance._contentOffset,\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t: event;\n\n\t\t\t\t\tactions.handleBoundaryEvent( adjustedEvent, content );\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tutterance.onend = () => {\n\t\t\t\t// Clear Safari timer if it exists\n\t\t\t\tif ( utterance._safariTimerId ) {\n\t\t\t\t\tclearInterval( utterance._safariTimerId );\n\t\t\t\t}\n\n\t\t\t\tactions.handleUtteranceEnd();\n\t\t\t};\n\n\t\t\t// Ensure we can track errors across browsers\n\t\t\tutterance.onerror = ( event ) => {\n\t\t\t\tconsole.error( 'Speech synthesis error:', event );\n\t\t\t\tactions.handleUtteranceEnd();\n\t\t\t};\n\t\t},\n\n\t\t// Safari-specific timer-based highlighting fallback\n\t\tsetupSafariHighlighting( content ) {\n\t\t\tif ( state.browserType !== 'safari' ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Estimate reading speed (chars per second)\n\t\t\tconst charsPerSecond = 15 * state.currentSpeed;\n\t\t\tconst intervalTime = 250; // Check every 250ms\n\n\t\t\tlet currentIndex = 0;\n\t\t\tconst timerId = setInterval( () => {\n\t\t\t\tif ( ! state.isPlaying ) {\n\t\t\t\t\tclearInterval( timerId );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Create a synthetic boundary event for Safari\n\t\t\t\tconst syntheticEvent = {\n\t\t\t\t\tcharIndex: currentIndex,\n\t\t\t\t\tcharLength: 1,\n\t\t\t\t};\n\n\t\t\t\tactions.handleBoundaryEvent( syntheticEvent, content );\n\n\t\t\t\t// Advance the position based on estimated reading speed\n\t\t\t\tcurrentIndex += Math.ceil(\n\t\t\t\t\t( charsPerSecond * intervalTime ) / 1000\n\t\t\t\t);\n\n\t\t\t\t// Stop if we've reached the end of content\n\t\t\t\tif ( currentIndex >= content.length ) {\n\t\t\t\t\tclearInterval( timerId );\n\t\t\t\t}\n\t\t\t}, intervalTime );\n\n\t\t\treturn timerId;\n\t\t},\n\n\t\t// Safari requires periodic \"ping\" to keep speech synthesis active\n\t\tsetupSafariKeepAlive() {\n\t\t\tif ( state.browserType !== 'safari' ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Clear any existing timer\n\t\t\tif ( state.safariKeepAliveTimer ) {\n\t\t\t\tclearInterval( state.safariKeepAliveTimer );\n\t\t\t}\n\n\t\t\t// Every 10 seconds, ping speechSynthesis to keep it alive\n\t\t\tstate.safariKeepAliveTimer = setInterval( () => {\n\t\t\t\tif ( state.isPlaying && window.speechSynthesis.speaking ) {\n\t\t\t\t\twindow.speechSynthesis.pause();\n\t\t\t\t\twindow.speechSynthesis.resume();\n\t\t\t\t} else {\n\t\t\t\t\tclearInterval( state.safariKeepAliveTimer );\n\t\t\t\t\tstate.safariKeepAliveTimer = null;\n\t\t\t\t}\n\t\t\t}, 10000 );\n\t\t},\n\n\t\t// Playback Controls\n\t\tasync Play() {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = true;\n\t\t\tstate.isPlaying = true;\n\n\t\t\t// Firefox resume handling\n\t\t\tif ( state.browserType === 'firefox' && state.pausedAt ) {\n\t\t\t\t// Create a new utterance from the paused position\n\t\t\t\tconst remainingText = state.pausedAt.text.substring(\n\t\t\t\t\tstate.pausedAt.charIndex\n\t\t\t\t);\n\n\t\t\t\t// Set the current chunk back to where we paused\n\t\t\t\tstate.currentChunk = state.pausedAt.chunk;\n\n\t\t\t\t// Create new utterance for the remaining text\n\t\t\t\tconst newUtterance = new window.SpeechSynthesisUtterance(\n\t\t\t\t\tremainingText\n\t\t\t\t);\n\t\t\t\tnewUtterance.lang = getCurrentLocale();\n\t\t\t\tnewUtterance.rate = state.currentSpeed;\n\t\t\t\tnewUtterance.pitch = state.currentPitch;\n\n\t\t\t\t// Initialize the last character index for the new utterance\n\t\t\t\tnewUtterance._lastCharIndex = 0;\n\n\t\t\t\t// Store the content offset for highlighting calculations\n\t\t\t\tnewUtterance._contentOffset = state.pausedAt.contentPosition;\n\n\t\t\t\tif ( state.currentVoice ) {\n\t\t\t\t\tconst voice = state.voices.find(\n\t\t\t\t\t\t( v ) => v.voiceURI === state.currentVoice.voiceURI\n\t\t\t\t\t);\n\t\t\t\t\tnewUtterance.voice = voice;\n\t\t\t\t}\n\n\t\t\t\t// Create a custom boundary handler specific to this resumed utterance\n\t\t\t\tnewUtterance.onboundary = ( event ) => {\n\t\t\t\t\t// Save last character index for pause handling\n\t\t\t\t\tnewUtterance._lastCharIndex = event.charIndex || 0;\n\n\t\t\t\t\t// Calculate the absolute position in the original content\n\t\t\t\t\tconst absolutePosition =\n\t\t\t\t\t\t( event.charIndex || 0 ) +\n\t\t\t\t\t\tstate.pausedAt.contentPosition;\n\n\t\t\t\t\t// Create an adjusted event with the correct character index\n\t\t\t\t\tconst adjustedEvent = {\n\t\t\t\t\t\t...event,\n\t\t\t\t\t\tcharIndex: absolutePosition,\n\t\t\t\t\t\t// Ensure charLength is always valid\n\t\t\t\t\t\tcharLength: event.charLength || 1,\n\t\t\t\t\t};\n\n\t\t\t\t\t// Pass to normal boundary handler but with full original text\n\t\t\t\t\tconst mainElement = getMainElement();\n\t\t\t\t\tif ( mainElement ) {\n\t\t\t\t\t\t// Force rebuild node positions to ensure synchronization\n\t\t\t\t\t\tconst blockWrapper = getBlockWrapper();\n\t\t\t\t\t\tconst excludeClassesStr =\n\t\t\t\t\t\t\tblockWrapper?.dataset.excludeClass ||\n\t\t\t\t\t\t\tDEFAULTS.EXCLUDE_CLASS;\n\n\t\t\t\t\t\tif ( state.nodePositions.size === 0 ) {\n\t\t\t\t\t\t\tactions.buildNodePositionsMap(\n\t\t\t\t\t\t\t\tmainElement,\n\t\t\t\t\t\t\t\texcludeClassesStr.split( /\\s+/ )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Handle the boundary event with the full content context\n\t\t\t\t\t\tactions.handleBoundaryEvent(\n\t\t\t\t\t\t\tadjustedEvent,\n\t\t\t\t\t\t\tstate.pausedAt.fullText || state.pausedAt.text\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tnewUtterance.onend = () => actions.handleUtteranceEnd();\n\n\t\t\t\tstate.utterance = newUtterance;\n\n\t\t\t\t// Speak the new utterance\n\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\n\t\t\t\t// In Safari, set up the keep-alive timer\n\t\t\t\tif ( state.browserType === 'safari' ) {\n\t\t\t\t\tactions.setupSafariKeepAlive();\n\t\t\t\t}\n\n\t\t\t\t// Clear the paused state\n\t\t\t\tstate.pausedAt = null;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( state.textChunks.length === 0 || state.currentChunk === 0 ) {\n\t\t\t\tactions.getContent();\n\t\t\t\tactions.createUtterance();\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tif ( window.speechSynthesis.paused ) {\n\t\t\t\t\twindow.speechSynthesis.resume();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} catch ( e ) {\n\t\t\t\tconsole.warn( 'Resume failed, recreating speech:', e );\n\t\t\t\t// If resume fails, recreate the utterance\n\t\t\t\tactions.createUtterance();\n\t\t\t}\n\n\t\t\t// Chrome and Edge fix - recreate utterance if speaking\n\t\t\tif (\n\t\t\t\tstate.browserType === 'chrome' ||\n\t\t\t\tstate.browserType === 'edge'\n\t\t\t) {\n\t\t\t\tif ( window.speechSynthesis.speaking ) {\n\t\t\t\t\twindow.speechSynthesis.cancel();\n\t\t\t\t\tsetTimeout( () => {\n\t\t\t\t\t\tif ( state.utterance ) {\n\t\t\t\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 50 );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( state.utterance ) {\n\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\n\t\t\t\t// In Safari, set up the keep-alive timer\n\t\t\t\tif ( state.browserType === 'safari' ) {\n\t\t\t\t\tactions.setupSafariKeepAlive();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tPause() {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = false;\n\t\t\tstate.isPlaying = false;\n\n\t\t\t// Firefox doesn't fully support pause, so we need to handle it differently\n\t\t\tif ( state.browserType === 'firefox' ) {\n\t\t\t\t// Store the current position\n\t\t\t\tif ( window.speechSynthesis.speaking ) {\n\t\t\t\t\t// Get the full text content for context\n\t\t\t\t\tconst fullText = state.textChunks.join( ' ' );\n\n\t\t\t\t\t// Save current speech state for later resuming\n\t\t\t\t\tstate.pausedAt = {\n\t\t\t\t\t\ttext: state.utterance.text,\n\t\t\t\t\t\tcharIndex: state.utterance._lastCharIndex || 0,\n\t\t\t\t\t\tchunk: state.currentChunk,\n\t\t\t\t\t\t// Track full content position to correctly restore highlighting\n\t\t\t\t\t\tcontentPosition:\n\t\t\t\t\t\t\tstate.utterance._lastCharIndex +\n\t\t\t\t\t\t\t( state.currentChunk > 0\n\t\t\t\t\t\t\t\t? state.textChunks\n\t\t\t\t\t\t\t\t\t\t.slice( 0, state.currentChunk )\n\t\t\t\t\t\t\t\t\t\t.reduce(\n\t\t\t\t\t\t\t\t\t\t\t( sum, chunk ) =>\n\t\t\t\t\t\t\t\t\t\t\t\tsum + chunk.length,\n\t\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t: 0 ),\n\t\t\t\t\t\t// Store full text for better context on resume\n\t\t\t\t\t\tfullText,\n\t\t\t\t\t};\n\n\t\t\t\t\t// Cancel current speech\n\t\t\t\t\twindow.speechSynthesis.cancel();\n\t\t\t\t}\n\t\t\t} else if ( state.browserType === 'safari' ) {\n\t\t\t\t// Safari's pause is also unreliable\n\t\t\t\tif ( window.speechSynthesis.speaking ) {\n\t\t\t\t\t// Get the full text content for context\n\t\t\t\t\tconst fullText = state.textChunks.join( ' ' );\n\n\t\t\t\t\t// Save position like Firefox\n\t\t\t\t\tstate.pausedAt = {\n\t\t\t\t\t\ttext: state.utterance.text,\n\t\t\t\t\t\tcharIndex: state.utterance._lastCharIndex || 0,\n\t\t\t\t\t\tchunk: state.currentChunk,\n\t\t\t\t\t\tcontentPosition:\n\t\t\t\t\t\t\tstate.utterance._lastCharIndex +\n\t\t\t\t\t\t\t( state.currentChunk > 0\n\t\t\t\t\t\t\t\t? state.textChunks\n\t\t\t\t\t\t\t\t\t\t.slice( 0, state.currentChunk )\n\t\t\t\t\t\t\t\t\t\t.reduce(\n\t\t\t\t\t\t\t\t\t\t\t( sum, chunk ) =>\n\t\t\t\t\t\t\t\t\t\t\t\tsum + chunk.length,\n\t\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t: 0 ),\n\t\t\t\t\t\t// Store full text for better context on resume\n\t\t\t\t\t\tfullText,\n\t\t\t\t\t};\n\n\t\t\t\t\t// Clear any Safari timers\n\t\t\t\t\tif ( state.utterance._safariTimerId ) {\n\t\t\t\t\t\tclearInterval( state.utterance._safariTimerId );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( state.safariKeepAliveTimer ) {\n\t\t\t\t\t\tclearInterval( state.safariKeepAliveTimer );\n\t\t\t\t\t\tstate.safariKeepAliveTimer = null;\n\t\t\t\t\t}\n\n\t\t\t\t\twindow.speechSynthesis.cancel();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Standard pause for Chrome and other browsers\n\t\t\t\tif (\n\t\t\t\t\twindow.speechSynthesis.speaking &&\n\t\t\t\t\t! window.speechSynthesis.paused\n\t\t\t\t) {\n\t\t\t\t\twindow.speechSynthesis.pause();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tRestart() {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = false;\n\t\t\tstate.isPlaying = false;\n\n\t\t\t// Clear any Safari timers\n\t\t\tif ( state.browserType === 'safari' ) {\n\t\t\t\tif ( state.utterance && state.utterance._safariTimerId ) {\n\t\t\t\t\tclearInterval( state.utterance._safariTimerId );\n\t\t\t\t}\n\n\t\t\t\tif ( state.safariKeepAliveTimer ) {\n\t\t\t\t\tclearInterval( state.safariKeepAliveTimer );\n\t\t\t\t\tstate.safariKeepAliveTimer = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twindow.speechSynthesis.cancel();\n\n\t\t\tstate.currentChunk = 0;\n\t\t\tstate.textChunks = [];\n\n\t\t\tactions.clearHighlights();\n\t\t},\n\t\tchangeVoice( e ) {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = false;\n\n\t\t\t// Cancel any ongoing speech\n\t\t\twindow.speechSynthesis.cancel();\n\n\t\t\tconst voice = state.voices.find(\n\t\t\t\t( v ) => v.voiceURI === e.target.value\n\t\t\t);\n\n\t\t\tif ( voice ) {\n\t\t\t\tstate.currentVoice = voice;\n\t\t\t\twindow.localStorage.setItem(\n\t\t\t\t\t'mosne-tts-lang-' + document.documentElement.lang,\n\t\t\t\t\tvoice.voiceURI\n\t\t\t\t);\n\n\t\t\t\t// Small delay to ensure speech synthesis is ready\n\t\t\t\tsetTimeout( () => {\n\t\t\t\t\tactions.updateUtterance();\n\t\t\t\t}, 50 );\n\t\t\t}\n\t\t},\n\t\tasync changeSpeed( e ) {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = false;\n\t\t\twindow.speechSynthesis.cancel();\n\n\t\t\tstate.currentSpeed = e.target.value;\n\t\t\twindow.localStorage.setItem(\n\t\t\t\t'mosne-tts-speed-' + document.documentElement.lang,\n\t\t\t\te.target.value\n\t\t\t);\n\n\t\t\tawait actions.checkSynthesisReady();\n\t\t\tactions.createUtterance();\n\n\t\t\tif ( context.isPlaying ) {\n\t\t\t\tsetTimeout( () => {\n\t\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t\t\t}, 50 );\n\t\t\t}\n\t\t},\n\t\tasync changePitch( e ) {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = false;\n\t\t\twindow.speechSynthesis.cancel();\n\n\t\t\tstate.currentPitch = e.target.value;\n\t\t\twindow.localStorage.setItem(\n\t\t\t\t'mosne-tts-pitch-' + document.documentElement.lang,\n\t\t\t\te.target.value\n\t\t\t);\n\n\t\t\tawait actions.checkSynthesisReady();\n\t\t\tactions.createUtterance();\n\n\t\t\tif ( context.isPlaying ) {\n\t\t\t\tsetTimeout( () => {\n\t\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t\t\t}, 50 );\n\t\t\t}\n\t\t},\n\t\ttoggleSettings() {\n\t\t\tconst context = getContext();\n\t\t\tcontext.showSettings = ! context.showSettings;\n\t\t},\n\t\tgetContent() {\n\t\t\t// Check if there is highlighted text\n\t\t\tconst mainElement = getMainElement();\n\t\t\tconst docView = mainElement?.ownerDocument.defaultView;\n\t\t\tconst selection = docView ? docView.getSelection() : null;\n\t\t\tlet content = '';\n\n\t\t\tif ( selection && selection.toString().trim().length > 0 ) {\n\t\t\t\t// Get selected text\n\t\t\t\tcontent = selection.toString();\n\t\t\t\tstate.selectedTextRange = {\n\t\t\t\t\ttext: content,\n\t\t\t\t\thasSelection: true,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\t// Get content from main element\n\t\t\t\tlet cloneMain = mainElement?.cloneNode( true );\n\t\t\t\tif ( cloneMain ) {\n\t\t\t\t\t// Use the same exclude classes logic for consistency\n\t\t\t\t\tconst blockWrapper = getBlockWrapper();\n\t\t\t\t\tconst excludeClassesStr =\n\t\t\t\t\t\tblockWrapper?.dataset.excludeClass ||\n\t\t\t\t\t\tDEFAULTS.EXCLUDE_CLASS;\n\t\t\t\t\tconst excludeClasses = excludeClassesStr.split( /\\s+/ );\n\n\t\t\t\t\t// Remove all elements with excluded classes\n\t\t\t\t\texcludeClasses.forEach( ( excludeClass ) => {\n\t\t\t\t\t\tif ( excludeClass ) {\n\t\t\t\t\t\t\tconst skip = cloneMain.querySelectorAll(\n\t\t\t\t\t\t\t\t`.${ excludeClass }`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tskip.forEach( ( el ) => {\n\t\t\t\t\t\t\t\tel.remove();\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t\tcontent = cloneMain.textContent;\n\t\t\t\t\tcloneMain = null;\n\n\t\t\t\t\t// Pre-build the node position map for faster highlighting\n\t\t\t\t\tif ( mainElement ) {\n\t\t\t\t\t\tactions.buildNodePositionsMap(\n\t\t\t\t\t\t\tmainElement,\n\t\t\t\t\t\t\texcludeClassesStr.split( /\\s+/ )\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tstate.selectedTextRange = {\n\t\t\t\t\thasSelection: false,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Process content into chunks of approximately 200 words\n\t\t\tstate.textChunks = actions.chunkText(\n\t\t\t\tcontent,\n\t\t\t\tDEFAULTS.WORDS_PER_CHUNK\n\t\t\t);\n\t\t\tstate.currentChunk = 0;\n\n\t\t\t// Return the first chunk to start with\n\t\t\treturn state.textChunks.length > 0 ? state.textChunks[ 0 ] : '';\n\t\t},\n\t\t// New method to chunk text into approximately word-sized pieces\n\t\tchunkText( text, wordsPerChunk ) {\n\t\t\tif ( ! text || text.trim() === '' ) {\n\t\t\t\treturn [ '' ];\n\t\t\t}\n\n\t\t\t// Split the text into words\n\t\t\tconst words = text.trim().split( /\\s+/ );\n\t\t\tconst chunks = [];\n\n\t\t\t// Create chunks of approximately wordsPerChunk words\n\t\t\tfor ( let i = 0; i < words.length; i += wordsPerChunk ) {\n\t\t\t\tconst chunk = words.slice( i, i + wordsPerChunk ).join( ' ' );\n\t\t\t\tchunks.push( chunk );\n\t\t\t}\n\n\t\t\treturn chunks;\n\t\t},\n\t\thandleBoundaryEvent( event, content ) {\n\t\t\tconst mainElement = getMainElement();\n\t\t\tif ( ! mainElement ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Safety check for valid boundary event\n\t\t\tif (\n\t\t\t\tevent.charIndex === undefined ||\n\t\t\t\tevent.charLength === undefined ||\n\t\t\t\tevent.charIndex + event.charLength > content.length\n\t\t\t) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t'Invalid boundary event or position out of content bounds'\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tif ( state.selectedTextRange?.hasSelection ) {\n\t\t\t\t\t// Handle selected text case...\n\t\t\t\t} else {\n\t\t\t\t\t// Handle main content highlighting\n\t\t\t\t\tconst blockWrapper = getBlockWrapper();\n\t\t\t\t\tconst excludeClassesStr =\n\t\t\t\t\t\tblockWrapper?.dataset.excludeClass ||\n\t\t\t\t\t\tDEFAULTS.EXCLUDE_CLASS;\n\t\t\t\t\tconst excludeClasses = excludeClassesStr.split( /\\s+/ );\n\n\t\t\t\t\t// Optimize node finding by using a cached map of text nodes if available\n\t\t\t\t\tif ( state.nodePositions.size === 0 ) {\n\t\t\t\t\t\t// Build node positions map on first use\n\t\t\t\t\t\tactions.buildNodePositionsMap(\n\t\t\t\t\t\t\tmainElement,\n\t\t\t\t\t\t\texcludeClasses\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Find the node containing the current position using the optimized map\n\t\t\t\t\tconst charPosition = event.charIndex;\n\t\t\t\t\tlet targetNode = null;\n\t\t\t\t\tlet bestMatch = {\n\t\t\t\t\t\tnode: null,\n\t\t\t\t\t\tdistance: Number.MAX_SAFE_INTEGER,\n\t\t\t\t\t};\n\n\t\t\t\t\t// Find the closest position in the map\n\t\t\t\t\tconst positions = Array.from(\n\t\t\t\t\t\tstate.nodePositions.keys()\n\t\t\t\t\t).sort( ( a, b ) => a - b );\n\n\t\t\t\t\tfor ( let i = 0; i < positions.length; i++ ) {\n\t\t\t\t\t\tconst pos = positions[ i ];\n\t\t\t\t\t\tconst nodeData = state.nodePositions.get( pos );\n\n\t\t\t\t\t\t// Exact match\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tpos <= charPosition &&\n\t\t\t\t\t\t\tcharPosition < pos + nodeData.length\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\ttargetNode = nodeData.node;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// For Firefox, also track approximate matches as fallback\n\t\t\t\t\t\tif ( state.browserType === 'firefox' ) {\n\t\t\t\t\t\t\t// Calculate distance to this node's position\n\t\t\t\t\t\t\tconst distance = Math.abs( pos - charPosition );\n\t\t\t\t\t\t\tif ( distance < bestMatch.distance ) {\n\t\t\t\t\t\t\t\tbestMatch = { node: nodeData.node, distance };\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// For Firefox, use the best approximate match if no exact match found\n\t\t\t\t\tif (\n\t\t\t\t\t\t! targetNode &&\n\t\t\t\t\t\tstate.browserType === 'firefox' &&\n\t\t\t\t\t\tbestMatch.node\n\t\t\t\t\t) {\n\t\t\t\t\t\ttargetNode = bestMatch.node;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Only update highlight if we've found a new leaf node\n\t\t\t\t\tif (\n\t\t\t\t\t\ttargetNode &&\n\t\t\t\t\t\ttargetNode !== state.currentHighlightedNode &&\n\t\t\t\t\t\ttargetNode.textContent.trim().length > 0\n\t\t\t\t\t) {\n\t\t\t\t\t\t// Clear previous highlight\n\t\t\t\t\t\tactions.clearHighlights();\n\n\t\t\t\t\t\t// Create new highlight using selection\n\t\t\t\t\t\tactions.createHighlightWrapper( targetNode );\n\n\t\t\t\t\t\t// Update current node reference\n\t\t\t\t\t\tstate.currentHighlightedNode = targetNode;\n\n\t\t\t\t\t\t// Scroll the highlighted word into view if needed\n\t\t\t\t\t\tif ( targetNode.nodeType !== Node.TEXT_NODE ) {\n\t\t\t\t\t\t\ttargetNode.scrollIntoView( {\n\t\t\t\t\t\t\t\tbehavior: 'smooth',\n\t\t\t\t\t\t\t\tblock: 'center',\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} else if ( targetNode.parentNode ) {\n\t\t\t\t\t\t\ttargetNode.parentNode.scrollIntoView( {\n\t\t\t\t\t\t\t\tbehavior: 'smooth',\n\t\t\t\t\t\t\t\tblock: 'center',\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch ( e ) {\n\t\t\t\tconsole.error( 'Highlighting error:', e );\n\t\t\t}\n\t\t},\n\t\thandleUtteranceEnd() {\n\t\t\t// Clear any remaining highlights\n\t\t\tactions.clearHighlights();\n\n\t\t\t// Update playing state\n\t\t\tconst context = getContext();\n\t\t\tcontext.isPlaying = false;\n\t\t\tstate.isPlaying = false;\n\n\t\t\t// Reset chunk tracking\n\t\t\tstate.currentChunk = 0;\n\t\t\tstate.textChunks = [];\n\n\t\t\t// Reset highlight tracking\n\t\t\tstate.currentHighlightedNode = null;\n\n\t\t\t// Clear selected text range\n\t\t\tstate.selectedTextRange = {\n\t\t\t\thasSelection: false,\n\t\t\t};\n\t\t},\n\t\t// Add a new method to build the node positions map more efficiently\n\t\tbuildNodePositionsMap( rootElement, excludeClasses ) {\n\t\t\tstate.nodePositions.clear();\n\n\t\t\t// Optimized node collection with filtering\n\t\t\tconst collectTextNodes = ( element, charCount = 0 ) => {\n\t\t\t\t// Skip excluded elements\n\t\t\t\tif ( element.classList ) {\n\t\t\t\t\tfor ( const excludeClass of excludeClasses ) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\texcludeClass &&\n\t\t\t\t\t\t\telement.classList.contains( excludeClass )\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\treturn charCount;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Process text nodes\n\t\t\t\tif ( element.nodeType === Node.TEXT_NODE ) {\n\t\t\t\t\tconst text = element.textContent;\n\t\t\t\t\tif ( text.trim().length > 0 ) {\n\t\t\t\t\t\tstate.nodePositions.set( charCount, {\n\t\t\t\t\t\t\tnode: element,\n\t\t\t\t\t\t\tlength: text.length,\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tcharCount += text.length;\n\t\t\t\t\t}\n\t\t\t\t\treturn charCount;\n\t\t\t\t}\n\n\t\t\t\t// Process element children\n\t\t\t\tif ( element.childNodes && element.childNodes.length > 0 ) {\n\t\t\t\t\tfor ( const child of element.childNodes ) {\n\t\t\t\t\t\tcharCount = collectTextNodes( child, charCount );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn charCount;\n\t\t\t};\n\n\t\t\t// Start the collection process\n\t\t\tcollectTextNodes( rootElement );\n\t\t},\n\t},\n\tcallbacks: {\n\t\tinit() {\n\t\t\tif ( ! window.speechSynthesis ) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t'Speech synthesis not supported in this browser'\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Cancel any ongoing speech\n\t\t\twindow.speechSynthesis.cancel();\n\n\t\t\t// Detect browser type\n\t\t\tstate.browserType = getBrowser();\n\t\t\tconsole.log( `Browser detected: ${ state.browserType }` );\n\n\t\t\t// Initialize highlight colors once at startup\n\t\t\tinitHighlightColors();\n\n\t\t\t// Load available voices\n\t\t\tactions.loadVoices();\n\n\t\t\tif ( window.speechSynthesis.onvoiceschanged !== undefined ) {\n\t\t\t\twindow.speechSynthesis.onvoiceschanged = actions.loadVoices;\n\t\t\t}\n\n\t\t\twindow.addEventListener( 'beforeunload', () => {\n\t\t\t\twindow.speechSynthesis.cancel();\n\n\t\t\t\t// Clear any Safari timers\n\t\t\t\tif ( state.browserType === 'safari' ) {\n\t\t\t\t\tif ( state.utterance && state.utterance._safariTimerId ) {\n\t\t\t\t\t\tclearInterval( state.utterance._safariTimerId );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( state.safariKeepAliveTimer ) {\n\t\t\t\t\t\tclearInterval( state.safariKeepAliveTimer );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\t// Initial node map building for better performance when playback starts\n\t\t\tconst mainElement = getMainElement();\n\t\t\tif ( mainElement ) {\n\t\t\t\tconst blockWrapper = getBlockWrapper();\n\t\t\t\tconst excludeClassesStr =\n\t\t\t\t\tblockWrapper?.dataset.excludeClass ||\n\t\t\t\t\tDEFAULTS.EXCLUDE_CLASS;\n\t\t\t\tsetTimeout( () => {\n\t\t\t\t\tactions.buildNodePositionsMap(\n\t\t\t\t\t\tmainElement,\n\t\t\t\t\t\texcludeClassesStr.split( /\\s+/ )\n\t\t\t\t\t);\n\t\t\t\t}, 500 ); // Delay to ensure DOM is ready\n\t\t\t}\n\t\t},\n\t\tisSelected() {\n\t\t\tconst context = getContext();\n\t\t\treturn context.voice.voiceURI === state.currentVoice.voiceURI;\n\t\t},\n\t},\n} );\n\nconst updateHighlight = ( targetNode, background, color ) => {\n\trequestAnimationFrame( () => {} );\n};\n\nconst calculateNodePositions = () => {\n\tconst walker = document.createTreeWalker(\n\t\tgetMainElement(),\n\t\tNodeFilter.SHOW_TEXT,\n\t\t{\n\t\t\tacceptNode( node ) {\n\t\t\t\treturn isLeafNode( node )\n\t\t\t\t\t? NodeFilter.FILTER_ACCEPT\n\t\t\t\t\t: NodeFilter.FILTER_REJECT;\n\t\t\t},\n\t\t}\n\t);\n\n\tlet charCount = 0;\n\tlet node;\n\tstate.nodePositions.clear();\n\n\twhile ( ( node = walker.nextNode() ) ) {\n\t\tstate.nodePositions.set( charCount, {\n\t\t\tnode,\n\t\t\tlength: node.textContent.length,\n\t\t} );\n\t\tcharCount += node.textContent.length;\n\t}\n};\n\nconst selectCurrentWord = ( event ) => {\n\tif ( ! event || ! event.target ) {\n\t\treturn;\n\t}\n\n\t// Get the node reference properly\n\tconst node = event.target;\n\tconst doc = node.ownerDocument;\n\tconst docView = doc.defaultView;\n\n\tif ( ! docView ) {\n\t\treturn;\n\t}\n\n\t// Get clicked text node\n\tlet textNode = null;\n\tlet textContent = '';\n\n\tif ( node.nodeType === Node.TEXT_NODE ) {\n\t\ttextNode = node;\n\t\ttextContent = node.textContent;\n\t} else if (\n\t\tnode.firstChild &&\n\t\tnode.firstChild.nodeType === Node.TEXT_NODE\n\t) {\n\t\ttextNode = node.firstChild;\n\t\ttextContent = textNode.textContent;\n\t} else {\n\t\t// Not a text node or element containing text\n\t\treturn;\n\t}\n\n\ttry {\n\t\t// Get selection from document view\n\t\tconst selection = docView.getSelection();\n\t\tif ( ! selection ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Calculate word boundaries\n\t\tconst range = doc.createRange();\n\t\tconst clickPos =\n\t\t\t( event.offsetX / node.offsetWidth ) * textContent.length;\n\n\t\t// Find word boundaries (nearest spaces)\n\t\tlet startPos = textContent.lastIndexOf( ' ', clickPos );\n\t\tstartPos = startPos === -1 ? 0 : startPos + 1;\n\n\t\tlet endPos = textContent.indexOf( ' ', clickPos );\n\t\tendPos = endPos === -1 ? textContent.length : endPos;\n\n\t\t// Set the range to select just the word\n\t\trange.setStart( textNode, startPos );\n\t\trange.setEnd( textNode, endPos );\n\n\t\t// Apply the selection\n\t\tselection.removeAllRanges();\n\t\tselection.addRange( range );\n\t} catch ( e ) {\n\t\tconsole.warn( 'Error selecting word:', e );\n\t}\n};\n\n// Helper function to get caret position - optimized to use document view\nconst getCaretPosition = ( element ) => {\n\tif ( ! element ) {\n\t\treturn 0;\n\t}\n\n\ttry {\n\t\tconst doc = element.ownerDocument;\n\t\tconst docView = doc.defaultView;\n\t\tconst selection = docView.getSelection();\n\n\t\tif ( ! selection || ! selection.rangeCount ) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tconst range = selection.getRangeAt( 0 );\n\t\tconst preCaretRange = range.cloneRange();\n\t\tpreCaretRange.selectNodeContents( element );\n\t\tpreCaretRange.setEnd( range.endContainer, range.endOffset );\n\t\treturn preCaretRange.toString().length;\n\t} catch ( e ) {\n\t\tconsole.warn( 'Error getting caret position:', e );\n\t\treturn 0;\n\t}\n};\n\n// Export necessary functions for direct use\nexport const textToSpeechHelpers = {\n\t// Implement the word selection function for external use\n\tselectCurrentWord: ( event ) => {\n\t\tif ( ! event || ! event.target ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Get the node reference properly\n\t\tconst node = event.target;\n\t\tconst doc = node.ownerDocument;\n\t\tconst docView = doc.defaultView;\n\n\t\tif ( ! docView ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Get clicked text node\n\t\tlet textNode = null;\n\t\tlet textContent = '';\n\n\t\tif ( node.nodeType === Node.TEXT_NODE ) {\n\t\t\ttextNode = node;\n\t\t\ttextContent = node.textContent;\n\t\t} else if (\n\t\t\tnode.firstChild &&\n\t\t\tnode.firstChild.nodeType === Node.TEXT_NODE\n\t\t) {\n\t\t\ttextNode = node.firstChild;\n\t\t\ttextContent = textNode.textContent;\n\t\t} else {\n\t\t\t// Not a text node or element containing text\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\t// Get selection from document view\n\t\t\tconst selection = docView.getSelection();\n\t\t\tif ( ! selection ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Calculate word boundaries\n\t\t\tconst range = doc.createRange();\n\t\t\tconst clickPos =\n\t\t\t\t( event.offsetX / node.offsetWidth ) * textContent.length;\n\n\t\t\t// Find word boundaries (nearest spaces)\n\t\t\tlet startPos = textContent.lastIndexOf( ' ', clickPos );\n\t\t\tstartPos = startPos === -1 ? 0 : startPos + 1;\n\n\t\t\tlet endPos = textContent.indexOf( ' ', clickPos );\n\t\t\tendPos = endPos === -1 ? textContent.length : endPos;\n\n\t\t\t// Set the range to select just the word\n\t\t\trange.setStart( textNode, startPos );\n\t\t\trange.setEnd( textNode, endPos );\n\n\t\t\t// Apply the selection\n\t\t\tselection.removeAllRanges();\n\t\t\tselection.addRange( range );\n\t\t} catch ( e ) {\n\t\t\tconsole.warn( 'Error selecting word:', e );\n\t\t}\n\t},\n\n\t// Export get caret position for external use\n\tgetCaretPosition: ( element ) => {\n\t\tif ( ! element ) {\n\t\t\treturn 0;\n\t\t}\n\n\t\ttry {\n\t\t\tconst doc = element.ownerDocument;\n\t\t\tconst docView = doc.defaultView;\n\t\t\tconst selection = docView.getSelection();\n\n\t\t\tif ( ! selection || ! selection.rangeCount ) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tconst range = selection.getRangeAt( 0 );\n\t\t\tconst preCaretRange = range.cloneRange();\n\t\t\tpreCaretRange.selectNodeContents( element );\n\t\t\tpreCaretRange.setEnd( range.endContainer, range.endOffset );\n\t\t\treturn preCaretRange.toString().length;\n\t\t} catch ( e ) {\n\t\t\tconsole.warn( 'Error getting caret position:', e );\n\t\t\treturn 0;\n\t\t}\n\t},\n\n\t// Export node position calculator for external use\n\tcalculateNodePositions: () => {\n\t\tconst mainElement = getMainElement();\n\t\tif ( ! mainElement ) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst walker = document.createTreeWalker(\n\t\t\t\tmainElement,\n\t\t\t\tNodeFilter.SHOW_TEXT,\n\t\t\t\t{\n\t\t\t\t\tacceptNode( node ) {\n\t\t\t\t\t\t// Check if node has text content\n\t\t\t\t\t\treturn node.textContent.trim().length > 0\n\t\t\t\t\t\t\t? NodeFilter.FILTER_ACCEPT\n\t\t\t\t\t\t\t: NodeFilter.FILTER_REJECT;\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tlet charCount = 0;\n\t\t\tlet node;\n\t\t\tstate.nodePositions.clear();\n\n\t\t\twhile ( ( node = walker.nextNode() ) ) {\n\t\t\t\tstate.nodePositions.set( charCount, {\n\t\t\t\t\tnode,\n\t\t\t\t\tlength: node.textContent.length,\n\t\t\t\t} );\n\t\t\t\tcharCount += node.textContent.length;\n\t\t\t}\n\t\t} catch ( e ) {\n\t\t\tconsole.warn( 'Error calculating node positions:', e );\n\t\t}\n\t},\n};\n\n// Add this function after the helper functions at the top\nconst initHighlightColors = () => {\n\tconst mainElement = getMainElement();\n\tconst blockWrapper = getBlockWrapper();\n\n\tif ( ! mainElement || ! blockWrapper ) {\n\t\treturn;\n\t}\n\n\t// Get highlight colors from block settings or use defaults\n\tconst highlightBackground =\n\t\tblockWrapper.dataset.highlightBackground || DEFAULTS.HIGHLIGHT_BG;\n\tconst highlightColor =\n\t\tblockWrapper.dataset.highlightColor || DEFAULTS.HIGHLIGHT_COLOR;\n\n\t// Set CSS custom properties on the main element for easier styling\n\tmainElement.style.setProperty(\n\t\t'--mosne-tts-highlight-bg',\n\t\thighlightBackground\n\t);\n\tmainElement.style.setProperty(\n\t\t'--mosne-tts-highlight-color',\n\t\thighlightColor\n\t);\n};\n"],"names":["store","getContext","STORAGE_KEYS","LANG","lang","SPEED","PITCH","DEFAULTS","HIGHLIGHT_BG","HIGHLIGHT_COLOR","EXCLUDE_CLASS","WORDS_PER_CHUNK","getLocalStorageItem","key","defaultValue","window","localStorage","getItem","e","getCurrentLocale","document","documentElement","getBlockWrapper","querySelector","getMainElement","getBrowser","userAgent","navigator","indexOf","isLeafNode","node","nodeType","Node","TEXT_NODE","ELEMENT_NODE","child","childNodes","state","actions","isPlaying","currentVoice","preferredVoice","utterance","voices","currentSpeed","currentPitch","selectedTextRange","hasSelection","currentChunk","textChunks","isProcessingChunks","currentHighlightedNode","nodePositions","Map","currentSelection","pausedAt","browserType","safariKeepAliveTimer","checkSynthesisReady","Promise","resolve","check","speechSynthesis","speaking","pending","setTimeout","clearHighlights","removeAllRanges","console","warn","createHighlightWrapper","doc","ownerDocument","docView","defaultView","range","createRange","setStart","setEnd","length","selectNodeContents","selection","getSelection","addRange","rangeCount","getRangeAt","loadVoices","speak","SpeechSynthesisUtterance","cancel","availableVoices","getVoices","currentLocale","localVoices","filter","voice","startsWith","find","v","voiceURI","createUtterance","content","getContent","newUtterance","rate","pitch","setupUtteranceEvents","onboundary","event","_lastCharIndex","charIndex","handleBoundaryEvent","_safariTimerId","setupSafariHighlighting","adjustedEvent","_contentOffset","undefined","onend","clearInterval","handleUtteranceEnd","onerror","error","charsPerSecond","intervalTime","currentIndex","timerId","setInterval","syntheticEvent","charLength","Math","ceil","setupSafariKeepAlive","pause","resume","Play","context","remainingText","text","substring","chunk","contentPosition","absolutePosition","mainElement","blockWrapper","excludeClassesStr","dataset","excludeClass","size","buildNodePositionsMap","split","fullText","paused","Pause","join","slice","reduce","sum","Restart","changeVoice","target","value","setItem","updateUtterance","changeSpeed","changePitch","toggleSettings","showSettings","toString","trim","cloneMain","cloneNode","excludeClasses","forEach","skip","querySelectorAll","el","remove","textContent","chunkText","wordsPerChunk","words","chunks","i","push","charPosition","targetNode","bestMatch","distance","Number","MAX_SAFE_INTEGER","positions","Array","from","keys","sort","a","b","pos","nodeData","get","abs","scrollIntoView","behavior","block","parentNode","rootElement","clear","collectTextNodes","element","charCount","classList","contains","set","callbacks","init","log","initHighlightColors","onvoiceschanged","addEventListener","isSelected","updateHighlight","background","color","requestAnimationFrame","calculateNodePositions","walker","createTreeWalker","NodeFilter","SHOW_TEXT","acceptNode","FILTER_ACCEPT","FILTER_REJECT","nextNode","selectCurrentWord","textNode","firstChild","clickPos","offsetX","offsetWidth","startPos","lastIndexOf","endPos","getCaretPosition","preCaretRange","cloneRange","endContainer","endOffset","textToSpeechHelpers","highlightBackground","highlightColor","style","setProperty"],"sourceRoot":""}