{"version":3,"file":"view.js","mappings":";;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;;AAEwC;AACmB;AACP;AAK/B;AAEd,MAAMO,UAAU,GAAKC,KAAK,IAAM;EACtC,IAAI;IACH;IACA,MAAMC,WAAW,GAAGP,sDAAc,CAAC,CAAC;IACpC,IAAK,CAAEO,WAAW,EAAG;MACpBH,yDAAkB,CAACI,QAAQ,CAAE,aAAa,EAAE,IAAIC,KAAK,CAAE,wBAAyB,CAAE,CAAC;MACnF,OAAO,EAAE;IACV;IAEA,MAAMC,OAAO,GAAGH,WAAW,CAACI,aAAa,CAACC,WAAW;IACrD,MAAMC,SAAS,GAAGH,OAAO,GAAGA,OAAO,CAACI,YAAY,CAAC,CAAC,GAAG,IAAI;IACzD,IAAIC,OAAO,GAAG,EAAE;IAEhB,IAAKF,SAAS,IAAIA,SAAS,CAACG,QAAQ,CAAC,CAAC,CAACC,IAAI,CAAC,CAAC,CAACC,MAAM,GAAG,CAAC,EAAG;MAC1D;MACA,MAAMC,UAAU,GAAGN,SAAS,CAACG,QAAQ,CAAC,CAAC;MACvCD,OAAO,GAAGb,uDAAgB,CAACkB,YAAY,CAAED,UAAW,CAAC;MAErDb,KAAK,CAACe,iBAAiB,GAAG;QACzBC,IAAI,EAAEP,OAAO;QACbQ,YAAY,EAAE;MACf,CAAC;IACF,CAAC,MAAM;MACN;MACA,MAAMC,YAAY,GAAGzB,uDAAe,CAAC,CAAC;MACtC,MAAM0B,iBAAiB,GAAGD,YAAY,EAAEE,OAAO,CAACC,YAAY,IAAI7B,gDAAQ,CAAC8B,aAAa;MACtF,MAAMC,cAAc,GAAGJ,iBAAiB,CAACK,KAAK,CAAE,KAAM,CAAC,CAACC,MAAM,CAAEC,GAAG,IAAIA,GAAG,CAACf,IAAI,CAAC,CAAE,CAAC;;MAEnF;MACAF,OAAO,GAAGZ,gDAAS,CAAC8B,cAAc,CAAE1B,WAAY,CAAC;;MAEjD;MACA,IAAKA,WAAW,EAAG;QAClBN,iEAAqB,CACpBK,KAAK,EACLC,WAAW,EACXsB,cACD,CAAC;MACF;MAEAvB,KAAK,CAACe,iBAAiB,GAAG;QACzBE,YAAY,EAAE;MACf,CAAC;IACF;;IAEA;IACA,IAAKR,OAAO,CAACG,MAAM,GAAG,KAAK,EAAG;MAAE;MAC/Bd,yDAAkB,CAACI,QAAQ,CAAE,aAAa,EAAE,IAAIC,KAAK,CAAE,iCAAkC,CAAE,CAAC;MAC5FM,OAAO,GAAGA,OAAO,CAACmB,SAAS,CAAE,CAAC,EAAE,KAAM,CAAC;IACxC;;IAEA;IACA5B,KAAK,CAAC6B,UAAU,GAAGC,SAAS,CAAErB,OAAO,EAAEjB,gDAAQ,CAACuC,eAAgB,CAAC;IACjE/B,KAAK,CAACgC,YAAY,GAAG,CAAC;;IAEtB;IACA,OAAOhC,KAAK,CAAC6B,UAAU,CAACjB,MAAM,GAAG,CAAC,GAAGZ,KAAK,CAAC6B,UAAU,CAAE,CAAC,CAAE,GAAG,EAAE;EAChE,CAAC,CAAC,OAAQI,KAAK,EAAG;IACjBnC,yDAAkB,CAACI,QAAQ,CAAE,aAAa,EAAE+B,KAAM,CAAC;IACnD,OAAO,EAAE;EACV;AACD,CAAC;;AAED;AACO,MAAMH,SAAS,GAAGA,CAAEd,IAAI,EAAEkB,aAAa,KAAM;EACnD,IAAI;IACH;IACA,IAAK,CAAElB,IAAI,IAAI,OAAOA,IAAI,KAAK,QAAQ,IAAIA,IAAI,CAACL,IAAI,CAAC,CAAC,KAAK,EAAE,EAAG;MAC/D,OAAO,CAAE,EAAE,CAAE;IACd;IAEA,IAAK,CAAEuB,aAAa,IAAIA,aAAa,GAAG,CAAC,IAAIA,aAAa,GAAG,IAAI,EAAG;MACnEA,aAAa,GAAG1C,gDAAQ,CAACuC,eAAe;IACzC;;IAEA;IACA,MAAMI,aAAa,GAAGvC,uDAAgB,CAACkB,YAAY,CAAEE,IAAK,CAAC;;IAE3D;IACA,MAAMoB,KAAK,GAAGD,aAAa,CAACxB,IAAI,CAAC,CAAC,CAACa,KAAK,CAAE,KAAM,CAAC,CAACC,MAAM,CAAEY,IAAI,IAAIA,IAAI,CAACzB,MAAM,GAAG,CAAE,CAAC;IACnF,MAAM0B,MAAM,GAAG,EAAE;;IAEjB;IACA,KAAM,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,KAAK,CAACxB,MAAM,EAAE2B,CAAC,IAAIL,aAAa,EAAG;MACvD,MAAMM,KAAK,GAAGJ,KAAK,CAACK,KAAK,CAAEF,CAAC,EAAEA,CAAC,GAAGL,aAAc,CAAC,CAACQ,IAAI,CAAE,GAAI,CAAC;MAC7D,IAAKF,KAAK,CAAC7B,IAAI,CAAC,CAAC,CAACC,MAAM,GAAG,CAAC,EAAG;QAC9B0B,MAAM,CAACK,IAAI,CAAEH,KAAM,CAAC;MACrB;IACD;IAEA,OAAOF,MAAM,CAAC1B,MAAM,GAAG,CAAC,GAAG0B,MAAM,GAAG,CAAE,EAAE,CAAE;EAC3C,CAAC,CAAC,OAAQL,KAAK,EAAG;IACjBnC,yDAAkB,CAACI,QAAQ,CAAE,YAAY,EAAE+B,KAAM,CAAC;IAClD,OAAO,CAAE,EAAE,CAAE;EACd;AACD,CAAC;;;;;;;;;;;;;;;;;;;;AC5GD;AACA;AACA;;AAEwC;AACmB;;AAE3D;AACO,MAAMW,eAAe,GAAK5C,KAAK,IAAM;EAC3C,IAAKA,KAAK,CAAC6C,gBAAgB,EAAG;IAC7B,IAAI;MACH7C,KAAK,CAAC6C,gBAAgB,CAACC,eAAe,CAAC,CAAC;IACzC,CAAC,CAAC,OAAQC,CAAC,EAAG;MACb;MACAC,OAAO,CAACC,IAAI,CAAE,4BAA4B,EAAEF,CAAE,CAAC;IAChD;IACA/C,KAAK,CAAC6C,gBAAgB,GAAG,IAAI;EAC9B;EACA7C,KAAK,CAACkD,sBAAsB,GAAG,IAAI;AACpC,CAAC;AAEM,MAAMC,sBAAsB,GAAGA,CAAEnD,KAAK,EAAEoD,IAAI,KAAM;EACxD;EACA,IAAK,CAAEA,IAAI,EAAG;IACb,OAAO,IAAI;EACZ;EAEA,MAAMC,GAAG,GAAGD,IAAI,CAAC/C,aAAa;EAC9B,MAAMD,OAAO,GAAGiD,GAAG,CAAC/C,WAAW;EAE/B,IAAK,CAAEF,OAAO,EAAG;IAChB,OAAO,IAAI;EACZ;;EAEA;EACAwC,eAAe,CAAE5C,KAAM,CAAC;EAExB,IAAI;IACH;IACA,MAAMsD,KAAK,GAAGD,GAAG,CAACE,WAAW,CAAC,CAAC;;IAE/B;IACA,IAAKH,IAAI,CAACI,QAAQ,KAAKC,IAAI,CAACC,SAAS,EAAG;MACvCJ,KAAK,CAACK,QAAQ,CAAEP,IAAI,EAAE,CAAE,CAAC;MACzBE,KAAK,CAACM,MAAM,CAAER,IAAI,EAAEA,IAAI,CAACxC,MAAO,CAAC;IAClC,CAAC,MAAM;MACN0C,KAAK,CAACO,kBAAkB,CAAET,IAAK,CAAC;IACjC;;IAEA;IACA,MAAM7C,SAAS,GAAGH,OAAO,CAACI,YAAY,CAAC,CAAC;IACxC,IAAKD,SAAS,EAAG;MAChBA,SAAS,CAACuC,eAAe,CAAC,CAAC;MAC3BvC,SAAS,CAACuD,QAAQ,CAAER,KAAM,CAAC;;MAE3B;MACAtD,KAAK,CAAC6C,gBAAgB,GAAGtC,SAAS;;MAElC;MACA;MACA,IAAKA,SAAS,CAACwD,UAAU,GAAG,CAAC,EAAG;QAC/BxD,SAAS,CAACyD,UAAU,CAAE,CAAE,CAAC;QACzBzD,SAAS,CAACyD,UAAU,CAAE,CAAE,CAAC;MAC1B;IACD;EACD,CAAC,CAAC,OAAQjB,CAAC,EAAG;IACbC,OAAO,CAACC,IAAI,CAAE,2BAA2B,EAAEF,CAAE,CAAC;EAC/C;AACD,CAAC;;AAED;AACO,MAAMkB,uBAAuB,GAAGA,CAAEjE,KAAK,EAAES,OAAO,KAAM;EAC5D,IAAKT,KAAK,CAACkE,WAAW,KAAK,QAAQ,EAAG;IACrC,OAAO,IAAI;EACZ;;EAEA;EACA,MAAMC,cAAc,GAAG,EAAE,GAAGnE,KAAK,CAACoE,YAAY;EAC9C,MAAMC,YAAY,GAAG,GAAG,CAAC,CAAC;;EAE1B,IAAIC,YAAY,GAAG,CAAC;EACpB,MAAMC,OAAO,GAAGC,WAAW,CAAE,MAAM;IAClC,IAAK,CAAExE,KAAK,CAACyE,SAAS,EAAG;MACxBC,aAAa,CAAEH,OAAQ,CAAC;MACxB;IACD;;IAEA;IACA,MAAMI,cAAc,GAAG;MACtBC,SAAS,EAAEN,YAAY;MACvBO,UAAU,EAAE;IACb,CAAC;IAEDC,mBAAmB,CAAE9E,KAAK,EAAE2E,cAAc,EAAElE,OAAQ,CAAC;;IAErD;IACA6D,YAAY,IAAIS,IAAI,CAACC,IAAI,CAAIb,cAAc,GAAGE,YAAY,GAAK,IAAK,CAAC;EACtE,CAAC,EAAEA,YAAa,CAAC;EAEjB,OAAOE,OAAO;AACf,CAAC;AAEM,MAAMO,mBAAmB,GAAGA,CAAE9E,KAAK,EAAEiF,KAAK,KAAM;EACtD,MAAMhF,WAAW,GAAGP,sDAAc,CAAC,CAAC;EACpC,IAAK,CAAEO,WAAW,EAAG;IACpB;EACD;EAEA,IAAI;IACH;IACA,IAAIiF,iBAAiB,GAAGD,KAAK,CAACL,SAAS;IACvC,IAAK5E,KAAK,CAACgC,YAAY,GAAG,CAAC,EAAG;MAC7B;MACA,KAAM,IAAIO,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGvC,KAAK,CAACgC,YAAY,EAAEO,CAAC,EAAE,EAAG;QAC9C2C,iBAAiB,IAAIlF,KAAK,CAAC6B,UAAU,CAAEU,CAAC,CAAE,CAAC3B,MAAM,GAAG,CAAC,CAAC,CAAC;MACxD;IACD;IAEA,IAAKZ,KAAK,CAACe,iBAAiB,EAAEE,YAAY,EAAG;MAC5C;IAAA,CACA,MAAM;MACN;MACA,MAAMC,YAAY,GAAGzB,uDAAe,CAAC,CAAC;MACtC,MAAM0B,iBAAiB,GACtBD,YAAY,EAAEE,OAAO,CAACC,YAAY,IAAI7B,gDAAQ,CAAC8B,aAAa;MAC7D,MAAMC,cAAc,GAAGJ,iBAAiB,CAACK,KAAK,CAAE,KAAM,CAAC;;MAEvD;MACA,IAAKxB,KAAK,CAACmF,aAAa,CAACC,IAAI,KAAK,CAAC,EAAG;QACrCzF,qBAAqB,CAAEK,KAAK,EAAEC,WAAW,EAAEsB,cAAe,CAAC;MAC5D;;MAEA;MACA,IAAI8D,UAAU,GAAG,IAAI;MACrB,IAAIC,SAAS,GAAG;QACflC,IAAI,EAAE,IAAI;QACVmC,QAAQ,EAAEC,MAAM,CAACC;MAClB,CAAC;;MAED;MACA,MAAMC,SAAS,GAAGC,KAAK,CAACC,IAAI,CAAE5F,KAAK,CAACmF,aAAa,CAACU,IAAI,CAAC,CAAE,CAAC,CAACC,IAAI,CAC9D,CAAEC,CAAC,EAAEC,CAAC,KAAMD,CAAC,GAAGC,CACjB,CAAC;MAED,KAAM,IAAIzD,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGmD,SAAS,CAAC9E,MAAM,EAAE2B,CAAC,EAAE,EAAG;QAC5C,MAAM0D,GAAG,GAAGP,SAAS,CAAEnD,CAAC,CAAE;QAC1B,MAAM2D,QAAQ,GAAGlG,KAAK,CAACmF,aAAa,CAACgB,GAAG,CAAEF,GAAI,CAAC;;QAE/C;QACA,IACCA,GAAG,IAAIf,iBAAiB,IACxBA,iBAAiB,GAAGe,GAAG,GAAGC,QAAQ,CAACtF,MAAM,EACxC;UACDyE,UAAU,GAAGa,QAAQ,CAAC9C,IAAI;UAC1B;QACD;;QAEA;QACA,IAAKpD,KAAK,CAACkE,WAAW,KAAK,SAAS,EAAG;UACtC,MAAMqB,QAAQ,GAAGR,IAAI,CAACqB,GAAG,CAAEH,GAAG,GAAGf,iBAAkB,CAAC;UACpD,IAAKK,QAAQ,GAAGD,SAAS,CAACC,QAAQ,EAAG;YACpCD,SAAS,GAAG;cAAElC,IAAI,EAAE8C,QAAQ,CAAC9C,IAAI;cAAEmC;YAAS,CAAC;UAC9C;QACD;MACD;;MAEA;MACA,IACC,CAAEF,UAAU,IACZrF,KAAK,CAACkE,WAAW,KAAK,SAAS,IAC/BoB,SAAS,CAAClC,IAAI,EACb;QACDiC,UAAU,GAAGC,SAAS,CAAClC,IAAI;MAC5B;;MAEA;MACA,IACCiC,UAAU,IACVA,UAAU,KAAKrF,KAAK,CAACkD,sBAAsB,IAC3CmC,UAAU,CAACgB,WAAW,CAAC1F,IAAI,CAAC,CAAC,CAACC,MAAM,GAAG,CAAC,EACvC;QACDgC,eAAe,CAAE5C,KAAM,CAAC;QACxBmD,sBAAsB,CAAEnD,KAAK,EAAEqF,UAAW,CAAC;QAC3CrF,KAAK,CAACkD,sBAAsB,GAAGmC,UAAU;;QAEzC;QACA,IAAKA,UAAU,CAAC7B,QAAQ,KAAKC,IAAI,CAACC,SAAS,EAAG;UAC7C2B,UAAU,CAACiB,cAAc,CAAE;YAC1BC,QAAQ,EAAE,QAAQ;YAClBC,KAAK,EAAE;UACR,CAAE,CAAC;QACJ,CAAC,MAAM,IAAKnB,UAAU,CAACoB,UAAU,EAAG;UACnCpB,UAAU,CAACoB,UAAU,CAACH,cAAc,CAAE;YACrCC,QAAQ,EAAE,QAAQ;YAClBC,KAAK,EAAE;UACR,CAAE,CAAC;QACJ;MACD;IACD;EACD,CAAC,CAAC,OAAQzD,CAAC,EAAG;IACbC,OAAO,CAACf,KAAK,CAAE,qBAAqB,EAAEc,CAAE,CAAC;EAC1C;AACD,CAAC;;AAED;AACO,MAAMpD,qBAAqB,GAAGA,CAAEK,KAAK,EAAE0G,WAAW,EAAEnF,cAAc,KAAM;EAC9EvB,KAAK,CAACmF,aAAa,CAACwB,KAAK,CAAC,CAAC;;EAE3B;EACA,MAAMC,gBAAgB,GAAGA,CAAEC,OAAO,EAAEC,SAAS,GAAG,CAAC,KAAM;IACtD;IACA,IAAKD,OAAO,CAACE,SAAS,EAAG;MACxB,KAAM,MAAM1F,YAAY,IAAIE,cAAc,EAAG;QAC5C,IACCF,YAAY,IACZwF,OAAO,CAACE,SAAS,CAACC,QAAQ,CAAE3F,YAAa,CAAC,EACzC;UACD,OAAOyF,SAAS;QACjB;MACD;IACD;;IAEA;IACA,IAAKD,OAAO,CAACrD,QAAQ,KAAKC,IAAI,CAACC,SAAS,EAAG;MAC1C,MAAM1C,IAAI,GAAG6F,OAAO,CAACR,WAAW;MAChC,IAAKrF,IAAI,CAACL,IAAI,CAAC,CAAC,CAACC,MAAM,GAAG,CAAC,EAAG;QAC7BZ,KAAK,CAACmF,aAAa,CAAC8B,GAAG,CAAEH,SAAS,EAAE;UACnC1D,IAAI,EAAEyD,OAAO;UACbjG,MAAM,EAAEI,IAAI,CAACJ;QACd,CAAE,CAAC;QACHkG,SAAS,IAAI9F,IAAI,CAACJ,MAAM;MACzB;MACA,OAAOkG,SAAS;IACjB;;IAEA;IACA,IAAKD,OAAO,CAACK,UAAU,IAAIL,OAAO,CAACK,UAAU,CAACtG,MAAM,GAAG,CAAC,EAAG;MAC1D,KAAM,MAAMuG,KAAK,IAAIN,OAAO,CAACK,UAAU,EAAG;QACzCJ,SAAS,GAAGF,gBAAgB,CAAEO,KAAK,EAAEL,SAAU,CAAC;MACjD;IACD;IAEA,OAAOA,SAAS;EACjB,CAAC;;EAED;EACAF,gBAAgB,CAAEF,WAAY,CAAC;AAChC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvPD;AACA;AACA;;AAE4B;AACA;AACJ;AACI;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACR3B;AACA;AACA;;AAEsD;AACuB;AACL;AAKnD;AAC6C;AAC3B;AACC;AAMnB;;AAErB;AACO,MAAMmB,IAAI,GAAG,MAAQ7H,KAAK,IAAM;EACtC,MAAM8H,OAAO,GAAGV,oEAAU,CAAC,CAAC;EAC5B,IAAKU,OAAO,EAAG;IACdA,OAAO,CAACrD,SAAS,GAAG,IAAI;EACzB;EACAzE,KAAK,CAACyE,SAAS,GAAG,IAAI;;EAEtB;EACA,IAAKzE,KAAK,CAACkE,WAAW,KAAK,SAAS,IAAIlE,KAAK,CAAC+H,QAAQ,EAAG;IACxD;IACA,MAAMC,aAAa,GAAGhI,KAAK,CAAC+H,QAAQ,CAAC/G,IAAI,CAACY,SAAS,CAClD5B,KAAK,CAAC+H,QAAQ,CAACnD,SAChB,CAAC;;IAED;IACA5E,KAAK,CAACgC,YAAY,GAAGhC,KAAK,CAAC+H,QAAQ,CAACvF,KAAK;;IAEzC;IACA,MAAMyF,YAAY,GAAG,IAAIC,MAAM,CAACC,wBAAwB,CACvDH,aACD,CAAC;IACDC,YAAY,CAACG,IAAI,GAAGf,wDAAgB,CAAC,CAAC;IACtCY,YAAY,CAACI,IAAI,GAAGrI,KAAK,CAACoE,YAAY;IACtC6D,YAAY,CAACK,KAAK,GAAGtI,KAAK,CAACuI,YAAY;;IAEvC;IACAN,YAAY,CAACO,cAAc,GAAG,CAAC;;IAE/B;IACAP,YAAY,CAACQ,cAAc,GAAGzI,KAAK,CAAC+H,QAAQ,CAACW,eAAe;IAE5D,IAAK1I,KAAK,CAAC2I,YAAY,EAAG;MACzB,MAAMC,KAAK,GAAG5I,KAAK,CAAC6I,MAAM,CAACC,IAAI,CAC5BC,CAAC,IAAMA,CAAC,CAACC,QAAQ,KAAKhJ,KAAK,CAAC2I,YAAY,CAACK,QAC5C,CAAC;MACDf,YAAY,CAACW,KAAK,GAAGA,KAAK;IAC3B;;IAEA;IACAX,YAAY,CAACgB,UAAU,GAAKhE,KAAK,IAAM;MACtC;MACAgD,YAAY,CAACO,cAAc,GAAGvD,KAAK,CAACL,SAAS,IAAI,CAAC;;MAElD;MACA,MAAMsE,gBAAgB,GACrB,CAAEjE,KAAK,CAACL,SAAS,IAAI,CAAC,IAAK5E,KAAK,CAAC+H,QAAQ,CAACW,eAAe;;MAE1D;MACA,MAAMS,aAAa,GAAG;QACrB,GAAGlE,KAAK;QACRL,SAAS,EAAEsE,gBAAgB;QAC3B;QACArE,UAAU,EAAEI,KAAK,CAACJ,UAAU,IAAI;MACjC,CAAC;;MAED;MACA,MAAM5E,WAAW,GAAGP,sDAAc,CAAC,CAAC;MACpC,IAAKO,WAAW,EAAG;QAClB;QACA,MAAMiB,YAAY,GAAGzB,uDAAe,CAAC,CAAC;QACtC,MAAM0B,iBAAiB,GACtBD,YAAY,EAAEE,OAAO,CAACC,YAAY,IAClC7B,gDAAQ,CAAC8B,aAAa;QAEvB,IAAKtB,KAAK,CAACmF,aAAa,CAACC,IAAI,KAAK,CAAC,EAAG;UACrCzF,iEAAqB,CACpBK,KAAK,EACLC,WAAW,EACXkB,iBAAiB,CAACK,KAAK,CAAE,KAAM,CAChC,CAAC;QACF;;QAEA;QACAsD,+DAAmB,CAClB9E,KAAK,EACLmJ,aAAa,EACbnJ,KAAK,CAAC+H,QAAQ,CAACqB,QAAQ,IAAIpJ,KAAK,CAAC+H,QAAQ,CAAC/G,IAC3C,CAAC;MACF;IACD,CAAC;IAEDiH,YAAY,CAACoB,KAAK,GAAG,MAAM5B,8DAAkB,CAAEzH,KAAM,CAAC;IAEtDA,KAAK,CAACsJ,SAAS,GAAGrB,YAAY;;IAE9B;IACAC,MAAM,CAACqB,eAAe,CAACC,KAAK,CAAExJ,KAAK,CAACsJ,SAAU,CAAC;;IAE/C;IACA,IAAKtJ,KAAK,CAACkE,WAAW,KAAK,QAAQ,EAAG;MACrCqD,gEAAoB,CAAEvH,KAAM,CAAC;IAC9B;;IAEA;IACAA,KAAK,CAAC+H,QAAQ,GAAG,IAAI;IAErB;EACD;EAEA,IAAK/H,KAAK,CAAC6B,UAAU,CAACjB,MAAM,KAAK,CAAC,IAAIZ,KAAK,CAACgC,YAAY,KAAK,CAAC,EAAG;IAChEjC,oDAAU,CAAEC,KAAM,CAAC;IACnBwH,2DAAe,CAAExH,KAAK,EAAE8H,OAAQ,CAAC;EAClC;EAEA,IAAI;IACH,IAAKI,MAAM,CAACqB,eAAe,CAACE,MAAM,EAAG;MACpCvB,MAAM,CAACqB,eAAe,CAACG,MAAM,CAAC,CAAC;MAC/B;IACD;EACD,CAAC,CAAC,OAAQ3G,CAAC,EAAG;IACbC,OAAO,CAACC,IAAI,CAAE,mCAAmC,EAAEF,CAAE,CAAC;IACtD;IACAyE,2DAAe,CAAExH,KAAK,EAAE8H,OAAQ,CAAC;EAClC;;EAEA;EACA,IAAK9H,KAAK,CAACkE,WAAW,KAAK,QAAQ,IAAIlE,KAAK,CAACkE,WAAW,KAAK,MAAM,EAAG;IACrE,IAAKgE,MAAM,CAACqB,eAAe,CAACI,QAAQ,EAAG;MACtCzB,MAAM,CAACqB,eAAe,CAACK,MAAM,CAAC,CAAC;MAC/BC,UAAU,CAAE,MAAM;QACjB,IAAK7J,KAAK,CAACsJ,SAAS,EAAG;UACtBpB,MAAM,CAACqB,eAAe,CAACC,KAAK,CAAExJ,KAAK,CAACsJ,SAAU,CAAC;QAChD;MACD,CAAC,EAAE,EAAG,CAAC;MACP;IACD;EACD;EAEA,IAAKtJ,KAAK,CAACsJ,SAAS,EAAG;IACtBpB,MAAM,CAACqB,eAAe,CAACC,KAAK,CAAExJ,KAAK,CAACsJ,SAAU,CAAC;;IAE/C;IACA,IAAKtJ,KAAK,CAACkE,WAAW,KAAK,QAAQ,EAAG;MACrCqD,gEAAoB,CAAEvH,KAAM,CAAC;IAC9B;EACD;AACD,CAAC;AAEM,MAAM8J,KAAK,GAAG,MAAQ9J,KAAK,IAAM;EACvC,MAAM8H,OAAO,GAAGV,oEAAU,CAAC,CAAC;EAC5B,IAAKU,OAAO,EAAG;IACdA,OAAO,CAACrD,SAAS,GAAG,KAAK;EAC1B;EACAzE,KAAK,CAACyE,SAAS,GAAG,KAAK;EACvB7B,2DAAe,CAAE5C,KAAM,CAAC;;EAExB;EACA,IAAKA,KAAK,CAACkE,WAAW,KAAK,SAAS,EAAG;IACtC;IACA,IAAKgE,MAAM,CAACqB,eAAe,CAACI,QAAQ,EAAG;MACtC;MACA,MAAMP,QAAQ,GAAGpJ,KAAK,CAAC6B,UAAU,CAACa,IAAI,CAAE,GAAI,CAAC;;MAE7C;MACA1C,KAAK,CAAC+H,QAAQ,GAAG;QAChB/G,IAAI,EAAEhB,KAAK,CAACsJ,SAAS,CAACtI,IAAI;QAC1B4D,SAAS,EAAE5E,KAAK,CAACsJ,SAAS,CAACd,cAAc,IAAI,CAAC;QAC9ChG,KAAK,EAAExC,KAAK,CAACgC,YAAY;QACzB;QACA0G,eAAe,EACd1I,KAAK,CAACsJ,SAAS,CAACd,cAAc,IAC5BxI,KAAK,CAACgC,YAAY,GAAG,CAAC,GACrBhC,KAAK,CAAC6B,UAAU,CACfY,KAAK,CAAE,CAAC,EAAEzC,KAAK,CAACgC,YAAa,CAAC,CAC9B+H,MAAM,CACN,CAAEC,GAAG,EAAExH,KAAK,KAAMwH,GAAG,GAAGxH,KAAK,CAAC5B,MAAM,EACpC,CACD,CAAC,GACD,CAAC,CAAE;QACP;QACAwI;MACD,CAAC;;MAED;MACAlB,MAAM,CAACqB,eAAe,CAACK,MAAM,CAAC,CAAC;IAChC;EACD,CAAC,MAAM,IAAK5J,KAAK,CAACkE,WAAW,KAAK,QAAQ,EAAG;IAC5C;IACA,IAAKgE,MAAM,CAACqB,eAAe,CAACI,QAAQ,EAAG;MACtC;MACA,MAAMP,QAAQ,GAAGpJ,KAAK,CAAC6B,UAAU,CAACa,IAAI,CAAE,GAAI,CAAC;;MAE7C;MACA1C,KAAK,CAAC+H,QAAQ,GAAG;QAChB/G,IAAI,EAAEhB,KAAK,CAACsJ,SAAS,CAACtI,IAAI;QAC1B4D,SAAS,EAAE5E,KAAK,CAACsJ,SAAS,CAACd,cAAc,IAAI,CAAC;QAC9ChG,KAAK,EAAExC,KAAK,CAACgC,YAAY;QACzB0G,eAAe,EACd1I,KAAK,CAACsJ,SAAS,CAACd,cAAc,IAC5BxI,KAAK,CAACgC,YAAY,GAAG,CAAC,GACrBhC,KAAK,CAAC6B,UAAU,CACfY,KAAK,CAAE,CAAC,EAAEzC,KAAK,CAACgC,YAAa,CAAC,CAC9B+H,MAAM,CACN,CAAEC,GAAG,EAAExH,KAAK,KAAMwH,GAAG,GAAGxH,KAAK,CAAC5B,MAAM,EACpC,CACD,CAAC,GACD,CAAC,CAAE;QACP;QACAwI;MACD,CAAC;;MAED;MACA,IAAKpJ,KAAK,CAACsJ,SAAS,CAACW,cAAc,EAAG;QACrCvF,aAAa,CAAE1E,KAAK,CAACsJ,SAAS,CAACW,cAAe,CAAC;MAChD;MAEA,IAAKjK,KAAK,CAACkK,oBAAoB,EAAG;QACjCxF,aAAa,CAAE1E,KAAK,CAACkK,oBAAqB,CAAC;QAC3ClK,KAAK,CAACkK,oBAAoB,GAAG,IAAI;MAClC;MAEAhC,MAAM,CAACqB,eAAe,CAACK,MAAM,CAAC,CAAC;IAChC;EACD,CAAC,MAAM,IACN1B,MAAM,CAACqB,eAAe,CAACI,QAAQ,IAC/B,CAAEzB,MAAM,CAACqB,eAAe,CAACE,MAAM,EAC9B;IACD;IACAvB,MAAM,CAACqB,eAAe,CAACY,KAAK,CAAC,CAAC;EAC/B;AACD,CAAC;AAEM,MAAMC,OAAO,GAAKpK,KAAK,IAAM;EACnC,MAAM8H,OAAO,GAAGV,oEAAU,CAAC,CAAC;EAC5B,IAAKU,OAAO,EAAG;IACdA,OAAO,CAACrD,SAAS,GAAG,KAAK;EAC1B;EACAzE,KAAK,CAACyE,SAAS,GAAG,KAAK;;EAEvB;EACA,IAAKzE,KAAK,CAACkE,WAAW,KAAK,QAAQ,EAAG;IACrC,IAAKlE,KAAK,CAACsJ,SAAS,IAAItJ,KAAK,CAACsJ,SAAS,CAACW,cAAc,EAAG;MACxDvF,aAAa,CAAE1E,KAAK,CAACsJ,SAAS,CAACW,cAAe,CAAC;IAChD;IAEA,IAAKjK,KAAK,CAACkK,oBAAoB,EAAG;MACjCxF,aAAa,CAAE1E,KAAK,CAACkK,oBAAqB,CAAC;MAC3ClK,KAAK,CAACkK,oBAAoB,GAAG,IAAI;IAClC;EACD;EAEAhC,MAAM,CAACqB,eAAe,CAACK,MAAM,CAAC,CAAC;EAE/B5J,KAAK,CAACgC,YAAY,GAAG,CAAC;EACtBhC,KAAK,CAAC6B,UAAU,GAAG,EAAE;EAErBe,2DAAe,CAAE5C,KAAM,CAAC;AACzB,CAAC;AAEM,MAAMqK,WAAW,GAAG,MAAAA,CAAQrK,KAAK,EAAE+C,CAAC,KAAM;EAChD,IAAI;IACH;IACA,MAAMuH,cAAc,GAAG5C,qDAAc,CAAC6C,aAAa,CAAExH,CAAE,CAAC;IACxD,IAAK,CAAEuH,cAAc,EAAG;MACvBxK,yDAAkB,CAACI,QAAQ,CAAE,cAAc,EAAE,IAAIC,KAAK,CAAE,sBAAuB,CAAE,CAAC;MAClF,OAAO,KAAK;IACb;IAEA,MAAMqK,KAAK,GAAG7C,mDAAY,CAAC8C,aAAa,CAAEH,cAAc,CAACI,MAAM,CAACC,KAAM,CAAC;IACvE,IAAKH,KAAK,KAAK,IAAI,EAAG;MACrB1K,yDAAkB,CAACI,QAAQ,CAAE,cAAc,EAAE,IAAIC,KAAK,CAAE,qBAAsB,CAAE,CAAC;MACjF,OAAO,KAAK;IACb;IAEA+H,MAAM,CAACqB,eAAe,CAACK,MAAM,CAAC,CAAC;IAE/B,MAAM9B,OAAO,GAAGV,oEAAU,CAAC,CAAC;IAC5B,IAAKU,OAAO,EAAG;MACdA,OAAO,CAACrD,SAAS,GAAG,KAAK;IAC1B;IAEAzE,KAAK,CAACoE,YAAY,GAAGoG,KAAK;;IAE1B;IACA,MAAMI,aAAa,GAAGvD,wDAAgB,CAAC,CAAC;IACxC,MAAMwD,UAAU,GAAG,mBAAoBD,aAAa,EAAG;IACvD,MAAME,OAAO,GAAGlD,oDAAa,CAACmD,OAAO,CAAEF,UAAU,EAAEL,KAAK,CAAC9J,QAAQ,CAAC,CAAE,CAAC;IAErE,IAAK,CAAEoK,OAAO,EAAG;MAChBhL,yDAAkB,CAACI,QAAQ,CAAE,cAAc,EAAE,IAAIC,KAAK,CAAE,sCAAuC,CAAE,CAAC;IACnG;IAEA,MAAMmH,+DAAmB,CAAC,CAAC;IAC3BE,2DAAe,CAAExH,KAAK,EAAE8H,OAAQ,CAAC;IAEjC,IAAKA,OAAO,IAAI,CAAEA,OAAO,CAACrD,SAAS,EAAG;MACrCoF,UAAU,CAAE,MAAM;QACjB/B,OAAO,CAACrD,SAAS,GAAG,IAAI;QACxByD,MAAM,CAACqB,eAAe,CAACC,KAAK,CAAExJ,KAAK,CAACsJ,SAAU,CAAC;MAChD,CAAC,EAAE,EAAG,CAAC;IACR;IAEA,OAAO,IAAI;EACZ,CAAC,CAAC,OAAQrH,KAAK,EAAG;IACjBnC,yDAAkB,CAACI,QAAQ,CAAE,cAAc,EAAE+B,KAAM,CAAC;IACpD,OAAO,KAAK;EACb;AACD,CAAC;AAEM,MAAM+I,WAAW,GAAG,MAAAA,CAAQhL,KAAK,EAAE+C,CAAC,KAAM;EAChD,IAAI;IACH;IACA,MAAMuH,cAAc,GAAG5C,qDAAc,CAAC6C,aAAa,CAAExH,CAAE,CAAC;IACxD,IAAK,CAAEuH,cAAc,EAAG;MACvBxK,yDAAkB,CAACI,QAAQ,CAAE,cAAc,EAAE,IAAIC,KAAK,CAAE,sBAAuB,CAAE,CAAC;MAClF,OAAO,KAAK;IACb;IAEA,MAAMmI,KAAK,GAAGX,mDAAY,CAACsD,aAAa,CAAEX,cAAc,CAACI,MAAM,CAACC,KAAM,CAAC;IACvE,IAAKrC,KAAK,KAAK,IAAI,EAAG;MACrBxI,yDAAkB,CAACI,QAAQ,CAAE,cAAc,EAAE,IAAIC,KAAK,CAAE,qBAAsB,CAAE,CAAC;MACjF,OAAO,KAAK;IACb;IAEA+H,MAAM,CAACqB,eAAe,CAACK,MAAM,CAAC,CAAC;IAC/B,MAAM9B,OAAO,GAAGV,oEAAU,CAAC,CAAC;IAC5B,IAAKU,OAAO,EAAG;MACdA,OAAO,CAACrD,SAAS,GAAG,KAAK;IAC1B;IAEAzE,KAAK,CAACuI,YAAY,GAAGD,KAAK;;IAE1B;IACA,MAAMsC,aAAa,GAAGvD,wDAAgB,CAAC,CAAC;IACxC,MAAMwD,UAAU,GAAG,mBAAoBD,aAAa,EAAG;IACvD,MAAME,OAAO,GAAGlD,oDAAa,CAACmD,OAAO,CAAEF,UAAU,EAAEvC,KAAK,CAAC5H,QAAQ,CAAC,CAAE,CAAC;IAErE,IAAK,CAAEoK,OAAO,EAAG;MAChBhL,yDAAkB,CAACI,QAAQ,CAAE,cAAc,EAAE,IAAIC,KAAK,CAAE,sCAAuC,CAAE,CAAC;IACnG;IAEA,MAAMmH,+DAAmB,CAAC,CAAC;IAC3BE,2DAAe,CAAExH,KAAK,EAAE8H,OAAQ,CAAC;IAEjC,IAAKA,OAAO,IAAI,CAAEA,OAAO,CAACrD,SAAS,EAAG;MACrCoF,UAAU,CAAE,MAAM;QACjB/B,OAAO,CAACrD,SAAS,GAAG,IAAI;QACxByD,MAAM,CAACqB,eAAe,CAACC,KAAK,CAAExJ,KAAK,CAACsJ,SAAU,CAAC;MAChD,CAAC,EAAE,EAAG,CAAC;IACR;IAEA,OAAO,IAAI;EACZ,CAAC,CAAC,OAAQrH,KAAK,EAAG;IACjBnC,yDAAkB,CAACI,QAAQ,CAAE,cAAc,EAAE+B,KAAM,CAAC;IACpD,OAAO,KAAK;EACb;AACD,CAAC;AAEM,MAAMiJ,cAAc,GAAGA,CAAA,KAAM;EACnC,IAAI;IACH,MAAMpD,OAAO,GAAGV,oEAAU,CAAC,CAAC;IAC5B,IAAKU,OAAO,EAAG;MACdA,OAAO,CAACqD,YAAY,GAAG,CAAErD,OAAO,CAACqD,YAAY;IAC9C;IACA,OAAO,IAAI;EACZ,CAAC,CAAC,OAAQlJ,KAAK,EAAG;IACjBnC,yDAAkB,CAACI,QAAQ,CAAE,iBAAiB,EAAE+B,KAAM,CAAC;IACvD,OAAO,KAAK;EACb;AACD,CAAC;;;;;;;;;;;;;;;AC9XD;AACA;AACA;;AAEA;AACO,MAAMqF,mBAAmB,GAAGA,CAAA,KAAM;EACxC,OAAO,IAAI8D,OAAO,CAAIC,OAAO,IAAM;IAClC,MAAMC,KAAK,GAAGA,CAAA,KAAM;MACnB,IACC,CAAEpD,MAAM,CAACqB,eAAe,CAACI,QAAQ,IACjC,CAAEzB,MAAM,CAACqB,eAAe,CAACgC,OAAO,EAC/B;QACDF,OAAO,CAAC,CAAC;MACV,CAAC,MAAM;QACNxB,UAAU,CAAEyB,KAAK,EAAE,GAAI,CAAC;MACzB;IACD,CAAC;IACDA,KAAK,CAAC,CAAC;EACR,CAAE,CAAC;AACJ,CAAC;;AAED;AACO,MAAM/D,oBAAoB,GAAKvH,KAAK,IAAM;EAChD,IAAKA,KAAK,CAACkE,WAAW,KAAK,QAAQ,EAAG;IACrC;EACD;;EAEA;EACA,IAAKlE,KAAK,CAACkK,oBAAoB,EAAG;IACjCxF,aAAa,CAAE1E,KAAK,CAACkK,oBAAqB,CAAC;EAC5C;;EAEA;EACAlK,KAAK,CAACkK,oBAAoB,GAAG1F,WAAW,CAAE,MAAM;IAC/C,IAAKxE,KAAK,CAACyE,SAAS,IAAIyD,MAAM,CAACqB,eAAe,CAACI,QAAQ,EAAG;MACzDzB,MAAM,CAACqB,eAAe,CAACY,KAAK,CAAC,CAAC;MAC9BjC,MAAM,CAACqB,eAAe,CAACG,MAAM,CAAC,CAAC;IAChC,CAAC,MAAM;MACNhF,aAAa,CAAE1E,KAAK,CAACkK,oBAAqB,CAAC;MAC3ClK,KAAK,CAACkK,oBAAoB,GAAG,IAAI;IAClC;EACD,CAAC,EAAE,KAAM,CAAC;AACX,CAAC;;;;;;;;;;;;;;;;;;AC1CD;AACA;AACA;;AAE4C;AAKvB;;AAErB;AACO,MAAM1C,eAAe,GAAGA,CAAExH,KAAK,EAAE8H,OAAO,KAAM;EACpD;EACA,MAAMrH,OAAO,GAAGT,KAAK,CAAC6B,UAAU,CAAE7B,KAAK,CAACgC,YAAY,CAAE;EACtD,MAAMiG,YAAY,GAAG,IAAIC,MAAM,CAACC,wBAAwB,CAAE1H,OAAQ,CAAC;EACnEwH,YAAY,CAACG,IAAI,GAAGf,wDAAgB,CAAC,CAAC;EACtCY,YAAY,CAACI,IAAI,GAAGrI,KAAK,CAACoE,YAAY;EACtC6D,YAAY,CAACK,KAAK,GAAGtI,KAAK,CAACuI,YAAY;EAEvC,IAAKvI,KAAK,CAAC2I,YAAY,EAAG;IACzB,MAAMC,KAAK,GAAG5I,KAAK,CAAC6I,MAAM,CAACC,IAAI,CAC5BC,CAAC,IAAMA,CAAC,CAACC,QAAQ,KAAKhJ,KAAK,CAAC2I,YAAY,CAACK,QAC5C,CAAC;IACDf,YAAY,CAACW,KAAK,GAAGA,KAAK;EAC3B;EAEA4C,oBAAoB,CAAExL,KAAK,EAAEiI,YAAY,EAAExH,OAAO,EAAEqH,OAAQ,CAAC;EAC7D9H,KAAK,CAACsJ,SAAS,GAAGrB,YAAY;AAC/B,CAAC;AAEM,MAAMuD,oBAAoB,GAAGA,CAAExL,KAAK,EAAEsJ,SAAS,EAAE7I,OAAO,EAAEqH,OAAO,KAAM;EAC7E;EACA,IAAK9H,KAAK,CAACkE,WAAW,KAAK,QAAQ,EAAG;IACrC;IACAoF,SAAS,CAACL,UAAU,GAAKhE,KAAK,IAAM;MACnC;MACAqE,SAAS,CAACd,cAAc,GAAGvD,KAAK,CAACL,SAAS,IAAI,CAAC;MAC/CE,+DAAmB,CAAE9E,KAAK,EAAEiF,KAAK,EAAExE,OAAQ,CAAC;IAC7C,CAAC;;IAED;IACA6I,SAAS,CAACW,cAAc,GAAGhG,mEAAuB,CAAEjE,KAAK,EAAES,OAAQ,CAAC;EACrE,CAAC,MAAM;IACN6I,SAAS,CAACL,UAAU,GAAKhE,KAAK,IAAM;MACnC;MACAqE,SAAS,CAACd,cAAc,GAAGvD,KAAK,CAACL,SAAS,IAAI,CAAC;;MAE/C;MACA;MACA,MAAMuE,aAAa,GAClBG,SAAS,CAACb,cAAc,KAAKgD,SAAS,GACnC;QACA,GAAGxG,KAAK;QACRL,SAAS,EACR,CAAEK,KAAK,CAACL,SAAS,IAAI,CAAC,IACtB0E,SAAS,CAACb;MACX,CAAC,GACDxD,KAAK;MAETH,+DAAmB,CAAE9E,KAAK,EAAEmJ,aAAa,EAAE1I,OAAQ,CAAC;IACrD,CAAC;EACF;EAEA6I,SAAS,CAACD,KAAK,GAAG,MAAM;IACvB;IACA,IAAKC,SAAS,CAACW,cAAc,EAAG;MAC/BvF,aAAa,CAAE4E,SAAS,CAACW,cAAe,CAAC;IAC1C;;IAEA;IACA,IAAKjK,KAAK,CAACgC,YAAY,GAAGhC,KAAK,CAAC6B,UAAU,CAACjB,MAAM,GAAG,CAAC,EAAG;MACvD;MACAZ,KAAK,CAACgC,YAAY,EAAE;;MAEpB;MACAwF,eAAe,CAAExH,KAAK,EAAE8H,OAAQ,CAAC;;MAEjC;MACA+B,UAAU,CAAE,MAAM;QACjB,IAAK7J,KAAK,CAACyE,SAAS,IAAIzE,KAAK,CAACsJ,SAAS,EAAG;UACzCpB,MAAM,CAACqB,eAAe,CAACC,KAAK,CAAExJ,KAAK,CAACsJ,SAAU,CAAC;QAChD;MACD,CAAC,EAAE,EAAG,CAAC;IACR,CAAC,MAAM;MACN;MACA,IAAKxB,OAAO,EAAG;QACdA,OAAO,CAACrD,SAAS,GAAG,KAAK;MAC1B;MACAzE,KAAK,CAACyE,SAAS,GAAG,KAAK;MACvB7B,2DAAe,CAAE5C,KAAM,CAAC;IACzB;EACD,CAAC;;EAED;EACAsJ,SAAS,CAACoC,OAAO,GAAKzG,KAAK,IAAM;IAChCjC,OAAO,CAACf,KAAK,CAAE,yBAAyB,EAAEgD,KAAM,CAAC;IACjD,IAAKA,KAAK,CAAChD,KAAK,KAAK,aAAa,EAAG;MACpC;MACAsH,eAAe,CAACK,MAAM,CAAC,CAAC;MACxBnC,kBAAkB,CAAEzH,KAAM,CAAC;IAC5B;EACD,CAAC;AACF,CAAC;AAEM,MAAMyH,kBAAkB,GAAKzH,KAAK,IAAM;EAC9C;EACA4C,2DAAe,CAAE5C,KAAM,CAAC;;EAExB;EACAA,KAAK,CAACyE,SAAS,GAAG,KAAK;;EAEvB;EACAzE,KAAK,CAACgC,YAAY,GAAG,CAAC;EACtBhC,KAAK,CAAC6B,UAAU,GAAG,EAAE;;EAErB;EACA7B,KAAK,CAACkD,sBAAsB,GAAG,IAAI;;EAEnC;EACAlD,KAAK,CAACe,iBAAiB,GAAG;IACzBE,YAAY,EAAE;EACf,CAAC;AACF,CAAC;;;;;;;;;;;;;;;;;;;AC3HD;AACA;AACA;;AAE4C;AACE;AACQ;AAMjC;AACrB;AACO,MAAM0K,UAAU,GAAG,MAAQ3L,KAAK,IAAM;EAC5C,IAAI;IACH;IACA,IAAKA,KAAK,CAACkE,WAAW,KAAK,QAAQ,EAAG;MACrC;MACAgE,MAAM,CAACqB,eAAe,CAACC,KAAK,CAAE,IAAIrB,wBAAwB,CAAE,EAAG,CAAE,CAAC;MAClED,MAAM,CAACqB,eAAe,CAACK,MAAM,CAAC,CAAC;IAChC;IAEA,MAAMgC,eAAe,GAAG1D,MAAM,CAACqB,eAAe,CAACsC,SAAS,CAAC,CAAC;IAE1D,IAAK,CAAED,eAAe,EAAEhL,MAAM,EAAG;MAChC;MACAiJ,UAAU,CAAE,MAAM8B,UAAU,CAAE3L,KAAM,CAAC,EAAE,GAAI,CAAC;MAC5C;IACD;IAEA,MAAM4K,aAAa,GAAGvD,wDAAgB,CAAC,CAAC;;IAExC;IACA,MAAMyE,WAAW,GAAGF,eAAe,CAACnK,MAAM,CAAEmH,KAAK,IAAI;MACpD,OAAOA,KAAK,IACR,OAAOA,KAAK,CAACR,IAAI,KAAK,QAAQ,IAC9B,OAAOQ,KAAK,CAACI,QAAQ,KAAK,QAAQ,IAClCJ,KAAK,CAACR,IAAI,CAACxH,MAAM,GAAG,CAAC,IACrBgI,KAAK,CAACI,QAAQ,CAACpI,MAAM,GAAG,CAAC;IAC9B,CAAC,CAAC;IAEF,IAAKkL,WAAW,CAAClL,MAAM,KAAK,CAAC,EAAG;MAC/Bd,yDAAkB,CAACI,QAAQ,CAAE,aAAa,EAAE,IAAIC,KAAK,CAAE,uBAAwB,CAAE,CAAC;MAClF;IACD;IAEA,MAAM4L,WAAW,GAAGD,WAAW,CAACrK,MAAM,CAAImH,KAAK,IAC9CA,KAAK,CAACR,IAAI,CAAC4D,UAAU,CAAEpB,aAAc,CACtC,CAAC;IAED5K,KAAK,CAAC6I,MAAM,GAAGkD,WAAW,CAACnL,MAAM,GAAG,CAAC,GAAGmL,WAAW,GAAGD,WAAW;IACjE9L,KAAK,CAAC2I,YAAY,GAAG3I,KAAK,CAAC6I,MAAM,CAAE,CAAC,CAAE;IAEtC,IAAK7I,KAAK,CAACiM,cAAc,EAAG;MAC3B,MAAMC,cAAc,GAAGvE,mDAAY,CAACwE,aAAa,CAAEnM,KAAK,CAACiM,cAAc,EAAEjM,KAAK,CAAC6I,MAAO,CAAC;MACvF,IAAKqD,cAAc,EAAG;QACrBlM,KAAK,CAAC2I,YAAY,GAAGuD,cAAc;MACpC;IACD;IAEArC,UAAU,CAAE,MAAMrC,2DAAe,CAAExH,KAAM,CAAC,EAAE,EAAG,CAAC;IAChD,OAAO,IAAI;EACZ,CAAC,CAAC,OAAQiC,KAAK,EAAG;IACjBnC,yDAAkB,CAACI,QAAQ,CAAE,aAAa,EAAE+B,KAAM,CAAC;IACnD,OAAO,KAAK;EACb;AACD,CAAC;AAEM,MAAMmK,WAAW,GAAGA,CAAEpM,KAAK,EAAE+C,CAAC,KAAM;EAC1C,IAAI;IACH;IACA,MAAMuH,cAAc,GAAG5C,qDAAc,CAAC6C,aAAa,CAAExH,CAAE,CAAC;IACxD,IAAK,CAAEuH,cAAc,EAAG;MACvBxK,yDAAkB,CAACI,QAAQ,CAAE,cAAc,EAAE,IAAIC,KAAK,CAAE,sBAAuB,CAAE,CAAC;MAClF,OAAO,KAAK;IACb;IAEA,MAAM6I,QAAQ,GAAGtB,qDAAc,CAAC2E,cAAc,CAAE/B,cAAc,CAACI,MAAM,CAACC,KAAM,CAAC;IAC7E,IAAK,CAAE3B,QAAQ,EAAG;MACjBlJ,yDAAkB,CAACI,QAAQ,CAAE,cAAc,EAAE,IAAIC,KAAK,CAAE,mBAAoB,CAAE,CAAC;MAC/E,OAAO,KAAK;IACb;;IAEA;IACA+H,MAAM,CAACqB,eAAe,CAACK,MAAM,CAAC,CAAC;IAE/B,MAAM9B,OAAO,GAAGV,oEAAU,CAAC,CAAC;IAC5B,IAAKU,OAAO,EAAG;MACdA,OAAO,CAACrD,SAAS,GAAG,KAAK;IAC1B;;IAEA;IACA,MAAMmE,KAAK,GAAGjB,mDAAY,CAACwE,aAAa,CAAEnD,QAAQ,EAAEhJ,KAAK,CAAC6I,MAAO,CAAC;IAClE,IAAK,CAAED,KAAK,EAAG;MACd9I,yDAAkB,CAACI,QAAQ,CAAE,cAAc,EAAE,IAAIC,KAAK,CAAE,qCAAsC,CAAE,CAAC;MACjG,OAAO,KAAK;IACb;IAEAH,KAAK,CAAC2I,YAAY,GAAGC,KAAK;;IAE1B;IACA,MAAMgC,aAAa,GAAGvD,wDAAgB,CAAC,CAAC;IACxC,MAAMwD,UAAU,GAAG,kBAAmBD,aAAa,EAAG;IACtD,MAAME,OAAO,GAAGlD,oDAAa,CAACmD,OAAO,CAAEF,UAAU,EAAEjC,KAAK,CAACI,QAAS,CAAC;IAEnE,IAAK,CAAE8B,OAAO,EAAG;MAChBhL,yDAAkB,CAACI,QAAQ,CAAE,cAAc,EAAE,IAAIC,KAAK,CAAE,sCAAuC,CAAE,CAAC;IACnG;IAEA,OAAO,IAAI;EACZ,CAAC,CAAC,OAAQ8B,KAAK,EAAG;IACjBnC,yDAAkB,CAACI,QAAQ,CAAE,cAAc,EAAE+B,KAAM,CAAC;IACpD,OAAO,KAAK;EACb;AACD,CAAC;;;;;;;;;;;;;;;;;;;;;ACnHD;AACA;AACA;;AAEsD;AACyB;AACxC;AACM;AACe;AACZ;AAEzC,MAAMsK,IAAI,GAAKvM,KAAK,IAAM;EAChC,IAAI;IACH,IAAK,CAAEkI,MAAM,CAACqB,eAAe,EAAG;MAC/BzJ,yDAAkB,CAACI,QAAQ,CAAE,eAAe,EAAE,IAAIC,KAAK,CAAE,gDAAiD,CAAE,CAAC;MAC7G,OAAO,KAAK;IACb;;IAEA;IACA+H,MAAM,CAACqB,eAAe,CAACK,MAAM,CAAC,CAAC;;IAE/B;IACA,MAAM4C,gBAAgB,GAAGF,2DAAmB,CAAC,CAAC;IAC9C,IAAK,CAAEE,gBAAgB,EAAG;MACzB1M,yDAAkB,CAACI,QAAQ,CAAE,eAAe,EAAE,IAAIC,KAAK,CAAE,uCAAwC,CAAE,CAAC;IACrG;;IAEA;IACA,MAAMsM,YAAY,GAAGd,0DAAU,CAAE3L,KAAM,CAAC;IACxC,IAAK,CAAEyM,YAAY,EAAG;MACrB3M,yDAAkB,CAACI,QAAQ,CAAE,eAAe,EAAE,IAAIC,KAAK,CAAE,uBAAwB,CAAE,CAAC;IACrF;IAEA,IAAK+H,MAAM,CAACqB,eAAe,CAACmD,eAAe,KAAKjB,SAAS,EAAG;MAC3DvD,MAAM,CAACqB,eAAe,CAACmD,eAAe,GAAG,MAAM;QAC9C,IAAI;UACHf,0DAAU,CAAE3L,KAAM,CAAC;QACpB,CAAC,CAAC,OAAQiC,KAAK,EAAG;UACjBnC,yDAAkB,CAACI,QAAQ,CAAE,sBAAsB,EAAE+B,KAAM,CAAC;QAC7D;MACD,CAAC;IACF;IAEAiG,MAAM,CAACyE,gBAAgB,CAAE,cAAc,EAAE,MAAM;MAC9C,IAAI;QACHzE,MAAM,CAACqB,eAAe,CAACK,MAAM,CAAC,CAAC;;QAE/B;QACA,IAAK5J,KAAK,CAACkE,WAAW,KAAK,QAAQ,EAAG;UACrC,IAAKlE,KAAK,CAACsJ,SAAS,IAAItJ,KAAK,CAACsJ,SAAS,CAACW,cAAc,EAAG;YACxDvF,aAAa,CAAE1E,KAAK,CAACsJ,SAAS,CAACW,cAAe,CAAC;UAChD;UAEA,IAAKjK,KAAK,CAACkK,oBAAoB,EAAG;YACjCxF,aAAa,CAAE1E,KAAK,CAACkK,oBAAqB,CAAC;UAC5C;QACD;MACD,CAAC,CAAC,OAAQjI,KAAK,EAAG;QACjBnC,yDAAkB,CAACI,QAAQ,CAAE,qBAAqB,EAAE+B,KAAM,CAAC;MAC5D;IACD,CAAE,CAAC;;IAEH;IACA,MAAMhC,WAAW,GAAGP,sDAAc,CAAC,CAAC;IACpC,IAAKO,WAAW,EAAG;MAClB,MAAMiB,YAAY,GAAGzB,uDAAe,CAAC,CAAC;MACtC,MAAM0B,iBAAiB,GAAGD,YAAY,EAAEE,OAAO,CAACC,YAAY,IAAI7B,gDAAQ,CAAC8B,aAAa;MACtF,MAAMC,cAAc,GAAGJ,iBAAiB,CAACK,KAAK,CAAE,KAAM,CAAC,CAACC,MAAM,CAAEC,GAAG,IAAIA,GAAG,CAACf,IAAI,CAAC,CAAE,CAAC;MAEnFkJ,UAAU,CAAE,MAAM;QACjB,IAAI;UACHlK,yEAAqB,CAAEK,KAAK,EAAEC,WAAW,EAAEsB,cAAe,CAAC;QAC5D,CAAC,CAAC,OAAQU,KAAK,EAAG;UACjBnC,yDAAkB,CAACI,QAAQ,CAAE,0BAA0B,EAAE+B,KAAM,CAAC;QACjE;MACD,CAAC,EAAE,GAAI,CAAC,CAAC,CAAC;IACX;IAEA,OAAO,IAAI;EACZ,CAAC,CAAC,OAAQA,KAAK,EAAG;IACjBnC,yDAAkB,CAACI,QAAQ,CAAE,eAAe,EAAE+B,KAAM,CAAC;IACrD,OAAO,KAAK;EACb;AACD,CAAC;AAEM,MAAM2K,UAAU,GAAK5M,KAAK,IAAM;EACtC,IAAI;IACH,MAAM8H,OAAO,GAAGV,oEAAU,CAAC,CAAC;IAC5B,IAAK,CAAEU,OAAO,IAAI,CAAE9H,KAAK,EAAG;MAC3B,OAAO,KAAK;IACb;IAEA,OAAO8H,OAAO,CAACc,KAAK,EAAEI,QAAQ,KAAKhJ,KAAK,CAAC2I,YAAY,EAAEK,QAAQ;EAChE,CAAC,CAAC,OAAQ/G,KAAK,EAAG;IACjBnC,yDAAkB,CAACI,QAAQ,CAAE,sBAAsB,EAAE+B,KAAM,CAAC;IAC5D,OAAO,KAAK;EACb;AACD,CAAC;;;;;;;;;;;;;;;ACjGD;AACA;AACA;;AAEO,MAAM4K,YAAY,GAAG;EAC3BC,IAAI,EAAI1E,IAAI,IAAM,kBAAmBA,IAAI,EAAG;EAC5C2E,KAAK,EAAI3E,IAAI,IAAM,mBAAoBA,IAAI,EAAG;EAC9C4E,KAAK,EAAI5E,IAAI,IAAM,mBAAoBA,IAAI;AAC5C,CAAC;AAEM,MAAM5I,QAAQ,GAAG;EACvByN,YAAY,EAAE,SAAS;EACvBC,eAAe,EAAE,SAAS;EAC1B5L,aAAa,EAAE,aAAa;EAC5BS,eAAe,EAAE;AAClB,CAAC;;;;;;;;;;;;;;;;;;;ACfD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAMoL,eAAe,GAAG;EACvBC,gBAAgB,EAAE,IAAI;EACtBC,SAAS,EAAE,EAAE;EACbC,SAAS,EAAE,GAAG;EACdC,SAAS,EAAE,CAAC;EACZC,SAAS,EAAE,GAAG;EACdC,sBAAsB,EAAE,CACvB,0BAA0B,EAC1B,6BAA6B,CAC7B;EACDC,kBAAkB,EAAE,wJAAwJ;EAC5KC,gBAAgB,EAAE,kBAAkB;EACpCC,sBAAsB,EAAE;AACzB,CAAC;;AAED;AACA;AACA;AACO,MAAMlG,cAAc,GAAG;EAC7B;AACD;AACA;AACA;AACA;AACA;AACA;EACC2E,cAAc,EAAEA,CAAEwB,KAAK,EAAEC,SAAS,GAAGX,eAAe,CAACC,gBAAgB,KAAM;IAC1E,IAAK,OAAOS,KAAK,KAAK,QAAQ,EAAG;MAChC,OAAO,IAAI;IACZ;IAEA,IAAKA,KAAK,CAACjN,MAAM,GAAGkN,SAAS,EAAG;MAC/B,OAAO,IAAI;IACZ;;IAEA;IACA,OAAOD,KAAK,CAACE,OAAO,CAAE,UAAU,EAAE,EAAG,CAAC,CAACpN,IAAI,CAAC,CAAC;EAC9C,CAAC;EAED;AACD;AACA;AACA;AACA;AACA;AACA;AACA;EACCqN,cAAc,EAAEA,CAAEH,KAAK,EAAEI,GAAG,EAAEC,GAAG,KAAM;IACtC,MAAMC,GAAG,GAAGC,UAAU,CAAEP,KAAM,CAAC;IAE/B,IAAKQ,KAAK,CAAEF,GAAI,CAAC,IAAIA,GAAG,GAAGF,GAAG,IAAIE,GAAG,GAAGD,GAAG,EAAG;MAC7C,OAAO,IAAI;IACZ;IAEA,OAAOC,GAAG;EACX,CAAC;EAED;AACD;AACA;AACA;AACA;AACA;EACC5D,aAAa,EAAItF,KAAK,IAAM;IAC3B,IAAK,CAAEA,KAAK,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAG;MAC3C,OAAO,IAAI;IACZ;IAEA,IAAK,CAAEA,KAAK,CAACyF,MAAM,IAAI,OAAOzF,KAAK,CAACyF,MAAM,KAAK,QAAQ,EAAG;MACzD,OAAO,IAAI;IACZ;IAEA,OAAOzF,KAAK;EACb,CAAC;EAED;AACD;AACA;AACA;AACA;AACA;EACCqJ,gBAAgB,EAAItF,QAAQ,IAAM;IACjC,IAAK,CAAEA,QAAQ,IAAI,OAAOA,QAAQ,KAAK,QAAQ,EAAG;MACjD,OAAO,IAAI;IACZ;IAEA,IAAK,CAAEmE,eAAe,CAACS,sBAAsB,CAACW,IAAI,CAAEvF,QAAS,CAAC,EAAG;MAChE,OAAO,IAAI;IACZ;IAEA,OAAOA,QAAQ;EAChB;AACD,CAAC;;AAED;AACA;AACA;AACO,MAAMpJ,gBAAgB,GAAG;EAC/B;AACD;AACA;AACA;AACA;AACA;EACC4O,YAAY,EAAIX,KAAK,IAAM;IAC1B,IAAK,OAAOA,KAAK,KAAK,QAAQ,EAAG;MAChC,OAAO,EAAE;IACV;;IAEA;IACA,MAAMY,GAAG,GAAGC,QAAQ,CAACC,aAAa,CAAE,KAAM,CAAC;IAC3CF,GAAG,CAACpI,WAAW,GAAGwH,KAAK;IACvB,OAAOY,GAAG,CAACG,SAAS;EACrB,CAAC;EAED;AACD;AACA;AACA;AACA;AACA;EACC9N,YAAY,EAAI+M,KAAK,IAAM;IAC1B,IAAK,OAAOA,KAAK,KAAK,QAAQ,EAAG;MAChC,OAAO,EAAE;IACV;;IAEA;IACA,OAAOA,KAAK,CACVE,OAAO,CAAE,UAAU,EAAE,EAAG,CAAC,CACzBA,OAAO,CAAE,MAAM,EAAE,GAAI,CAAC,CACtBpN,IAAI,CAAC,CAAC;EACT,CAAC;EAED;AACD;AACA;AACA;AACA;AACA;EACCkO,aAAa,EAAIC,KAAK,IAAM;IAC3B,IAAK,OAAOA,KAAK,KAAK,QAAQ,EAAG;MAChC,OAAO,SAAS;IACjB;IAEA,IAAK3B,eAAe,CAACO,kBAAkB,CAACa,IAAI,CAAEO,KAAM,CAAC,EAAG;MACvD,OAAOA,KAAK;IACb;IAEA,OAAO,SAAS;EACjB;AACD,CAAC;;AAED;AACA;AACA;AACO,MAAMlH,aAAa,GAAG;EAC5B;AACD;AACA;AACA;AACA;AACA;AACA;EACCmD,OAAO,EAAEA,CAAEgE,GAAG,EAAEpE,KAAK,KAAM;IAC1B,IAAI;MACH;MACA,IAAK,CAAEwC,eAAe,CAACQ,gBAAgB,CAACY,IAAI,CAAEQ,GAAI,CAAC,EAAG;QACrD/L,OAAO,CAACC,IAAI,CAAE,6BAA6B,EAAE8L,GAAI,CAAC;QAClD,OAAO,KAAK;MACb;;MAEA;MACA,MAAMC,cAAc,GAAGtH,cAAc,CAAC2E,cAAc,CAAE1B,KAAM,CAAC;MAC7D,IAAK,CAAEqE,cAAc,EAAG;QACvBhM,OAAO,CAACC,IAAI,CAAE,wBAAwB,EAAE0H,KAAM,CAAC;QAC/C,OAAO,KAAK;MACb;MAEAzC,MAAM,CAAC+G,YAAY,CAAClE,OAAO,CAAEgE,GAAG,EAAEC,cAAe,CAAC;MAClD,OAAO,IAAI;IACZ,CAAC,CAAC,OAAQ/M,KAAK,EAAG;MACjBe,OAAO,CAACC,IAAI,CAAE,2BAA2B,EAAEhB,KAAK,CAACiN,OAAQ,CAAC;MAC1D,OAAO,KAAK;IACb;EACD,CAAC;EAED;AACD;AACA;AACA;AACA;AACA;AACA;EACCC,OAAO,EAAEA,CAAEJ,GAAG,EAAEK,YAAY,GAAG,IAAI,KAAM;IACxC,IAAI;MACH;MACA,IAAK,CAAEjC,eAAe,CAACQ,gBAAgB,CAACY,IAAI,CAAEQ,GAAI,CAAC,EAAG;QACrD,OAAOK,YAAY;MACpB;MAEA,MAAMzE,KAAK,GAAGzC,MAAM,CAAC+G,YAAY,CAACE,OAAO,CAAEJ,GAAI,CAAC;MAChD,IAAK,CAAEpE,KAAK,EAAG;QACd,OAAOyE,YAAY;MACpB;;MAEA;MACA,MAAMJ,cAAc,GAAGtH,cAAc,CAAC2E,cAAc,CAAE1B,KAAM,CAAC;MAC7D,OAAOqE,cAAc,IAAII,YAAY;IACtC,CAAC,CAAC,OAAQnN,KAAK,EAAG;MACjBe,OAAO,CAACC,IAAI,CAAE,2BAA2B,EAAEhB,KAAK,CAACiN,OAAQ,CAAC;MAC1D,OAAOE,YAAY;IACpB;EACD;AACD,CAAC;;AAED;AACA;AACA;AACO,MAAMvP,SAAS,GAAG;EACxB;AACD;AACA;AACA;AACA;AACA;AACA;AACA;EACCwP,cAAc,EAAEA,CAAExI,OAAO,EAAEyI,QAAQ,EAAE3E,KAAK,KAAM;IAC/C,IAAK,CAAE9D,OAAO,IAAI,CAAEyI,QAAQ,IAAI,CAAE3E,KAAK,EAAG;MACzC,OAAO,KAAK;IACb;;IAEA;IACA,IAAK,CAAEwC,eAAe,CAACM,sBAAsB,CAAC8B,QAAQ,CAAED,QAAS,CAAC,EAAG;MACpEtM,OAAO,CAACC,IAAI,CAAE,sBAAsB,EAAEqM,QAAS,CAAC;MAChD,OAAO,KAAK;IACb;;IAEA;IACA,MAAMN,cAAc,GAAGpP,gBAAgB,CAACiP,aAAa,CAAElE,KAAM,CAAC;IAC9D9D,OAAO,CAAC2I,KAAK,CAACC,WAAW,CAAEH,QAAQ,EAAEN,cAAe,CAAC;IACrD,OAAO,IAAI;EACZ,CAAC;EAED;AACD;AACA;AACA;AACA;AACA;EACCrN,cAAc,EAAIkF,OAAO,IAAM;IAC9B,IAAK,CAAEA,OAAO,EAAG;MAChB,OAAO,EAAE;IACV;;IAEA;IACA,MAAM7F,IAAI,GAAG6F,OAAO,CAACR,WAAW,IAAI,EAAE;IACtC,OAAOzG,gBAAgB,CAACkB,YAAY,CAAEE,IAAK,CAAC;EAC7C,CAAC;EAED;AACD;AACA;AACA;AACA;AACA;AACA;EACC0O,aAAa,EAAEA,CAAEC,QAAQ,EAAE7H,OAAO,GAAG4G,QAAQ,KAAM;IAClD,IAAK,CAAEiB,QAAQ,IAAI,OAAOA,QAAQ,KAAK,QAAQ,EAAG;MACjD,OAAO,IAAI;IACZ;;IAEA;IACA,IAAK,CAAE,sCAAsC,CAACpB,IAAI,CAAEoB,QAAS,CAAC,EAAG;MAChE3M,OAAO,CAACC,IAAI,CAAE,8BAA8B,EAAE0M,QAAS,CAAC;MACxD,OAAO,IAAI;IACZ;IAEA,IAAI;MACH,OAAO7H,OAAO,CAAC4H,aAAa,CAAEC,QAAS,CAAC;IACzC,CAAC,CAAC,OAAQ1N,KAAK,EAAG;MACjBe,OAAO,CAACC,IAAI,CAAE,wBAAwB,EAAEhB,KAAK,CAACiN,OAAQ,CAAC;MACvD,OAAO,IAAI;IACZ;EACD;AACD,CAAC;;AAED;AACA;AACA;AACO,MAAMpP,kBAAkB,GAAG;EACjC;AACD;AACA;AACA;AACA;AACA;AACA;EACCI,QAAQ,EAAEA,CAAE4H,OAAO,EAAE7F,KAAK,EAAE2N,cAAc,GAAG,CAAC,CAAC,KAAM;IACpD,MAAMC,SAAS,GAAG;MACjB/H,OAAO;MACPoH,OAAO,EAAEjN,KAAK,CAACiN,OAAO,IAAI,eAAe;MACzCY,SAAS,EAAE,IAAIC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;MACnC,GAAGJ;IACJ,CAAC;;IAED;IACA5M,OAAO,CAACf,KAAK,CAAE,eAAgB6F,OAAO,GAAI,EAAE+H,SAAU,CAAC;EACxD,CAAC;EAED;AACD;AACA;AACA;AACA;AACA;EACCI,iBAAiB,EAAEA,CAAEhL,KAAK,EAAEjF,KAAK,KAAM;IACtC,MAAMkQ,YAAY,GAAG;MACpBC,SAAS,EAAElL,KAAK,CAAChD,KAAK,IAAI,SAAS;MACnCwC,SAAS,EAAEzE,KAAK,CAACyE,SAAS;MAC1BzC,YAAY,EAAEhC,KAAK,CAACgC;IACrB,CAAC;IAEDlC,kBAAkB,CAACI,QAAQ,CAAE,kBAAkB,EAAE+E,KAAK,EAAEiL,YAAa,CAAC;;IAEtE;IACA,IAAKlQ,KAAK,EAAG;MACZA,KAAK,CAACyE,SAAS,GAAG,KAAK;MACvBzE,KAAK,CAACgC,YAAY,GAAG,CAAC;IACvB;EACD;AACD,CAAC;;AAED;AACA;AACA;AACO,MAAM2F,YAAY,GAAG;EAC3B;AACD;AACA;AACA;AACA;AACA;EACC8C,aAAa,EAAIoD,KAAK,IAAM;IAC3B,OAAOnG,cAAc,CAACsG,cAAc,CACnCH,KAAK,EACLV,eAAe,CAACG,SAAS,EACzBH,eAAe,CAACE,SACjB,CAAC;EACF,CAAC;EAED;AACD;AACA;AACA;AACA;AACA;EACCpC,aAAa,EAAI4C,KAAK,IAAM;IAC3B,OAAOnG,cAAc,CAACsG,cAAc,CACnCH,KAAK,EACLV,eAAe,CAACK,SAAS,EACzBL,eAAe,CAACI,SACjB,CAAC;EACF,CAAC;EAED;AACD;AACA;AACA;AACA;AACA;AACA;EACCpB,aAAa,EAAEA,CAAEnD,QAAQ,EAAE4C,eAAe,GAAG,EAAE,KAAM;IACpD,MAAMwE,YAAY,GAAG1I,cAAc,CAAC4G,gBAAgB,CAAEtF,QAAS,CAAC;IAChE,IAAK,CAAEoH,YAAY,EAAG;MACrB,OAAO,IAAI;IACZ;;IAEA;IACA,MAAMxH,KAAK,GAAGgD,eAAe,CAAC9C,IAAI,CAAEC,CAAC,IAAIA,CAAC,CAACC,QAAQ,KAAKoH,YAAa,CAAC;IACtE,OAAOxH,KAAK,IAAI,IAAI;EACrB;AACD,CAAC;;;;;;;;;;;;;;;;AC1YD;AACA;AACA;;AAE2C;AACiC;AAErE,MAAM2H,YAAY,GAAG;EAC3B9L,SAAS,EAAE,KAAK;EAChBkE,YAAY,EAAE,IAAI;EAClBsD,cAAc,EAAEoE,2DAAmB,CAClCxD,oDAAY,CAACC,IAAI,CAAEzF,wDAAgB,CAAC,CAAE,CAAC,EACvC,IACD,CAAC;EACDiC,SAAS,EAAE,IAAI;EACfT,MAAM,EAAE,EAAE;EACVzE,YAAY,EAAEiM,2DAAmB,CAChCxD,oDAAY,CAACE,KAAK,CAAE1F,wDAAgB,CAAC,CAAE,CAAC,EACxC,CACD,CAAC;EACDkB,YAAY,EAAE8H,2DAAmB,CAChCxD,oDAAY,CAACG,KAAK,CAAE3F,wDAAgB,CAAC,CAAE,CAAC,EACxC,CACD,CAAC;EACDtG,iBAAiB,EAAE;IAAEE,YAAY,EAAE;EAAM,CAAC;EAC1Ce,YAAY,EAAE,CAAC;EACfH,UAAU,EAAE,EAAE;EACd2O,kBAAkB,EAAE,KAAK;EACzBtN,sBAAsB,EAAE,IAAI;EAC5BiC,aAAa,EAAE,IAAIsL,GAAG,CAAC,CAAC;EACxB5N,gBAAgB,EAAE,IAAI;EACtBkF,QAAQ,EAAE,IAAI;EACd7D,WAAW,EAAEoM,kDAAU,CAAC,CAAC;EACzB;EACApG,oBAAoB,EAAE;AACvB,CAAC;;;;;;;;;;;;;;;;;;;;;ACnCD;AACA;AACA;;AAEuC;AAMnB;AAEb,MAAMmG,mBAAmB,GAAGA,CAAEtB,GAAG,EAAEK,YAAY,KAAM;EAC3D,OAAOxH,oDAAa,CAACuH,OAAO,CAAEJ,GAAG,EAAEK,YAAa,CAAC;AAClD,CAAC;AAEM,MAAM/H,gBAAgB,GAAGA,CAAA,KAAM;EACrC,IAAI;IACH,MAAMe,IAAI,GAAGsG,QAAQ,CAACgC,eAAe,CAACtI,IAAI;IAC1C,OAAOxI,uDAAgB,CAACkB,YAAY,CAAEsH,IAAK,CAAC,IAAI,IAAI;EACrD,CAAC,CAAC,OAAQnG,KAAK,EAAG;IACjBnC,yDAAkB,CAACI,QAAQ,CAAE,oBAAoB,EAAE+B,KAAM,CAAC;IAC1D,OAAO,IAAI;EACZ;AACD,CAAC;AAEM,MAAMxC,eAAe,GAAGA,CAAA,KAAM;EACpC,OAAOI,gDAAS,CAAC6P,aAAa,CAAE,oDAAqD,CAAC;AACvF,CAAC;AAEM,MAAMhQ,cAAc,GAAGA,CAAA,KAAM;EACnC,OAAOG,gDAAS,CAAC6P,aAAa,CAAE,MAAO,CAAC;AACzC,CAAC;;AAED;AACO,MAAMY,UAAU,GAAGA,CAAA,KAAM;EAC/B,IAAI;IACH,MAAMK,SAAS,GAAGzI,MAAM,CAAC0I,SAAS,CAACD,SAAS;IAC5C,IAAK,CAAEA,SAAS,IAAI,OAAOA,SAAS,KAAK,QAAQ,EAAG;MACnD,OAAO,OAAO;IACf;;IAEA;IACA,MAAME,WAAW,GAAGjR,uDAAgB,CAACkB,YAAY,CAAE6P,SAAU,CAAC;IAE9D,IAAKE,WAAW,CAACC,OAAO,CAAE,SAAU,CAAC,KAAK,CAAC,CAAC,EAAG;MAC9C,OAAO,SAAS;IACjB;IACA,IACCD,WAAW,CAACC,OAAO,CAAE,MAAO,CAAC,KAAK,CAAC,CAAC,IACpCD,WAAW,CAACC,OAAO,CAAE,KAAM,CAAC,KAAK,CAAC,CAAC,EAClC;MACD,OAAO,MAAM;IACd;IACA,IACCD,WAAW,CAACC,OAAO,CAAE,QAAS,CAAC,KAAK,CAAC,CAAC,IACtCD,WAAW,CAACC,OAAO,CAAE,QAAS,CAAC,KAAK,CAAC,CAAC,EACrC;MACD,OAAO,QAAQ;IAChB;IACA,IAAKD,WAAW,CAACC,OAAO,CAAE,QAAS,CAAC,KAAK,CAAC,CAAC,EAAG;MAC7C,OAAO,QAAQ;IAChB;IACA,OAAO,OAAO;EACf,CAAC,CAAC,OAAQ7O,KAAK,EAAG;IACjBnC,yDAAkB,CAACI,QAAQ,CAAE,aAAa,EAAE+B,KAAM,CAAC;IACnD,OAAO,OAAO;EACf;AACD,CAAC;AAEM,MAAMqK,mBAAmB,GAAGA,CAAA,KAAM;EACxC,IAAI;IACH,MAAMrM,WAAW,GAAGP,cAAc,CAAC,CAAC;IACpC,MAAMwB,YAAY,GAAGzB,eAAe,CAAC,CAAC;IAEtC,IAAK,CAAEQ,WAAW,IAAI,CAAEiB,YAAY,EAAG;MACtCpB,yDAAkB,CAACI,QAAQ,CAAE,uBAAuB,EAAE,IAAIC,KAAK,CAAE,6BAA8B,CAAE,CAAC;MAClG,OAAO,KAAK;IACb;;IAEA;IACA,MAAM4Q,sBAAsB,GAAG7P,YAAY,CAACE,OAAO,CAAC4P,mBAAmB,IAAIxR,gDAAQ,CAACyN,YAAY;IAChG,MAAMgE,iBAAiB,GAAG/P,YAAY,CAACE,OAAO,CAAC8P,cAAc,IAAI1R,gDAAQ,CAAC0N,eAAe;;IAEzF;IACA,MAAM8D,mBAAmB,GAAGpR,uDAAgB,CAACiP,aAAa,CAAEkC,sBAAuB,CAAC;IACpF,MAAMG,cAAc,GAAGtR,uDAAgB,CAACiP,aAAa,CAAEoC,iBAAkB,CAAC;;IAE1E;IACA,MAAME,SAAS,GAAGtR,gDAAS,CAACwP,cAAc,CACzCpP,WAAW,EACX,0BAA0B,EAC1B+Q,mBACD,CAAC;IAED,MAAMI,YAAY,GAAGvR,gDAAS,CAACwP,cAAc,CAC5CpP,WAAW,EACX,6BAA6B,EAC7BiR,cACD,CAAC;IAED,OAAOC,SAAS,IAAIC,YAAY;EACjC,CAAC,CAAC,OAAQnP,KAAK,EAAG;IACjBnC,yDAAkB,CAACI,QAAQ,CAAE,uBAAuB,EAAE+B,KAAM,CAAC;IAC7D,OAAO,KAAK;EACb;AACD,CAAC;;;;;;;;;;AC1GD;;;;;;SCAA;SACA;;SAEA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;;SAEA;SACA;;SAEA;SACA;SACA;;;;;UCtBA;UACA;UACA;UACA;UACA,yCAAyC,wCAAwC;UACjF;UACA;UACA;;;;;UCPA;;;;;UCAA;UACA;UACA;UACA,uDAAuD,iBAAiB;UACxE;UACA,gDAAgD,aAAa;UAC7D;;;;;;;;;;;;;;;;ACNA;AACA;AACA;AACiD;;AAEjD;AACA;AACA;AAC4C;AACR;AACE;AAKb;;AAEzB;AACA,MAAM;EAAEjC;AAAM,CAAC,GAAGqR,+DAAK,CAAE,4BAA4B,EAAE;EACtDrR,KAAK,EAAEuQ,qDAAY;EAEnB;EACAgB,OAAO,EAAE;IACR;IACAjK,mBAAmB,EAAEA,CAAA,KAAM;MAC1B,IAAI;QACH,OAAOvB,8DAAqB,CAAE/F,KAAM,CAAC;MACtC,CAAC,CAAC,OAAQiC,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,uBAAuB,EAAE+B,KAAM,CAAC;QAC7D,OAAO,KAAK;MACb;IACD,CAAC;IACDsF,oBAAoB,EAAEA,CAAA,KAAM;MAC3B,IAAI;QACH,OAAOxB,+DAAsB,CAAE/F,KAAM,CAAC;MACvC,CAAC,CAAC,OAAQiC,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,mBAAmB,EAAE+B,KAAM,CAAC;QACzD,OAAO,KAAK;MACb;IACD,CAAC;IAED;IACAtC,qBAAqB,EAAEA,CAAA,KAAM;MAC5B,IAAI;QACH,OAAOoG,gEAAuB,CAAE/F,KAAM,CAAC;MACxC,CAAC,CAAC,OAAQiC,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,oBAAoB,EAAE+B,KAAM,CAAC;QAC1D,OAAO,KAAK;MACb;IACD,CAAC;IACD6C,mBAAmB,EAAEA,CAAA,KAAM;MAC1B,IAAI;QACH,OAAOiB,8DAAqB,CAAE/F,KAAM,CAAC;MACtC,CAAC,CAAC,OAAQiC,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,gBAAgB,EAAE+B,KAAM,CAAC;QACtD,OAAO,KAAK;MACb;IACD,CAAC;IACDgC,uBAAuB,EAAEA,CAAA,KAAM;MAC9B,IAAI;QACH,OAAO8B,kEAAyB,CAAE/F,KAAM,CAAC;MAC1C,CAAC,CAAC,OAAQiC,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,qBAAqB,EAAE+B,KAAM,CAAC;QAC3D,OAAO,KAAK;MACb;IACD,CAAC;IACDW,eAAe,EAAEA,CAAA,KAAM;MACtB,IAAI;QACH,OAAOmD,0DAAiB,CAAE/F,KAAM,CAAC;MAClC,CAAC,CAAC,OAAQiC,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,kBAAkB,EAAE+B,KAAM,CAAC;QACxD,OAAO,KAAK;MACb;IACD,CAAC;IAED;IACA0J,UAAU,EAAEA,CAAA,KAAM;MACjB,IAAI;QACH,OAAO5F,qDAAY,CAAE/F,KAAM,CAAC;MAC7B,CAAC,CAAC,OAAQiC,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,aAAa,EAAE+B,KAAM,CAAC;QACnD,OAAO,KAAK;MACb;IACD,CAAC;IACDmK,WAAW,EAAInH,KAAK,IAAM;MACzB,IAAI;QACH,MAAMqF,cAAc,GAAG5C,0DAAc,CAAC6C,aAAa,CAAEtF,KAAM,CAAC;QAC5D,IAAK,CAAEqF,cAAc,EAAG;UACvBtH,OAAO,CAACC,IAAI,CAAE,4BAA6B,CAAC;UAC5C,OAAO,KAAK;QACb;QAEA,MAAM+F,QAAQ,GAAGtB,0DAAc,CAAC2E,cAAc,CAC7C/B,cAAc,CAACI,MAAM,CAACC,KACvB,CAAC;QACD,IAAK,CAAE3B,QAAQ,EAAG;UACjBhG,OAAO,CAACC,IAAI,CAAE,mBAAoB,CAAC;UACnC,OAAO,KAAK;QACb;;QAEA;QACA,MAAMuO,WAAW,GAAG;UACnB9G,MAAM,EAAE;YAAEC,KAAK,EAAE3B;UAAS;QAC3B,CAAC;QAED,OAAOjD,sDAAa,CAAE/F,KAAK,EAAEwR,WAAY,CAAC;MAC3C,CAAC,CAAC,OAAQvP,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,cAAc,EAAE+B,KAAM,CAAC;QACpD,OAAO,KAAK;MACb;IACD,CAAC;IAED;IACAuF,eAAe,EAAEA,CAAA,KAAM;MACtB,IAAI;QACH,OAAOzB,0DAAiB,CAAE/F,KAAM,CAAC;MAClC,CAAC,CAAC,OAAQiC,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,kBAAkB,EAAE+B,KAAM,CAAC;QACxD,OAAO,KAAK;MACb;IACD,CAAC;IACDuJ,oBAAoB,EAAEA,CAAA,KAAM;MAC3B,IAAI;QACH,OAAOzF,+DAAsB,CAAE/F,KAAM,CAAC;MACvC,CAAC,CAAC,OAAQiC,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,wBAAwB,EAAE+B,KAAM,CAAC;QAC9D,OAAO,KAAK;MACb;IACD,CAAC;IACDwF,kBAAkB,EAAEA,CAAA,KAAM;MACzB,IAAI;QACH,OAAO1B,6DAAoB,CAAE/F,KAAM,CAAC;MACrC,CAAC,CAAC,OAAQiC,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,sBAAsB,EAAE+B,KAAM,CAAC;QAC5D,OAAO,KAAK;MACb;IACD,CAAC;IAED;IACA4F,IAAI,EAAEA,CAAA,KAAM;MACX,IAAI;QACH,OAAO9B,+CAAM,CAAE/F,KAAM,CAAC;MACvB,CAAC,CAAC,OAAQiC,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,aAAa,EAAE+B,KAAM,CAAC;QACnD,OAAO,KAAK;MACb;IACD,CAAC;IACD6H,KAAK,EAAEA,CAAA,KAAM;MACZ,IAAI;QACH,OAAO/D,gDAAO,CAAE/F,KAAM,CAAC;MACxB,CAAC,CAAC,OAAQiC,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,cAAc,EAAE+B,KAAM,CAAC;QACpD,OAAO,KAAK;MACb;IACD,CAAC;IACDmI,OAAO,EAAEA,CAAA,KAAM;MACd,IAAI;QACH,OAAOrE,kDAAS,CAAE/F,KAAM,CAAC;MAC1B,CAAC,CAAC,OAAQiC,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,gBAAgB,EAAE+B,KAAM,CAAC;QACtD,OAAO,KAAK;MACb;IACD,CAAC;IACDoI,WAAW,EAAIpF,KAAK,IAAM;MACzB,IAAI;QACH,MAAMqF,cAAc,GAAG5C,0DAAc,CAAC6C,aAAa,CAAEtF,KAAM,CAAC;QAC5D,IAAK,CAAEqF,cAAc,EAAG;UACvBtH,OAAO,CAACC,IAAI,CAAE,4BAA6B,CAAC;UAC5C,OAAO,KAAK;QACb;QAEA,MAAMuH,KAAK,GAAG7C,wDAAY,CAAC8C,aAAa,CACvCH,cAAc,CAACI,MAAM,CAACC,KACvB,CAAC;QACD,IAAKH,KAAK,KAAK,IAAI,EAAG;UACrBxH,OAAO,CAACC,IAAI,CACX,sBAAsB,EACtBqH,cAAc,CAACI,MAAM,CAACC,KACvB,CAAC;UACD,OAAO,KAAK;QACb;;QAEA;QACA,MAAM6G,WAAW,GAAG;UACnB9G,MAAM,EAAE;YAAEC,KAAK,EAAEH,KAAK,CAAC9J,QAAQ,CAAC;UAAE;QACnC,CAAC;QAED,OAAOqF,sDAAa,CAAE/F,KAAK,EAAEwR,WAAY,CAAC;MAC3C,CAAC,CAAC,OAAQvP,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,cAAc,EAAE+B,KAAM,CAAC;QACpD,OAAO,KAAK;MACb;IACD,CAAC;IACD+I,WAAW,EAAI/F,KAAK,IAAM;MACzB,IAAI;QACH,MAAMqF,cAAc,GAAG5C,0DAAc,CAAC6C,aAAa,CAAEtF,KAAM,CAAC;QAC5D,IAAK,CAAEqF,cAAc,EAAG;UACvBtH,OAAO,CAACC,IAAI,CAAE,4BAA6B,CAAC;UAC5C,OAAO,KAAK;QACb;QAEA,MAAMqF,KAAK,GAAGX,wDAAY,CAACsD,aAAa,CACvCX,cAAc,CAACI,MAAM,CAACC,KACvB,CAAC;QACD,IAAKrC,KAAK,KAAK,IAAI,EAAG;UACrBtF,OAAO,CAACC,IAAI,CACX,sBAAsB,EACtBqH,cAAc,CAACI,MAAM,CAACC,KACvB,CAAC;UACD,OAAO,KAAK;QACb;;QAEA;QACA,MAAM6G,WAAW,GAAG;UACnB9G,MAAM,EAAE;YAAEC,KAAK,EAAErC,KAAK,CAAC5H,QAAQ,CAAC;UAAE;QACnC,CAAC;QAED,OAAOqF,sDAAa,CAAE/F,KAAK,EAAEwR,WAAY,CAAC;MAC3C,CAAC,CAAC,OAAQvP,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,cAAc,EAAE+B,KAAM,CAAC;QACpD,OAAO,KAAK;MACb;IACD,CAAC;IACDiJ,cAAc,EAAEA,CAAA,KAAM;MACrB,IAAI;QACH,OAAOnF,yDAAgB,CAAE/F,KAAM,CAAC;MACjC,CAAC,CAAC,OAAQiC,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,iBAAiB,EAAE+B,KAAM,CAAC;QACvD,OAAO,KAAK;MACb;IACD,CAAC;IAED;IACAlC,UAAU,EAAEA,CAAA,KAAM;MACjB,IAAI;QACH,OAAOgG,qDAAY,CAAE/F,KAAM,CAAC;MAC7B,CAAC,CAAC,OAAQiC,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,aAAa,EAAE+B,KAAM,CAAC;QACnD,OAAO,KAAK;MACb;IACD;EACD,CAAC;EAED;EACAwP,SAAS,EAAE;IACVlF,IAAI,EAAEA,CAAA,KAAM;MACX,IAAI;QACH,OAAO+E,iDAAM,CAAEtR,KAAM,CAAC;MACvB,CAAC,CAAC,OAAQiC,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,eAAe,EAAE+B,KAAM,CAAC;QACrD,OAAO,KAAK;MACb;IACD,CAAC;IACD2K,UAAU,EAAEA,CAAA,KAAM;MACjB,IAAI;QACH,OAAO0E,uDAAY,CAAEtR,KAAM,CAAC;MAC7B,CAAC,CAAC,OAAQiC,KAAK,EAAG;QACjBnC,8DAAkB,CAACI,QAAQ,CAAE,sBAAsB,EAAE+B,KAAM,CAAC;QAC5D,OAAO,KAAK;MACb;IACD;EACD;AACD,CAAE,CAAC,C","sources":["webpack://mosne-text-to-speech-block/./src/view/actions/content.js","webpack://mosne-text-to-speech-block/./src/view/actions/highlight.js","webpack://mosne-text-to-speech-block/./src/view/actions/index.js","webpack://mosne-text-to-speech-block/./src/view/actions/playback.js","webpack://mosne-text-to-speech-block/./src/view/actions/synthesis.js","webpack://mosne-text-to-speech-block/./src/view/actions/utterance.js","webpack://mosne-text-to-speech-block/./src/view/actions/voice.js","webpack://mosne-text-to-speech-block/./src/view/callbacks.js","webpack://mosne-text-to-speech-block/./src/view/constants.js","webpack://mosne-text-to-speech-block/./src/view/security.js","webpack://mosne-text-to-speech-block/./src/view/state.js","webpack://mosne-text-to-speech-block/./src/view/utils.js","webpack://mosne-text-to-speech-block/external module \"@wordpress/interactivity\"","webpack://mosne-text-to-speech-block/webpack/bootstrap","webpack://mosne-text-to-speech-block/webpack/runtime/define property getters","webpack://mosne-text-to-speech-block/webpack/runtime/hasOwnProperty shorthand","webpack://mosne-text-to-speech-block/webpack/runtime/make namespace object","webpack://mosne-text-to-speech-block/./src/view.js"],"sourcesContent":["/**\n * Content processing actions\n */\n\nimport { DEFAULTS } from '../constants';\nimport { getBlockWrapper, getMainElement } from '../utils';\nimport { buildNodePositionsMap } from './highlight';\nimport {\n\tContentSanitizer,\n\tSecureDOM,\n\tSecureErrorHandler\n} from '../security';\n\nexport const getContent = ( state ) => {\n\ttry {\n\t\t// Check if there is highlighted text\n\t\tconst mainElement = getMainElement();\n\t\tif ( ! mainElement ) {\n\t\t\tSecureErrorHandler.logError( 'Get Content', new Error( 'Main element not found' ) );\n\t\t\treturn '';\n\t\t}\n\n\t\tconst docView = mainElement.ownerDocument.defaultView;\n\t\tconst selection = docView ? docView.getSelection() : null;\n\t\tlet content = '';\n\n\t\tif ( selection && selection.toString().trim().length > 0 ) {\n\t\t\t// Get selected text and sanitize it\n\t\t\tconst rawContent = selection.toString();\n\t\t\tcontent = ContentSanitizer.sanitizeText( rawContent );\n\t\t\t\n\t\t\tstate.selectedTextRange = {\n\t\t\t\ttext: content,\n\t\t\t\thasSelection: true,\n\t\t\t};\n\t\t} else {\n\t\t\t// Get content from main element using secure methods\n\t\t\tconst blockWrapper = getBlockWrapper();\n\t\t\tconst excludeClassesStr = blockWrapper?.dataset.excludeClass || DEFAULTS.EXCLUDE_CLASS;\n\t\t\tconst excludeClasses = excludeClassesStr.split( /\\s+/ ).filter( cls => cls.trim() );\n\n\t\t\t// Use secure text extraction\n\t\t\tcontent = SecureDOM.getTextContent( mainElement );\n\n\t\t\t// Pre-build the node position map for faster highlighting\n\t\t\tif ( mainElement ) {\n\t\t\t\tbuildNodePositionsMap(\n\t\t\t\t\tstate,\n\t\t\t\t\tmainElement,\n\t\t\t\t\texcludeClasses\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tstate.selectedTextRange = {\n\t\t\t\thasSelection: false,\n\t\t\t};\n\t\t}\n\n\t\t// Validate content length\n\t\tif ( content.length > 50000 ) { // Reasonable limit for TTS\n\t\t\tSecureErrorHandler.logError( 'Get Content', new Error( 'Content too long for processing' ) );\n\t\t\tcontent = content.substring( 0, 50000 );\n\t\t}\n\n\t\t// Process content into chunks of approximately 200 words\n\t\tstate.textChunks = chunkText( content, DEFAULTS.WORDS_PER_CHUNK );\n\t\tstate.currentChunk = 0;\n\n\t\t// Return the first chunk to start with\n\t\treturn state.textChunks.length > 0 ? state.textChunks[ 0 ] : '';\n\t} catch ( error ) {\n\t\tSecureErrorHandler.logError( 'Get Content', error );\n\t\treturn '';\n\t}\n};\n\n// Method to chunk text into approximately word-sized pieces\nexport const chunkText = ( text, wordsPerChunk ) => {\n\ttry {\n\t\t// Validate inputs\n\t\tif ( ! text || typeof text !== 'string' || text.trim() === '' ) {\n\t\t\treturn [ '' ];\n\t\t}\n\n\t\tif ( ! wordsPerChunk || wordsPerChunk < 1 || wordsPerChunk > 1000 ) {\n\t\t\twordsPerChunk = DEFAULTS.WORDS_PER_CHUNK;\n\t\t}\n\n\t\t// Sanitize text before processing\n\t\tconst sanitizedText = ContentSanitizer.sanitizeText( text );\n\t\t\n\t\t// Split the text into words\n\t\tconst words = sanitizedText.trim().split( /\\s+/ ).filter( word => word.length > 0 );\n\t\tconst chunks = [];\n\n\t\t// Create chunks of approximately wordsPerChunk words\n\t\tfor ( let i = 0; i < words.length; i += wordsPerChunk ) {\n\t\t\tconst chunk = words.slice( i, i + wordsPerChunk ).join( ' ' );\n\t\t\tif ( chunk.trim().length > 0 ) {\n\t\t\t\tchunks.push( chunk );\n\t\t\t}\n\t\t}\n\n\t\treturn chunks.length > 0 ? chunks : [ '' ];\n\t} catch ( error ) {\n\t\tSecureErrorHandler.logError( 'Chunk Text', error );\n\t\treturn [ '' ];\n\t}\n};\n","/**\n * Highlighting management actions\n */\n\nimport { DEFAULTS } from '../constants';\nimport { getBlockWrapper, getMainElement } from '../utils';\n\n// Highlighting Management\nexport const clearHighlights = ( state ) => {\n\tif ( state.currentSelection ) {\n\t\ttry {\n\t\t\tstate.currentSelection.removeAllRanges();\n\t\t} catch ( e ) {\n\t\t\t// Handle Edge/IE errors with selection\n\t\t\tconsole.warn( 'Error clearing highlights:', e );\n\t\t}\n\t\tstate.currentSelection = null;\n\t}\n\tstate.currentHighlightedNode = null;\n};\n\nexport const createHighlightWrapper = ( state, node ) => {\n\t// Use the node's document for selection to avoid global selection issues\n\tif ( ! node ) {\n\t\treturn null;\n\t}\n\n\tconst doc = node.ownerDocument;\n\tconst docView = doc.defaultView;\n\n\tif ( ! docView ) {\n\t\treturn null;\n\t}\n\n\t// Clear any existing selection\n\tclearHighlights( state );\n\n\ttry {\n\t\t// Create a new range for the node text content\n\t\tconst range = doc.createRange();\n\n\t\t// Only select the text node's content instead of the entire node\n\t\tif ( node.nodeType === Node.TEXT_NODE ) {\n\t\t\trange.setStart( node, 0 );\n\t\t\trange.setEnd( node, node.length );\n\t\t} else {\n\t\t\trange.selectNodeContents( node );\n\t\t}\n\n\t\t// Apply the selection\n\t\tconst selection = docView.getSelection();\n\t\tif ( selection ) {\n\t\t\tselection.removeAllRanges();\n\t\t\tselection.addRange( range );\n\n\t\t\t// Store the current selection for cleanup\n\t\t\tstate.currentSelection = selection;\n\n\t\t\t// Apply CSS custom properties via selection styles\n\t\t\t// This uses the CSS variables we set on init\n\t\t\tif ( selection.rangeCount > 0 ) {\n\t\t\t\tselection.getRangeAt( 0 );\n\t\t\t\tselection.getRangeAt( 0 );\n\t\t\t}\n\t\t}\n\t} catch ( e ) {\n\t\tconsole.warn( 'Error creating highlight:', e );\n\t}\n};\n\n// Safari-specific timer-based highlighting fallback\nexport const setupSafariHighlighting = ( state, content ) => {\n\tif ( state.browserType !== 'safari' ) {\n\t\treturn null;\n\t}\n\n\t// Estimate reading speed (chars per second)\n\tconst charsPerSecond = 15 * state.currentSpeed;\n\tconst intervalTime = 250; // Check every 250ms\n\n\tlet currentIndex = 0;\n\tconst timerId = setInterval( () => {\n\t\tif ( ! state.isPlaying ) {\n\t\t\tclearInterval( timerId );\n\t\t\treturn;\n\t\t}\n\n\t\t// Create a synthetic boundary event for Safari\n\t\tconst syntheticEvent = {\n\t\t\tcharIndex: currentIndex,\n\t\t\tcharLength: 1,\n\t\t};\n\n\t\thandleBoundaryEvent( state, syntheticEvent, content );\n\n\t\t// Advance the position based on estimated reading speed\n\t\tcurrentIndex += Math.ceil( ( charsPerSecond * intervalTime ) / 1000 );\n\t}, intervalTime );\n\n\treturn timerId;\n};\n\nexport const handleBoundaryEvent = ( state, event ) => {\n\tconst mainElement = getMainElement();\n\tif ( ! mainElement ) {\n\t\treturn;\n\t}\n\n\ttry {\n\t\t// Calculate the absolute position by adding offsets of previous chunks\n\t\tlet absoluteCharIndex = event.charIndex;\n\t\tif ( state.currentChunk > 0 ) {\n\t\t\t// Add lengths of all previous chunks\n\t\t\tfor ( let i = 0; i < state.currentChunk; i++ ) {\n\t\t\t\tabsoluteCharIndex += state.textChunks[ i ].length + 1; // +1 for space between chunks\n\t\t\t}\n\t\t}\n\n\t\tif ( state.selectedTextRange?.hasSelection ) {\n\t\t\t// Handle selected text case...\n\t\t} else {\n\t\t\t// Handle main content highlighting\n\t\t\tconst blockWrapper = getBlockWrapper();\n\t\t\tconst excludeClassesStr =\n\t\t\t\tblockWrapper?.dataset.excludeClass || DEFAULTS.EXCLUDE_CLASS;\n\t\t\tconst excludeClasses = excludeClassesStr.split( /\\s+/ );\n\n\t\t\t// Rebuild node positions map if empty\n\t\t\tif ( state.nodePositions.size === 0 ) {\n\t\t\t\tbuildNodePositionsMap( state, mainElement, excludeClasses );\n\t\t\t}\n\n\t\t\t// Find the node containing the current absolute position\n\t\t\tlet targetNode = null;\n\t\t\tlet bestMatch = {\n\t\t\t\tnode: null,\n\t\t\t\tdistance: Number.MAX_SAFE_INTEGER,\n\t\t\t};\n\n\t\t\t// Find the closest position in the map using absolute position\n\t\t\tconst positions = Array.from( state.nodePositions.keys() ).sort(\n\t\t\t\t( a, b ) => a - b\n\t\t\t);\n\n\t\t\tfor ( let i = 0; i < positions.length; i++ ) {\n\t\t\t\tconst pos = positions[ i ];\n\t\t\t\tconst nodeData = state.nodePositions.get( pos );\n\n\t\t\t\t// Exact match using absolute position\n\t\t\t\tif (\n\t\t\t\t\tpos <= absoluteCharIndex &&\n\t\t\t\t\tabsoluteCharIndex < pos + nodeData.length\n\t\t\t\t) {\n\t\t\t\t\ttargetNode = nodeData.node;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// For Firefox, track approximate matches as fallback\n\t\t\t\tif ( state.browserType === 'firefox' ) {\n\t\t\t\t\tconst distance = Math.abs( pos - absoluteCharIndex );\n\t\t\t\t\tif ( distance < bestMatch.distance ) {\n\t\t\t\t\t\tbestMatch = { node: nodeData.node, distance };\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Use best approximate match for Firefox if no exact match\n\t\t\tif (\n\t\t\t\t! targetNode &&\n\t\t\t\tstate.browserType === 'firefox' &&\n\t\t\t\tbestMatch.node\n\t\t\t) {\n\t\t\t\ttargetNode = bestMatch.node;\n\t\t\t}\n\n\t\t\t// Update highlight if we found a new node\n\t\t\tif (\n\t\t\t\ttargetNode &&\n\t\t\t\ttargetNode !== state.currentHighlightedNode &&\n\t\t\t\ttargetNode.textContent.trim().length > 0\n\t\t\t) {\n\t\t\t\tclearHighlights( state );\n\t\t\t\tcreateHighlightWrapper( state, targetNode );\n\t\t\t\tstate.currentHighlightedNode = targetNode;\n\n\t\t\t\t// Scroll the highlighted word into view\n\t\t\t\tif ( targetNode.nodeType !== Node.TEXT_NODE ) {\n\t\t\t\t\ttargetNode.scrollIntoView( {\n\t\t\t\t\t\tbehavior: 'smooth',\n\t\t\t\t\t\tblock: 'center',\n\t\t\t\t\t} );\n\t\t\t\t} else if ( targetNode.parentNode ) {\n\t\t\t\t\ttargetNode.parentNode.scrollIntoView( {\n\t\t\t\t\t\tbehavior: 'smooth',\n\t\t\t\t\t\tblock: 'center',\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch ( e ) {\n\t\tconsole.error( 'Highlighting error:', e );\n\t}\n};\n\n// Add a new method to build the node positions map more efficiently\nexport const buildNodePositionsMap = ( state, rootElement, excludeClasses ) => {\n\tstate.nodePositions.clear();\n\n\t// Optimized node collection with filtering\n\tconst collectTextNodes = ( element, charCount = 0 ) => {\n\t\t// Skip excluded elements\n\t\tif ( element.classList ) {\n\t\t\tfor ( const excludeClass of excludeClasses ) {\n\t\t\t\tif (\n\t\t\t\t\texcludeClass &&\n\t\t\t\t\telement.classList.contains( excludeClass )\n\t\t\t\t) {\n\t\t\t\t\treturn charCount;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Process text nodes\n\t\tif ( element.nodeType === Node.TEXT_NODE ) {\n\t\t\tconst text = element.textContent;\n\t\t\tif ( text.trim().length > 0 ) {\n\t\t\t\tstate.nodePositions.set( charCount, {\n\t\t\t\t\tnode: element,\n\t\t\t\t\tlength: text.length,\n\t\t\t\t} );\n\t\t\t\tcharCount += text.length;\n\t\t\t}\n\t\t\treturn charCount;\n\t\t}\n\n\t\t// Process element children\n\t\tif ( element.childNodes && element.childNodes.length > 0 ) {\n\t\t\tfor ( const child of element.childNodes ) {\n\t\t\t\tcharCount = collectTextNodes( child, charCount );\n\t\t\t}\n\t\t}\n\n\t\treturn charCount;\n\t};\n\n\t// Start the collection process\n\tcollectTextNodes( rootElement );\n};\n","/**\n * Export all actions for easy import\n */\n\nexport * from './synthesis';\nexport * from './highlight';\nexport * from './voice';\nexport * from './utterance';\nexport * from './playback';\nexport * from './content';\n","/**\n * Playback control actions\n */\n\nimport { getContext } from '@wordpress/interactivity';\nimport { getCurrentLocale, getMainElement, getBlockWrapper } from '../utils';\nimport { checkSynthesisReady, setupSafariKeepAlive } from './synthesis';\nimport {\n\tclearHighlights,\n\tbuildNodePositionsMap,\n\thandleBoundaryEvent,\n} from './highlight';\nimport { createUtterance, handleUtteranceEnd } from './utterance';\nimport { getContent } from './content';\nimport { DEFAULTS } from '../constants';\nimport {\n\tInputValidator,\n\tTTSValidator,\n\tSecureStorage,\n\tSecureErrorHandler\n} from '../security';\n\n// Playback Controls\nexport const Play = async ( state ) => {\n\tconst context = getContext();\n\tif ( context ) {\n\t\tcontext.isPlaying = true;\n\t}\n\tstate.isPlaying = true;\n\n\t// Firefox resume handling\n\tif ( state.browserType === 'firefox' && state.pausedAt ) {\n\t\t// Create a new utterance from the paused position\n\t\tconst remainingText = state.pausedAt.text.substring(\n\t\t\tstate.pausedAt.charIndex\n\t\t);\n\n\t\t// Set the current chunk back to where we paused\n\t\tstate.currentChunk = state.pausedAt.chunk;\n\n\t\t// Create new utterance for the remaining text\n\t\tconst newUtterance = new window.SpeechSynthesisUtterance(\n\t\t\tremainingText\n\t\t);\n\t\tnewUtterance.lang = getCurrentLocale();\n\t\tnewUtterance.rate = state.currentSpeed;\n\t\tnewUtterance.pitch = state.currentPitch;\n\n\t\t// Initialize the last character index for the new utterance\n\t\tnewUtterance._lastCharIndex = 0;\n\n\t\t// Store the content offset for highlighting calculations\n\t\tnewUtterance._contentOffset = state.pausedAt.contentPosition;\n\n\t\tif ( state.currentVoice ) {\n\t\t\tconst voice = state.voices.find(\n\t\t\t\t( v ) => v.voiceURI === state.currentVoice.voiceURI\n\t\t\t);\n\t\t\tnewUtterance.voice = voice;\n\t\t}\n\n\t\t// Create a custom boundary handler specific to this resumed utterance\n\t\tnewUtterance.onboundary = ( event ) => {\n\t\t\t// Save last character index for pause handling\n\t\t\tnewUtterance._lastCharIndex = event.charIndex || 0;\n\n\t\t\t// Calculate the absolute position in the original content\n\t\t\tconst absolutePosition =\n\t\t\t\t( event.charIndex || 0 ) + state.pausedAt.contentPosition;\n\n\t\t\t// Create an adjusted event with the correct character index\n\t\t\tconst adjustedEvent = {\n\t\t\t\t...event,\n\t\t\t\tcharIndex: absolutePosition,\n\t\t\t\t// Ensure charLength is always valid\n\t\t\t\tcharLength: event.charLength || 1,\n\t\t\t};\n\n\t\t\t// Pass to normal boundary handler but with full original text\n\t\t\tconst mainElement = getMainElement();\n\t\t\tif ( mainElement ) {\n\t\t\t\t// Force rebuild node positions to ensure synchronization\n\t\t\t\tconst blockWrapper = getBlockWrapper();\n\t\t\t\tconst excludeClassesStr =\n\t\t\t\t\tblockWrapper?.dataset.excludeClass ||\n\t\t\t\t\tDEFAULTS.EXCLUDE_CLASS;\n\n\t\t\t\tif ( state.nodePositions.size === 0 ) {\n\t\t\t\t\tbuildNodePositionsMap(\n\t\t\t\t\t\tstate,\n\t\t\t\t\t\tmainElement,\n\t\t\t\t\t\texcludeClassesStr.split( /\\s+/ )\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Handle the boundary event with the full content context\n\t\t\t\thandleBoundaryEvent(\n\t\t\t\t\tstate,\n\t\t\t\t\tadjustedEvent,\n\t\t\t\t\tstate.pausedAt.fullText || state.pausedAt.text\n\t\t\t\t);\n\t\t\t}\n\t\t};\n\n\t\tnewUtterance.onend = () => handleUtteranceEnd( state );\n\n\t\tstate.utterance = newUtterance;\n\n\t\t// Speak the new utterance\n\t\twindow.speechSynthesis.speak( state.utterance );\n\n\t\t// In Safari, set up the keep-alive timer\n\t\tif ( state.browserType === 'safari' ) {\n\t\t\tsetupSafariKeepAlive( state );\n\t\t}\n\n\t\t// Clear the paused state\n\t\tstate.pausedAt = null;\n\n\t\treturn;\n\t}\n\n\tif ( state.textChunks.length === 0 || state.currentChunk === 0 ) {\n\t\tgetContent( state );\n\t\tcreateUtterance( state, context );\n\t}\n\n\ttry {\n\t\tif ( window.speechSynthesis.paused ) {\n\t\t\twindow.speechSynthesis.resume();\n\t\t\treturn;\n\t\t}\n\t} catch ( e ) {\n\t\tconsole.warn( 'Resume failed, recreating speech:', e );\n\t\t// If resume fails, recreate the utterance\n\t\tcreateUtterance( state, context );\n\t}\n\n\t// Chrome and Edge fix - recreate utterance if speaking\n\tif ( state.browserType === 'chrome' || state.browserType === 'edge' ) {\n\t\tif ( window.speechSynthesis.speaking ) {\n\t\t\twindow.speechSynthesis.cancel();\n\t\t\tsetTimeout( () => {\n\t\t\t\tif ( state.utterance ) {\n\t\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t\t\t}\n\t\t\t}, 50 );\n\t\t\treturn;\n\t\t}\n\t}\n\n\tif ( state.utterance ) {\n\t\twindow.speechSynthesis.speak( state.utterance );\n\n\t\t// In Safari, set up the keep-alive timer\n\t\tif ( state.browserType === 'safari' ) {\n\t\t\tsetupSafariKeepAlive( state );\n\t\t}\n\t}\n};\n\nexport const Pause = async ( state ) => {\n\tconst context = getContext();\n\tif ( context ) {\n\t\tcontext.isPlaying = false;\n\t}\n\tstate.isPlaying = false;\n\tclearHighlights( state );\n\n\t// Firefox doesn't fully support pause, so we need to handle it differently\n\tif ( state.browserType === 'firefox' ) {\n\t\t// Store the current position\n\t\tif ( window.speechSynthesis.speaking ) {\n\t\t\t// Get the full text content for context\n\t\t\tconst fullText = state.textChunks.join( ' ' );\n\n\t\t\t// Save current speech state for later resuming\n\t\t\tstate.pausedAt = {\n\t\t\t\ttext: state.utterance.text,\n\t\t\t\tcharIndex: state.utterance._lastCharIndex || 0,\n\t\t\t\tchunk: state.currentChunk,\n\t\t\t\t// Track full content position to correctly restore highlighting\n\t\t\t\tcontentPosition:\n\t\t\t\t\tstate.utterance._lastCharIndex +\n\t\t\t\t\t( state.currentChunk > 0\n\t\t\t\t\t\t? state.textChunks\n\t\t\t\t\t\t\t\t.slice( 0, state.currentChunk )\n\t\t\t\t\t\t\t\t.reduce(\n\t\t\t\t\t\t\t\t\t( sum, chunk ) => sum + chunk.length,\n\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t: 0 ),\n\t\t\t\t// Store full text for better context on resume\n\t\t\t\tfullText,\n\t\t\t};\n\n\t\t\t// Cancel current speech\n\t\t\twindow.speechSynthesis.cancel();\n\t\t}\n\t} else if ( state.browserType === 'safari' ) {\n\t\t// Safari's pause is also unreliable\n\t\tif ( window.speechSynthesis.speaking ) {\n\t\t\t// Get the full text content for context\n\t\t\tconst fullText = state.textChunks.join( ' ' );\n\n\t\t\t// Save position like Firefox\n\t\t\tstate.pausedAt = {\n\t\t\t\ttext: state.utterance.text,\n\t\t\t\tcharIndex: state.utterance._lastCharIndex || 0,\n\t\t\t\tchunk: state.currentChunk,\n\t\t\t\tcontentPosition:\n\t\t\t\t\tstate.utterance._lastCharIndex +\n\t\t\t\t\t( state.currentChunk > 0\n\t\t\t\t\t\t? state.textChunks\n\t\t\t\t\t\t\t\t.slice( 0, state.currentChunk )\n\t\t\t\t\t\t\t\t.reduce(\n\t\t\t\t\t\t\t\t\t( sum, chunk ) => sum + chunk.length,\n\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t: 0 ),\n\t\t\t\t// Store full text for better context on resume\n\t\t\t\tfullText,\n\t\t\t};\n\n\t\t\t// Clear any Safari timers\n\t\t\tif ( state.utterance._safariTimerId ) {\n\t\t\t\tclearInterval( state.utterance._safariTimerId );\n\t\t\t}\n\n\t\t\tif ( state.safariKeepAliveTimer ) {\n\t\t\t\tclearInterval( state.safariKeepAliveTimer );\n\t\t\t\tstate.safariKeepAliveTimer = null;\n\t\t\t}\n\n\t\t\twindow.speechSynthesis.cancel();\n\t\t}\n\t} else if (\n\t\twindow.speechSynthesis.speaking &&\n\t\t! window.speechSynthesis.paused\n\t) {\n\t\t// Standard pause for Chrome and other browsers\n\t\twindow.speechSynthesis.pause();\n\t}\n};\n\nexport const Restart = ( state ) => {\n\tconst context = getContext();\n\tif ( context ) {\n\t\tcontext.isPlaying = false;\n\t}\n\tstate.isPlaying = false;\n\n\t// Clear any Safari timers\n\tif ( state.browserType === 'safari' ) {\n\t\tif ( state.utterance && state.utterance._safariTimerId ) {\n\t\t\tclearInterval( state.utterance._safariTimerId );\n\t\t}\n\n\t\tif ( state.safariKeepAliveTimer ) {\n\t\t\tclearInterval( state.safariKeepAliveTimer );\n\t\t\tstate.safariKeepAliveTimer = null;\n\t\t}\n\t}\n\n\twindow.speechSynthesis.cancel();\n\n\tstate.currentChunk = 0;\n\tstate.textChunks = [];\n\n\tclearHighlights( state );\n};\n\nexport const changeSpeed = async ( state, e ) => {\n\ttry {\n\t\t// Validate input\n\t\tconst validatedEvent = InputValidator.validateEvent( e );\n\t\tif ( ! validatedEvent ) {\n\t\t\tSecureErrorHandler.logError( 'Change Speed', new Error( 'Invalid event object' ) );\n\t\t\treturn false;\n\t\t}\n\n\t\tconst speed = TTSValidator.validateSpeed( validatedEvent.target.value );\n\t\tif ( speed === null ) {\n\t\t\tSecureErrorHandler.logError( 'Change Speed', new Error( 'Invalid speed value' ) );\n\t\t\treturn false;\n\t\t}\n\n\t\twindow.speechSynthesis.cancel();\n\n\t\tconst context = getContext();\n\t\tif ( context ) {\n\t\t\tcontext.isPlaying = false;\n\t\t}\n\t\t\n\t\tstate.currentSpeed = speed;\n\t\t\n\t\t// Secure localStorage operation\n\t\tconst currentLocale = getCurrentLocale();\n\t\tconst storageKey = `mosne-tts-speed-${ currentLocale }`;\n\t\tconst success = SecureStorage.setItem( storageKey, speed.toString() );\n\t\t\n\t\tif ( ! success ) {\n\t\t\tSecureErrorHandler.logError( 'Change Speed', new Error( 'Failed to save speed to localStorage' ) );\n\t\t}\n\n\t\tawait checkSynthesisReady();\n\t\tcreateUtterance( state, context );\n\n\t\tif ( context && ! context.isPlaying ) {\n\t\t\tsetTimeout( () => {\n\t\t\t\tcontext.isPlaying = true;\n\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t\t}, 50 );\n\t\t}\n\t\t\n\t\treturn true;\n\t} catch ( error ) {\n\t\tSecureErrorHandler.logError( 'Change Speed', error );\n\t\treturn false;\n\t}\n};\n\nexport const changePitch = async ( state, e ) => {\n\ttry {\n\t\t// Validate input\n\t\tconst validatedEvent = InputValidator.validateEvent( e );\n\t\tif ( ! validatedEvent ) {\n\t\t\tSecureErrorHandler.logError( 'Change Pitch', new Error( 'Invalid event object' ) );\n\t\t\treturn false;\n\t\t}\n\n\t\tconst pitch = TTSValidator.validatePitch( validatedEvent.target.value );\n\t\tif ( pitch === null ) {\n\t\t\tSecureErrorHandler.logError( 'Change Pitch', new Error( 'Invalid pitch value' ) );\n\t\t\treturn false;\n\t\t}\n\n\t\twindow.speechSynthesis.cancel();\n\t\tconst context = getContext();\n\t\tif ( context ) {\n\t\t\tcontext.isPlaying = false;\n\t\t}\n\n\t\tstate.currentPitch = pitch;\n\t\t\n\t\t// Secure localStorage operation\n\t\tconst currentLocale = getCurrentLocale();\n\t\tconst storageKey = `mosne-tts-pitch-${ currentLocale }`;\n\t\tconst success = SecureStorage.setItem( storageKey, pitch.toString() );\n\t\t\n\t\tif ( ! success ) {\n\t\t\tSecureErrorHandler.logError( 'Change Pitch', new Error( 'Failed to save pitch to localStorage' ) );\n\t\t}\n\n\t\tawait checkSynthesisReady();\n\t\tcreateUtterance( state, context );\n\n\t\tif ( context && ! context.isPlaying ) {\n\t\t\tsetTimeout( () => {\n\t\t\t\tcontext.isPlaying = true;\n\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t\t}, 50 );\n\t\t}\n\t\t\n\t\treturn true;\n\t} catch ( error ) {\n\t\tSecureErrorHandler.logError( 'Change Pitch', error );\n\t\treturn false;\n\t}\n};\n\nexport const toggleSettings = () => {\n\ttry {\n\t\tconst context = getContext();\n\t\tif ( context ) {\n\t\t\tcontext.showSettings = ! context.showSettings;\n\t\t}\n\t\treturn true;\n\t} catch ( error ) {\n\t\tSecureErrorHandler.logError( 'Toggle Settings', error );\n\t\treturn false;\n\t}\n};\n","/**\n * Speech synthesis management actions\n */\n\n// Speech Synthesis Management\nexport const checkSynthesisReady = () => {\n\treturn new Promise( ( resolve ) => {\n\t\tconst check = () => {\n\t\t\tif (\n\t\t\t\t! window.speechSynthesis.speaking &&\n\t\t\t\t! window.speechSynthesis.pending\n\t\t\t) {\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\tsetTimeout( check, 100 );\n\t\t\t}\n\t\t};\n\t\tcheck();\n\t} );\n};\n\n// Safari requires periodic \"ping\" to keep speech synthesis active\nexport const setupSafariKeepAlive = ( state ) => {\n\tif ( state.browserType !== 'safari' ) {\n\t\treturn;\n\t}\n\n\t// Clear any existing timer\n\tif ( state.safariKeepAliveTimer ) {\n\t\tclearInterval( state.safariKeepAliveTimer );\n\t}\n\n\t// Every 10 seconds, ping speechSynthesis to keep it alive\n\tstate.safariKeepAliveTimer = setInterval( () => {\n\t\tif ( state.isPlaying && window.speechSynthesis.speaking ) {\n\t\t\twindow.speechSynthesis.pause();\n\t\t\twindow.speechSynthesis.resume();\n\t\t} else {\n\t\t\tclearInterval( state.safariKeepAliveTimer );\n\t\t\tstate.safariKeepAliveTimer = null;\n\t\t}\n\t}, 10000 );\n};\n","/**\n * Utterance management actions\n */\n\nimport { getCurrentLocale } from '../utils';\nimport {\n\thandleBoundaryEvent,\n\tsetupSafariHighlighting,\n\tclearHighlights,\n} from './highlight';\n\n// Utterance Management\nexport const createUtterance = ( state, context ) => {\n\t// Get the content for the current chunk\n\tconst content = state.textChunks[ state.currentChunk ];\n\tconst newUtterance = new window.SpeechSynthesisUtterance( content );\n\tnewUtterance.lang = getCurrentLocale();\n\tnewUtterance.rate = state.currentSpeed;\n\tnewUtterance.pitch = state.currentPitch;\n\n\tif ( state.currentVoice ) {\n\t\tconst voice = state.voices.find(\n\t\t\t( v ) => v.voiceURI === state.currentVoice.voiceURI\n\t\t);\n\t\tnewUtterance.voice = voice;\n\t}\n\n\tsetupUtteranceEvents( state, newUtterance, content, context );\n\tstate.utterance = newUtterance;\n};\n\nexport const setupUtteranceEvents = ( state, utterance, content, context ) => {\n\t// Safari doesn't reliably fire boundary events, so use workarounds\n\tif ( state.browserType === 'safari' ) {\n\t\t// For Safari, we'll use word-level events and timeouts\n\t\tutterance.onboundary = ( event ) => {\n\t\t\t// Still try to use boundary events if they work\n\t\t\tutterance._lastCharIndex = event.charIndex || 0;\n\t\t\thandleBoundaryEvent( state, event, content );\n\t\t};\n\n\t\t// Also add a timer-based highlighting as fallback for Safari\n\t\tutterance._safariTimerId = setupSafariHighlighting( state, content );\n\t} else {\n\t\tutterance.onboundary = ( event ) => {\n\t\t\t// Save last character index for pause handling\n\t\t\tutterance._lastCharIndex = event.charIndex || 0;\n\n\t\t\t// If this utterance has a content offset (resumed utterance)\n\t\t\t// create an adjusted event with the correct character index\n\t\t\tconst adjustedEvent =\n\t\t\t\tutterance._contentOffset !== undefined\n\t\t\t\t\t? {\n\t\t\t\t\t\t\t...event,\n\t\t\t\t\t\t\tcharIndex:\n\t\t\t\t\t\t\t\t( event.charIndex || 0 ) +\n\t\t\t\t\t\t\t\tutterance._contentOffset,\n\t\t\t\t\t  }\n\t\t\t\t\t: event;\n\n\t\t\thandleBoundaryEvent( state, adjustedEvent, content );\n\t\t};\n\t}\n\n\tutterance.onend = () => {\n\t\t// Clear Safari timer if it exists\n\t\tif ( utterance._safariTimerId ) {\n\t\t\tclearInterval( utterance._safariTimerId );\n\t\t}\n\n\t\t// Check if there are more chunks to process\n\t\tif ( state.currentChunk < state.textChunks.length - 1 ) {\n\t\t\t// Move to next chunk\n\t\t\tstate.currentChunk++;\n\n\t\t\t// Create and speak the next utterance\n\t\t\tcreateUtterance( state, context );\n\n\t\t\t// Small delay to ensure proper timing\n\t\t\tsetTimeout( () => {\n\t\t\t\tif ( state.isPlaying && state.utterance ) {\n\t\t\t\t\twindow.speechSynthesis.speak( state.utterance );\n\t\t\t\t}\n\t\t\t}, 50 );\n\t\t} else {\n\t\t\t// This is the last chunk, perform cleanup\n\t\t\tif ( context ) {\n\t\t\t\tcontext.isPlaying = false;\n\t\t\t}\n\t\t\tstate.isPlaying = false;\n\t\t\tclearHighlights( state );\n\t\t}\n\t};\n\n\t// Ensure we can track errors across browsers\n\tutterance.onerror = ( event ) => {\n\t\tconsole.error( 'Speech synthesis error:', event );\n\t\tif ( event.error === 'interrupted' ) {\n\t\t\t// Reset the speech synthesis state\n\t\t\tspeechSynthesis.cancel();\n\t\t\thandleUtteranceEnd( state );\n\t\t}\n\t};\n};\n\nexport const handleUtteranceEnd = ( state ) => {\n\t// Clear any remaining highlights\n\tclearHighlights( state );\n\n\t// Update playing state\n\tstate.isPlaying = false;\n\n\t// Reset chunk tracking\n\tstate.currentChunk = 0;\n\tstate.textChunks = [];\n\n\t// Reset highlight tracking\n\tstate.currentHighlightedNode = null;\n\n\t// Clear selected text range\n\tstate.selectedTextRange = {\n\t\thasSelection: false,\n\t};\n};\n","/**\n * Voice management actions\n */\n\nimport { getCurrentLocale } from '../utils';\nimport { createUtterance } from './utterance';\nimport { getContext } from '@wordpress/interactivity';\nimport {\n\tInputValidator,\n\tTTSValidator,\n\tSecureStorage,\n\tSecureErrorHandler\n} from '../security';\n// Voice Management\nexport const loadVoices = async ( state ) => {\n\ttry {\n\t\t// For Safari/iOS, ensure we have access to voices\n\t\tif ( state.browserType === 'safari' ) {\n\t\t\t// Safari sometimes needs speech synthesis to be triggered first\n\t\t\twindow.speechSynthesis.speak( new SpeechSynthesisUtterance( '' ) );\n\t\t\twindow.speechSynthesis.cancel();\n\t\t}\n\n\t\tconst availableVoices = window.speechSynthesis.getVoices();\n\n\t\tif ( ! availableVoices?.length ) {\n\t\t\t// Try again in a bit - browsers load voices asynchronously\n\t\t\tsetTimeout( () => loadVoices( state ), 100 );\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentLocale = getCurrentLocale();\n\t\t\n\t\t// Validate and filter voices\n\t\tconst validVoices = availableVoices.filter( voice => {\n\t\t\treturn voice && \n\t\t\t\t   typeof voice.lang === 'string' && \n\t\t\t\t   typeof voice.voiceURI === 'string' &&\n\t\t\t\t   voice.lang.length > 0 &&\n\t\t\t\t   voice.voiceURI.length > 0;\n\t\t});\n\n\t\tif ( validVoices.length === 0 ) {\n\t\t\tSecureErrorHandler.logError( 'Load Voices', new Error( 'No valid voices found' ) );\n\t\t\treturn;\n\t\t}\n\n\t\tconst localVoices = validVoices.filter( ( voice ) =>\n\t\t\tvoice.lang.startsWith( currentLocale )\n\t\t);\n\n\t\tstate.voices = localVoices.length > 0 ? localVoices : validVoices;\n\t\tstate.currentVoice = state.voices[ 0 ];\n\n\t\tif ( state.preferredVoice ) {\n\t\t\tconst validatedVoice = TTSValidator.validateVoice( state.preferredVoice, state.voices );\n\t\t\tif ( validatedVoice ) {\n\t\t\t\tstate.currentVoice = validatedVoice;\n\t\t\t}\n\t\t}\n\n\t\tsetTimeout( () => createUtterance( state ), 50 );\n\t\treturn true;\n\t} catch ( error ) {\n\t\tSecureErrorHandler.logError( 'Load Voices', error );\n\t\treturn false;\n\t}\n};\n\nexport const changeVoice = ( state, e ) => {\n\ttry {\n\t\t// Validate input\n\t\tconst validatedEvent = InputValidator.validateEvent( e );\n\t\tif ( ! validatedEvent ) {\n\t\t\tSecureErrorHandler.logError( 'Change Voice', new Error( 'Invalid event object' ) );\n\t\t\treturn false;\n\t\t}\n\n\t\tconst voiceURI = InputValidator.validateString( validatedEvent.target.value );\n\t\tif ( ! voiceURI ) {\n\t\t\tSecureErrorHandler.logError( 'Change Voice', new Error( 'Invalid voice URI' ) );\n\t\t\treturn false;\n\t\t}\n\n\t\t// Cancel any ongoing speech\n\t\twindow.speechSynthesis.cancel();\n\n\t\tconst context = getContext();\n\t\tif ( context ) {\n\t\t\tcontext.isPlaying = false;\n\t\t}\n\n\t\t// Validate voice exists in available voices\n\t\tconst voice = TTSValidator.validateVoice( voiceURI, state.voices );\n\t\tif ( ! voice ) {\n\t\t\tSecureErrorHandler.logError( 'Change Voice', new Error( 'Voice not found in available voices' ) );\n\t\t\treturn false;\n\t\t}\n\n\t\tstate.currentVoice = voice;\n\t\t\n\t\t// Secure localStorage operation\n\t\tconst currentLocale = getCurrentLocale();\n\t\tconst storageKey = `mosne-tts-lang-${ currentLocale }`;\n\t\tconst success = SecureStorage.setItem( storageKey, voice.voiceURI );\n\t\t\n\t\tif ( ! success ) {\n\t\t\tSecureErrorHandler.logError( 'Change Voice', new Error( 'Failed to save voice to localStorage' ) );\n\t\t}\n\n\t\treturn true;\n\t} catch ( error ) {\n\t\tSecureErrorHandler.logError( 'Change Voice', error );\n\t\treturn false;\n\t}\n};\n","/**\n * Callback functions for the text-to-speech functionality\n */\n\nimport { getContext } from '@wordpress/interactivity';\nimport { getBlockWrapper, getMainElement, initHighlightColors } from './utils';\nimport { DEFAULTS } from './constants';\nimport { loadVoices } from './actions/voice';\nimport { buildNodePositionsMap } from './actions/highlight';\nimport { SecureErrorHandler } from './security';\n\nexport const init = ( state ) => {\n\ttry {\n\t\tif ( ! window.speechSynthesis ) {\n\t\t\tSecureErrorHandler.logError( 'Init Callback', new Error( 'Speech synthesis not supported in this browser' ) );\n\t\t\treturn false;\n\t\t}\n\n\t\t// Cancel any ongoing speech\n\t\twindow.speechSynthesis.cancel();\n\n\t\t// Initialize highlight colors once at startup\n\t\tconst highlightSuccess = initHighlightColors();\n\t\tif ( ! highlightSuccess ) {\n\t\t\tSecureErrorHandler.logError( 'Init Callback', new Error( 'Failed to initialize highlight colors' ) );\n\t\t}\n\n\t\t// Load available voices\n\t\tconst voiceSuccess = loadVoices( state );\n\t\tif ( ! voiceSuccess ) {\n\t\t\tSecureErrorHandler.logError( 'Init Callback', new Error( 'Failed to load voices' ) );\n\t\t}\n\n\t\tif ( window.speechSynthesis.onvoiceschanged !== undefined ) {\n\t\t\twindow.speechSynthesis.onvoiceschanged = () => {\n\t\t\t\ttry {\n\t\t\t\t\tloadVoices( state );\n\t\t\t\t} catch ( error ) {\n\t\t\t\t\tSecureErrorHandler.logError( 'Voices Changed Event', error );\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\twindow.addEventListener( 'beforeunload', () => {\n\t\t\ttry {\n\t\t\t\twindow.speechSynthesis.cancel();\n\n\t\t\t\t// Clear any Safari timers\n\t\t\t\tif ( state.browserType === 'safari' ) {\n\t\t\t\t\tif ( state.utterance && state.utterance._safariTimerId ) {\n\t\t\t\t\t\tclearInterval( state.utterance._safariTimerId );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( state.safariKeepAliveTimer ) {\n\t\t\t\t\t\tclearInterval( state.safariKeepAliveTimer );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Before Unload Event', error );\n\t\t\t}\n\t\t} );\n\n\t\t// Initial node map building for better performance when playback starts\n\t\tconst mainElement = getMainElement();\n\t\tif ( mainElement ) {\n\t\t\tconst blockWrapper = getBlockWrapper();\n\t\t\tconst excludeClassesStr = blockWrapper?.dataset.excludeClass || DEFAULTS.EXCLUDE_CLASS;\n\t\t\tconst excludeClasses = excludeClassesStr.split( /\\s+/ ).filter( cls => cls.trim() );\n\t\t\t\n\t\t\tsetTimeout( () => {\n\t\t\t\ttry {\n\t\t\t\t\tbuildNodePositionsMap( state, mainElement, excludeClasses );\n\t\t\t\t} catch ( error ) {\n\t\t\t\t\tSecureErrorHandler.logError( 'Build Node Positions Map', error );\n\t\t\t\t}\n\t\t\t}, 500 ); // Delay to ensure DOM is ready\n\t\t}\n\n\t\treturn true;\n\t} catch ( error ) {\n\t\tSecureErrorHandler.logError( 'Init Callback', error );\n\t\treturn false;\n\t}\n};\n\nexport const isSelected = ( state ) => {\n\ttry {\n\t\tconst context = getContext();\n\t\tif ( ! context || ! state ) {\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\treturn context.voice?.voiceURI === state.currentVoice?.voiceURI;\n\t} catch ( error ) {\n\t\tSecureErrorHandler.logError( 'Is Selected Callback', error );\n\t\treturn false;\n\t}\n};\n","/**\n * Constants for the text-to-speech functionality\n */\n\nexport const STORAGE_KEYS = {\n\tLANG: ( lang ) => `mosne-tts-lang-${ lang }`,\n\tSPEED: ( lang ) => `mosne-tts-speed-${ lang }`,\n\tPITCH: ( lang ) => `mosne-tts-pitch-${ lang }`,\n};\n\nexport const DEFAULTS = {\n\tHIGHLIGHT_BG: '#ffeb3b',\n\tHIGHLIGHT_COLOR: '#000000',\n\tEXCLUDE_CLASS: 'skip-speech',\n\tWORDS_PER_CHUNK: 200,\n};\n","/**\n * Security utilities for text-to-speech functionality\n * \n * Provides comprehensive input validation, content sanitization,\n * and secure operations to prevent XSS, injection attacks, and data corruption.\n *\n * @since 1.0.0\n */\n\n/**\n * Security configuration constants\n */\nconst SECURITY_CONFIG = {\n\tMAX_INPUT_LENGTH: 1000,\n\tMAX_SPEED: 10,\n\tMIN_SPEED: 0.1,\n\tMAX_PITCH: 2,\n\tMIN_PITCH: 0.1,\n\tALLOWED_CSS_PROPERTIES: [\n\t\t'--mosne-tts-highlight-bg',\n\t\t'--mosne-tts-highlight-color'\n\t],\n\tSAFE_COLOR_PATTERN: /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$|^rgb\\(\\s*\\d{1,3}\\s*,\\s*\\d{1,3}\\s*,\\s*\\d{1,3}\\s*\\)$|^rgba\\(\\s*\\d{1,3}\\s*,\\s*\\d{1,3}\\s*,\\s*\\d{1,3}\\s*,\\s*[\\d.]+\\s*\\)$/,\n\tSAFE_KEY_PATTERN: /^[a-zA-Z0-9-_]+$/,\n\tSAFE_VOICE_URI_PATTERN: /^[a-zA-Z0-9._-]+$/\n};\n\n/**\n * Input validation utilities\n */\nexport const InputValidator = {\n\t/**\n\t * Validate and sanitize string input\n\t *\n\t * @param {*} input - Input to validate\n\t * @param {number} maxLength - Maximum allowed length\n\t * @return {string|null} Sanitized string or null if invalid\n\t */\n\tvalidateString: ( input, maxLength = SECURITY_CONFIG.MAX_INPUT_LENGTH ) => {\n\t\tif ( typeof input !== 'string' ) {\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\tif ( input.length > maxLength ) {\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\t// Remove potentially dangerous characters\n\t\treturn input.replace( /[<>'\"&]/g, '' ).trim();\n\t},\n\n\t/**\n\t * Validate numeric input within range\n\t *\n\t * @param {*} input - Input to validate\n\t * @param {number} min - Minimum allowed value\n\t * @param {number} max - Maximum allowed value\n\t * @return {number|null} Validated number or null if invalid\n\t */\n\tvalidateNumber: ( input, min, max ) => {\n\t\tconst num = parseFloat( input );\n\t\t\n\t\tif ( isNaN( num ) || num < min || num > max ) {\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\treturn num;\n\t},\n\n\t/**\n\t * Validate event object\n\t *\n\t * @param {*} event - Event object to validate\n\t * @return {Object|null} Validated event or null if invalid\n\t */\n\tvalidateEvent: ( event ) => {\n\t\tif ( ! event || typeof event !== 'object' ) {\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\tif ( ! event.target || typeof event.target !== 'object' ) {\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\treturn event;\n\t},\n\n\t/**\n\t * Validate voice URI\n\t *\n\t * @param {string} voiceURI - Voice URI to validate\n\t * @return {string|null} Validated URI or null if invalid\n\t */\n\tvalidateVoiceURI: ( voiceURI ) => {\n\t\tif ( ! voiceURI || typeof voiceURI !== 'string' ) {\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\tif ( ! SECURITY_CONFIG.SAFE_VOICE_URI_PATTERN.test( voiceURI ) ) {\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\treturn voiceURI;\n\t}\n};\n\n/**\n * Content sanitization utilities\n */\nexport const ContentSanitizer = {\n\t/**\n\t * Sanitize HTML content to prevent XSS\n\t *\n\t * @param {string} input - HTML content to sanitize\n\t * @return {string} Sanitized content\n\t */\n\tsanitizeHTML: ( input ) => {\n\t\tif ( typeof input !== 'string' ) {\n\t\t\treturn '';\n\t\t}\n\t\t\n\t\t// Create a temporary div element\n\t\tconst div = document.createElement( 'div' );\n\t\tdiv.textContent = input;\n\t\treturn div.innerHTML;\n\t},\n\n\t/**\n\t * Sanitize text content for safe display\n\t *\n\t * @param {string} input - Text content to sanitize\n\t * @return {string} Sanitized text\n\t */\n\tsanitizeText: ( input ) => {\n\t\tif ( typeof input !== 'string' ) {\n\t\t\treturn '';\n\t\t}\n\t\t\n\t\t// Remove potentially dangerous characters\n\t\treturn input\n\t\t\t.replace( /[<>'\"&]/g, '' )\n\t\t\t.replace( /\\s+/g, ' ' )\n\t\t\t.trim();\n\t},\n\n\t/**\n\t * Sanitize CSS color values\n\t *\n\t * @param {string} color - CSS color value to sanitize\n\t * @return {string} Sanitized color or default\n\t */\n\tsanitizeColor: ( color ) => {\n\t\tif ( typeof color !== 'string' ) {\n\t\t\treturn '#ffeb3b';\n\t\t}\n\t\t\n\t\tif ( SECURITY_CONFIG.SAFE_COLOR_PATTERN.test( color ) ) {\n\t\t\treturn color;\n\t\t}\n\t\t\n\t\treturn '#ffeb3b';\n\t}\n};\n\n/**\n * Secure localStorage operations\n */\nexport const SecureStorage = {\n\t/**\n\t * Safely set localStorage item\n\t *\n\t * @param {string} key - Storage key\n\t * @param {string} value - Value to store\n\t * @return {boolean} True if successful, false otherwise\n\t */\n\tsetItem: ( key, value ) => {\n\t\ttry {\n\t\t\t// Validate key format\n\t\t\tif ( ! SECURITY_CONFIG.SAFE_KEY_PATTERN.test( key ) ) {\n\t\t\t\tconsole.warn( 'Invalid storage key format:', key );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\t// Sanitize value\n\t\t\tconst sanitizedValue = InputValidator.validateString( value );\n\t\t\tif ( ! sanitizedValue ) {\n\t\t\t\tconsole.warn( 'Invalid storage value:', value );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\twindow.localStorage.setItem( key, sanitizedValue );\n\t\t\treturn true;\n\t\t} catch ( error ) {\n\t\t\tconsole.warn( 'Storage operation failed:', error.message );\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * Safely get localStorage item\n\t *\n\t * @param {string} key - Storage key\n\t * @param {string} defaultValue - Default value if key not found\n\t * @return {string} Stored value or default\n\t */\n\tgetItem: ( key, defaultValue = null ) => {\n\t\ttry {\n\t\t\t// Validate key format\n\t\t\tif ( ! SECURITY_CONFIG.SAFE_KEY_PATTERN.test( key ) ) {\n\t\t\t\treturn defaultValue;\n\t\t\t}\n\t\t\t\n\t\t\tconst value = window.localStorage.getItem( key );\n\t\t\tif ( ! value ) {\n\t\t\t\treturn defaultValue;\n\t\t\t}\n\t\t\t\n\t\t\t// Validate retrieved value\n\t\t\tconst sanitizedValue = InputValidator.validateString( value );\n\t\t\treturn sanitizedValue || defaultValue;\n\t\t} catch ( error ) {\n\t\t\tconsole.warn( 'Storage retrieval failed:', error.message );\n\t\t\treturn defaultValue;\n\t\t}\n\t}\n};\n\n/**\n * Secure DOM operations\n */\nexport const SecureDOM = {\n\t/**\n\t * Safely set CSS custom property\n\t *\n\t * @param {Element} element - Target element\n\t * @param {string} property - CSS property name\n\t * @param {string} value - CSS property value\n\t * @return {boolean} True if successful, false otherwise\n\t */\n\tsetCSSProperty: ( element, property, value ) => {\n\t\tif ( ! element || ! property || ! value ) {\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\t// Validate property name\n\t\tif ( ! SECURITY_CONFIG.ALLOWED_CSS_PROPERTIES.includes( property ) ) {\n\t\t\tconsole.warn( 'Unsafe CSS property:', property );\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\t// Sanitize CSS value\n\t\tconst sanitizedValue = ContentSanitizer.sanitizeColor( value );\n\t\telement.style.setProperty( property, sanitizedValue );\n\t\treturn true;\n\t},\n\n\t/**\n\t * Safely get text content from element\n\t *\n\t * @param {Element} element - Target element\n\t * @return {string} Sanitized text content\n\t */\n\tgetTextContent: ( element ) => {\n\t\tif ( ! element ) {\n\t\t\treturn '';\n\t\t}\n\t\t\n\t\t// Use textContent instead of innerHTML to prevent XSS\n\t\tconst text = element.textContent || '';\n\t\treturn ContentSanitizer.sanitizeText( text );\n\t},\n\n\t/**\n\t * Safely query selector with validation\n\t *\n\t * @param {string} selector - CSS selector\n\t * @param {Element} context - Context element (optional)\n\t * @return {Element|null} Found element or null\n\t */\n\tquerySelector: ( selector, context = document ) => {\n\t\tif ( ! selector || typeof selector !== 'string' ) {\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\t// Validate selector contains only safe characters\n\t\tif ( ! /^[a-zA-Z0-9\\s._\\-\\[\\]#:(),>+~*=\"']+$/.test( selector ) ) {\n\t\t\tconsole.warn( 'Potentially unsafe selector:', selector );\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\ttry {\n\t\t\treturn context.querySelector( selector );\n\t\t} catch ( error ) {\n\t\t\tconsole.warn( 'Query selector failed:', error.message );\n\t\t\treturn null;\n\t\t}\n\t}\n};\n\n/**\n * Secure error handling\n */\nexport const SecureErrorHandler = {\n\t/**\n\t * Log error without exposing sensitive information\n\t *\n\t * @param {string} context - Error context\n\t * @param {Error} error - Error object\n\t * @param {Object} additionalData - Additional data to log (optional)\n\t */\n\tlogError: ( context, error, additionalData = {} ) => {\n\t\tconst errorInfo = {\n\t\t\tcontext,\n\t\t\tmessage: error.message || 'Unknown error',\n\t\t\ttimestamp: new Date().toISOString(),\n\t\t\t...additionalData\n\t\t};\n\t\t\n\t\t// Log sanitized error information\n\t\tconsole.error( `[TTS Error] ${ context }:`, errorInfo );\n\t},\n\n\t/**\n\t * Handle speech synthesis errors securely\n\t *\n\t * @param {Event} event - Speech synthesis error event\n\t * @param {Object} state - Current state object\n\t */\n\thandleSpeechError: ( event, state ) => {\n\t\tconst errorContext = {\n\t\t\terrorType: event.error || 'unknown',\n\t\t\tisPlaying: state.isPlaying,\n\t\t\tcurrentChunk: state.currentChunk\n\t\t};\n\t\t\n\t\tSecureErrorHandler.logError( 'Speech Synthesis', event, errorContext );\n\t\t\n\t\t// Reset state safely\n\t\tif ( state ) {\n\t\t\tstate.isPlaying = false;\n\t\t\tstate.currentChunk = 0;\n\t\t}\n\t}\n};\n\n/**\n * Input validation for specific TTS actions\n */\nexport const TTSValidator = {\n\t/**\n\t * Validate speed input\n\t *\n\t * @param {*} input - Speed input to validate\n\t * @return {number|null} Validated speed or null\n\t */\n\tvalidateSpeed: ( input ) => {\n\t\treturn InputValidator.validateNumber(\n\t\t\tinput,\n\t\t\tSECURITY_CONFIG.MIN_SPEED,\n\t\t\tSECURITY_CONFIG.MAX_SPEED\n\t\t);\n\t},\n\n\t/**\n\t * Validate pitch input\n\t *\n\t * @param {*} input - Pitch input to validate\n\t * @return {number|null} Validated pitch or null\n\t */\n\tvalidatePitch: ( input ) => {\n\t\treturn InputValidator.validateNumber(\n\t\t\tinput,\n\t\t\tSECURITY_CONFIG.MIN_PITCH,\n\t\t\tSECURITY_CONFIG.MAX_PITCH\n\t\t);\n\t},\n\n\t/**\n\t * Validate voice selection\n\t *\n\t * @param {string} voiceURI - Voice URI to validate\n\t * @param {Array} availableVoices - Array of available voices\n\t * @return {Object|null} Validated voice object or null\n\t */\n\tvalidateVoice: ( voiceURI, availableVoices = [] ) => {\n\t\tconst validatedURI = InputValidator.validateVoiceURI( voiceURI );\n\t\tif ( ! validatedURI ) {\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\t// Check if voice exists in available voices\n\t\tconst voice = availableVoices.find( v => v.voiceURI === validatedURI );\n\t\treturn voice || null;\n\t}\n};\n","/**\n * Initial state for the text-to-speech functionality\n */\n\nimport { STORAGE_KEYS } from './constants';\nimport { getLocalStorageItem, getCurrentLocale, getBrowser } from './utils';\n\nexport const initialState = {\n\tisPlaying: false,\n\tcurrentVoice: null,\n\tpreferredVoice: getLocalStorageItem(\n\t\tSTORAGE_KEYS.LANG( getCurrentLocale() ),\n\t\tnull\n\t),\n\tutterance: null,\n\tvoices: [],\n\tcurrentSpeed: getLocalStorageItem(\n\t\tSTORAGE_KEYS.SPEED( getCurrentLocale() ),\n\t\t1\n\t),\n\tcurrentPitch: getLocalStorageItem(\n\t\tSTORAGE_KEYS.PITCH( getCurrentLocale() ),\n\t\t1\n\t),\n\tselectedTextRange: { hasSelection: false },\n\tcurrentChunk: 0,\n\ttextChunks: [],\n\tisProcessingChunks: false,\n\tcurrentHighlightedNode: null,\n\tnodePositions: new Map(),\n\tcurrentSelection: null,\n\tpausedAt: null,\n\tbrowserType: getBrowser(),\n\t// For Safari ping-pong to keep synthesis alive\n\tsafariKeepAliveTimer: null,\n};\n","/**\n * Helper functions for text-to-speech functionality\n */\n\nimport { DEFAULTS } from './constants';\nimport {\n\tSecureStorage,\n\tSecureDOM,\n\tContentSanitizer,\n\tSecureErrorHandler\n} from './security';\n\nexport const getLocalStorageItem = ( key, defaultValue ) => {\n\treturn SecureStorage.getItem( key, defaultValue );\n};\n\nexport const getCurrentLocale = () => {\n\ttry {\n\t\tconst lang = document.documentElement.lang;\n\t\treturn ContentSanitizer.sanitizeText( lang ) || 'en';\n\t} catch ( error ) {\n\t\tSecureErrorHandler.logError( 'Get Current Locale', error );\n\t\treturn 'en';\n\t}\n};\n\nexport const getBlockWrapper = () => {\n\treturn SecureDOM.querySelector( '[data-wp-interactive=\"mosne-text-to-speech-block\"]' );\n};\n\nexport const getMainElement = () => {\n\treturn SecureDOM.querySelector( 'main' );\n};\n\n// Detect browser for specific handling\nexport const getBrowser = () => {\n\ttry {\n\t\tconst userAgent = window.navigator.userAgent;\n\t\tif ( ! userAgent || typeof userAgent !== 'string' ) {\n\t\t\treturn 'other';\n\t\t}\n\n\t\t// Sanitize user agent string\n\t\tconst sanitizedUA = ContentSanitizer.sanitizeText( userAgent );\n\t\t\n\t\tif ( sanitizedUA.indexOf( 'Firefox' ) !== -1 ) {\n\t\t\treturn 'firefox';\n\t\t}\n\t\tif (\n\t\t\tsanitizedUA.indexOf( 'Edge' ) !== -1 ||\n\t\t\tsanitizedUA.indexOf( 'Edg' ) !== -1\n\t\t) {\n\t\t\treturn 'edge';\n\t\t}\n\t\tif (\n\t\t\tsanitizedUA.indexOf( 'Safari' ) !== -1 &&\n\t\t\tsanitizedUA.indexOf( 'Chrome' ) === -1\n\t\t) {\n\t\t\treturn 'safari';\n\t\t}\n\t\tif ( sanitizedUA.indexOf( 'Chrome' ) !== -1 ) {\n\t\t\treturn 'chrome';\n\t\t}\n\t\treturn 'other';\n\t} catch ( error ) {\n\t\tSecureErrorHandler.logError( 'Get Browser', error );\n\t\treturn 'other';\n\t}\n};\n\nexport const initHighlightColors = () => {\n\ttry {\n\t\tconst mainElement = getMainElement();\n\t\tconst blockWrapper = getBlockWrapper();\n\n\t\tif ( ! mainElement || ! blockWrapper ) {\n\t\t\tSecureErrorHandler.logError( 'Init Highlight Colors', new Error( 'Required elements not found' ) );\n\t\t\treturn false;\n\t\t}\n\n\t\t// Get highlight colors from block settings or use defaults\n\t\tconst rawHighlightBackground = blockWrapper.dataset.highlightBackground || DEFAULTS.HIGHLIGHT_BG;\n\t\tconst rawHighlightColor = blockWrapper.dataset.highlightColor || DEFAULTS.HIGHLIGHT_COLOR;\n\n\t\t// Sanitize color values\n\t\tconst highlightBackground = ContentSanitizer.sanitizeColor( rawHighlightBackground );\n\t\tconst highlightColor = ContentSanitizer.sanitizeColor( rawHighlightColor );\n\n\t\t// Set CSS custom properties securely\n\t\tconst bgSuccess = SecureDOM.setCSSProperty(\n\t\t\tmainElement,\n\t\t\t'--mosne-tts-highlight-bg',\n\t\t\thighlightBackground\n\t\t);\n\t\t\n\t\tconst colorSuccess = SecureDOM.setCSSProperty(\n\t\t\tmainElement,\n\t\t\t'--mosne-tts-highlight-color',\n\t\t\thighlightColor\n\t\t);\n\n\t\treturn bgSuccess && colorSuccess;\n\t} catch ( error ) {\n\t\tSecureErrorHandler.logError( 'Init Highlight Colors', error );\n\t\treturn false;\n\t}\n};\n","module.exports = __WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * WordPress dependencies\n */\nimport { store } from '@wordpress/interactivity';\n\n/**\n * Internal dependencies\n */\nimport { initialState } from './view/state';\nimport * as a from './view/actions';\nimport * as c from './view/callbacks';\nimport {\n\tInputValidator,\n\tTTSValidator,\n\tSecureErrorHandler,\n} from './view/security';\n\n// Store configuration\nconst { state } = store( 'mosne-text-to-speech-block', {\n\tstate: initialState,\n\n\t// Map action creators to pass state as first argument\n\tactions: {\n\t\t// Synthesis\n\t\tcheckSynthesisReady: () => {\n\t\t\ttry {\n\t\t\t\treturn a.checkSynthesisReady( state );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Synthesis Ready Check', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tsetupSafariKeepAlive: () => {\n\t\t\ttry {\n\t\t\t\treturn a.setupSafariKeepAlive( state );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Safari Keep Alive', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\n\t\t// Highlighting\n\t\tbuildNodePositionsMap: () => {\n\t\t\ttry {\n\t\t\t\treturn a.buildNodePositionsMap( state );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Node Positions Map', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\thandleBoundaryEvent: () => {\n\t\t\ttry {\n\t\t\t\treturn a.handleBoundaryEvent( state );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Boundary Event', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tsetupSafariHighlighting: () => {\n\t\t\ttry {\n\t\t\t\treturn a.setupSafariHighlighting( state );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Safari Highlighting', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tclearHighlights: () => {\n\t\t\ttry {\n\t\t\t\treturn a.clearHighlights( state );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Clear Highlights', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\n\t\t// Voice management\n\t\tloadVoices: () => {\n\t\t\ttry {\n\t\t\t\treturn a.loadVoices( state );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Load Voices', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tchangeVoice: ( event ) => {\n\t\t\ttry {\n\t\t\t\tconst validatedEvent = InputValidator.validateEvent( event );\n\t\t\t\tif ( ! validatedEvent ) {\n\t\t\t\t\tconsole.warn( 'Invalid voice change event' );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst voiceURI = InputValidator.validateString(\n\t\t\t\t\tvalidatedEvent.target.value\n\t\t\t\t);\n\t\t\t\tif ( ! voiceURI ) {\n\t\t\t\t\tconsole.warn( 'Invalid voice URI' );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Create secure event object\n\t\t\t\tconst secureEvent = {\n\t\t\t\t\ttarget: { value: voiceURI },\n\t\t\t\t};\n\n\t\t\t\treturn a.changeVoice( state, secureEvent );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Change Voice', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\n\t\t// Utterance management\n\t\tcreateUtterance: () => {\n\t\t\ttry {\n\t\t\t\treturn a.createUtterance( state );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Create Utterance', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tsetupUtteranceEvents: () => {\n\t\t\ttry {\n\t\t\t\treturn a.setupUtteranceEvents( state );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Setup Utterance Events', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\thandleUtteranceEnd: () => {\n\t\t\ttry {\n\t\t\t\treturn a.handleUtteranceEnd( state );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Handle Utterance End', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\n\t\t// Playback controls\n\t\tPlay: () => {\n\t\t\ttry {\n\t\t\t\treturn a.Play( state );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Play Action', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tPause: () => {\n\t\t\ttry {\n\t\t\t\treturn a.Pause( state );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Pause Action', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tRestart: () => {\n\t\t\ttry {\n\t\t\t\treturn a.Restart( state );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Restart Action', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tchangeSpeed: ( event ) => {\n\t\t\ttry {\n\t\t\t\tconst validatedEvent = InputValidator.validateEvent( event );\n\t\t\t\tif ( ! validatedEvent ) {\n\t\t\t\t\tconsole.warn( 'Invalid speed change event' );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst speed = TTSValidator.validateSpeed(\n\t\t\t\t\tvalidatedEvent.target.value\n\t\t\t\t);\n\t\t\t\tif ( speed === null ) {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'Invalid speed value:',\n\t\t\t\t\t\tvalidatedEvent.target.value\n\t\t\t\t\t);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Create secure event object\n\t\t\t\tconst secureEvent = {\n\t\t\t\t\ttarget: { value: speed.toString() },\n\t\t\t\t};\n\n\t\t\t\treturn a.changeSpeed( state, secureEvent );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Change Speed', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tchangePitch: ( event ) => {\n\t\t\ttry {\n\t\t\t\tconst validatedEvent = InputValidator.validateEvent( event );\n\t\t\t\tif ( ! validatedEvent ) {\n\t\t\t\t\tconsole.warn( 'Invalid pitch change event' );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst pitch = TTSValidator.validatePitch(\n\t\t\t\t\tvalidatedEvent.target.value\n\t\t\t\t);\n\t\t\t\tif ( pitch === null ) {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'Invalid pitch value:',\n\t\t\t\t\t\tvalidatedEvent.target.value\n\t\t\t\t\t);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Create secure event object\n\t\t\t\tconst secureEvent = {\n\t\t\t\t\ttarget: { value: pitch.toString() },\n\t\t\t\t};\n\n\t\t\t\treturn a.changePitch( state, secureEvent );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Change Pitch', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\ttoggleSettings: () => {\n\t\t\ttry {\n\t\t\t\treturn a.toggleSettings( state );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Toggle Settings', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\n\t\t// Content management\n\t\tgetContent: () => {\n\t\t\ttry {\n\t\t\t\treturn a.getContent( state );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Get Content', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t},\n\n\t// Map callback creators to pass state as argument\n\tcallbacks: {\n\t\tinit: () => {\n\t\t\ttry {\n\t\t\t\treturn c.init( state );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Init Callback', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tisSelected: () => {\n\t\t\ttry {\n\t\t\t\treturn c.isSelected( state );\n\t\t\t} catch ( error ) {\n\t\t\t\tSecureErrorHandler.logError( 'Is Selected Callback', error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t},\n} );\n"],"names":["DEFAULTS","getBlockWrapper","getMainElement","buildNodePositionsMap","ContentSanitizer","SecureDOM","SecureErrorHandler","getContent","state","mainElement","logError","Error","docView","ownerDocument","defaultView","selection","getSelection","content","toString","trim","length","rawContent","sanitizeText","selectedTextRange","text","hasSelection","blockWrapper","excludeClassesStr","dataset","excludeClass","EXCLUDE_CLASS","excludeClasses","split","filter","cls","getTextContent","substring","textChunks","chunkText","WORDS_PER_CHUNK","currentChunk","error","wordsPerChunk","sanitizedText","words","word","chunks","i","chunk","slice","join","push","clearHighlights","currentSelection","removeAllRanges","e","console","warn","currentHighlightedNode","createHighlightWrapper","node","doc","range","createRange","nodeType","Node","TEXT_NODE","setStart","setEnd","selectNodeContents","addRange","rangeCount","getRangeAt","setupSafariHighlighting","browserType","charsPerSecond","currentSpeed","intervalTime","currentIndex","timerId","setInterval","isPlaying","clearInterval","syntheticEvent","charIndex","charLength","handleBoundaryEvent","Math","ceil","event","absoluteCharIndex","nodePositions","size","targetNode","bestMatch","distance","Number","MAX_SAFE_INTEGER","positions","Array","from","keys","sort","a","b","pos","nodeData","get","abs","textContent","scrollIntoView","behavior","block","parentNode","rootElement","clear","collectTextNodes","element","charCount","classList","contains","set","childNodes","child","getContext","getCurrentLocale","checkSynthesisReady","setupSafariKeepAlive","createUtterance","handleUtteranceEnd","InputValidator","TTSValidator","SecureStorage","Play","context","pausedAt","remainingText","newUtterance","window","SpeechSynthesisUtterance","lang","rate","pitch","currentPitch","_lastCharIndex","_contentOffset","contentPosition","currentVoice","voice","voices","find","v","voiceURI","onboundary","absolutePosition","adjustedEvent","fullText","onend","utterance","speechSynthesis","speak","paused","resume","speaking","cancel","setTimeout","Pause","reduce","sum","_safariTimerId","safariKeepAliveTimer","pause","Restart","changeSpeed","validatedEvent","validateEvent","speed","validateSpeed","target","value","currentLocale","storageKey","success","setItem","changePitch","validatePitch","toggleSettings","showSettings","Promise","resolve","check","pending","setupUtteranceEvents","undefined","onerror","loadVoices","availableVoices","getVoices","validVoices","localVoices","startsWith","preferredVoice","validatedVoice","validateVoice","changeVoice","validateString","initHighlightColors","init","highlightSuccess","voiceSuccess","onvoiceschanged","addEventListener","isSelected","STORAGE_KEYS","LANG","SPEED","PITCH","HIGHLIGHT_BG","HIGHLIGHT_COLOR","SECURITY_CONFIG","MAX_INPUT_LENGTH","MAX_SPEED","MIN_SPEED","MAX_PITCH","MIN_PITCH","ALLOWED_CSS_PROPERTIES","SAFE_COLOR_PATTERN","SAFE_KEY_PATTERN","SAFE_VOICE_URI_PATTERN","input","maxLength","replace","validateNumber","min","max","num","parseFloat","isNaN","validateVoiceURI","test","sanitizeHTML","div","document","createElement","innerHTML","sanitizeColor","color","key","sanitizedValue","localStorage","message","getItem","defaultValue","setCSSProperty","property","includes","style","setProperty","querySelector","selector","additionalData","errorInfo","timestamp","Date","toISOString","handleSpeechError","errorContext","errorType","validatedURI","getLocalStorageItem","getBrowser","initialState","isProcessingChunks","Map","documentElement","userAgent","navigator","sanitizedUA","indexOf","rawHighlightBackground","highlightBackground","rawHighlightColor","highlightColor","bgSuccess","colorSuccess","store","c","actions","secureEvent","callbacks"],"sourceRoot":""}